


<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<title>200~house_of_force [ your blog title ]</title>
	
	
	<!-- stylesheets list from _config.yml -->
	
	<link rel="stylesheet" href="/css/PreciousJoy.css">
	
	<link rel="stylesheet" href="/css/top-bar.css">
	
	<link rel="stylesheet" href="/css/menu-outer.css">
	
	<link rel="stylesheet" href="/css/content-outer.css">
	
	<link rel="stylesheet" href="/css/bottom-outer.css">
	
	<link rel="stylesheet" href="/css/atom-one-dark.css">
	
	<link rel="stylesheet" href="/css/recent-posts-item.css">
	
	<link rel="stylesheet" href="/css/article-sidebar-toc.css">
	
	<link rel="stylesheet" href="/css/jquery.fancybox.min.css">
	
	<link rel="stylesheet" href="/css/search.css">
	
	<link rel="stylesheet" href="/css/toc.css">
	
	<link rel="stylesheet" href="/css/sidebar.css">
	
	<link rel="stylesheet" href="/css/archive.css">
	
	<link rel="stylesheet" href="/css/jquery.mCustomScrollbar.min.css">
	
	<link rel="stylesheet" href="/css/Z-last-cover-others.css">
	
	
	
<meta name="generator" content="Hexo 6.3.0"></head>




<body id="wrapper">

	<div id="">
		
		<div id="top-bar">
			
			<div id="avatar-box">
				<img 
				class="avatar"
				src="/images/default-avatar.jpg" 
				alt="avatar">
			</div>

			<div id="top-bar-text">
				<div id="top-bar-title">
					pa1n
				</div>
				<div id="top-bar-slogan">
					
				</div>
			</div>

		</div>

		<div id="menu-outer">
			<div id="menu-inner">
				
				
				<div class="menu-item">
					<a href="/">Home</a>
				</div>
				
				<div class="menu-item">
					<a href="/about">About</a>
				</div>
				
				<div class="menu-item">
					<a href="/archives">Archives</a>
				</div>
				

				<div class="menu-item menu-item-search">
					
  <span class="local-search local-search-google local-search-plugin">
      <input type="search" placeholder="ç«™å†…æœç´¢" id="local-search-input" class="local-search-input-cls" style="">
      <div id="local-search-result" class="local-search-result-cls"></div>
  </span>
	
				</div>

			</div>
		</div>

		<div id="content-outer">
			<div id="content-inner">

				
<div id="details">
	
	<article id="details-post">
		<div id=details-post-item>
			<h1>200~house_of_force</h1>
			<p>åˆ©ç”¨æ¡ä»¶ï¼šèƒ½æ§åˆ¶topchunk_sizeï¼Œèƒ½å¤Ÿè‡ªç”±æ§åˆ¶ç”³è¯·çš„å †å—å¤§å°ã€‚éœ€è¦çŸ¥é“top_chunkåœ°å€ä¸ç›®çš„åœ°å€çš„åç§»é‡ï¼Œå¦‚æœè¿˜ä¸å¯¹é½ï¼Œå³ç»“æœä¸æ˜¯0x0ç»“å°¾ï¼Œéœ€è¦å¤šå‡8ï¼Œç„¶åå‡å»SIZE_SZï¼ˆ8ï¼‰</p>
<p>ç»“æœï¼šèƒ½å°†topcunkçš„åœ°å€æ§åˆ¶åˆ°æˆ‘ä»¬æƒ³è¦çš„åœ°å€ï¼Œå†ç”³è¯·å†…å­˜å°±å¯ä»¥æ§åˆ¶è¿™ä¸ªåœ°å€çš„å€¼ã€‚</p>
<h4 id="check1"><a href="#check1" class="headerlink" title="check1"></a>check1</h4><p>å¯¹topchunk_sizeçš„æ£€æŸ¥ï¼Œ(unsigned long) (size) &gt;= (unsigned long) (nb + MINSIZE)</p>
<pre><code class="lang-c++">// è·å–å½“å‰çš„top chunkï¼Œå¹¶è®¡ç®—å…¶å¯¹åº”çš„å¤§å°
victim = av-&gt;top;
size   = chunksize(victim);
// å¦‚æœåœ¨åˆ†å‰²ä¹‹åï¼Œå…¶å¤§å°ä»ç„¶æ»¡è¶³ chunk çš„æœ€å°å¤§å°ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥è¿›è¡Œåˆ†å‰²ã€‚
if ((unsigned long) (size) &gt;= (unsigned long) (nb + MINSIZE)) 
&#123;
    remainder_size = size - nb;
    remainder      = chunk_at_offset(victim, nb);
    av-&gt;top        = remainder;
    #è®¾ç½®top_chunkçš„å¤´ï¼Œé™„è¿‘å€¼ä¼šæœ‰æ‰€å˜åŒ–
    set_head(victim, nb | PREV_INUSE |
            (av != &amp;main_arena ? NON_MAIN_ARENA : 0));
    set_head(remainder, remainder_size | PREV_INUSE);

    check_malloced_chunk(av, victim, nb);
    void *p = chunk2mem(victim);
    alloc_perturb(p, bytes);
    return p;
&#125;
</code></pre>
<p>æ‰€ä»¥æŠŠsizeæ”¹ä¸º-1ï¼Œåœ¨è¡¥ç ä¸­ä¸ºå¾ˆå¤§çš„æ•°ï¼Œèƒ½å¤Ÿæ»¡è¶³æ¡ä»¶</p>
<h5 id="æ–°çš„remainderå³top-chunkçš„åœ°å€-remainder-chunk-at-offset-victim-nb-ï¼Œéœ€è¦ç®—å‡ºtopchunkçš„åœ°å€å’Œç›®æ ‡åœ°å€çš„åç§»"><a href="#æ–°çš„remainderå³top-chunkçš„åœ°å€-remainder-chunk-at-offset-victim-nb-ï¼Œéœ€è¦ç®—å‡ºtopchunkçš„åœ°å€å’Œç›®æ ‡åœ°å€çš„åç§»" class="headerlink" title="æ–°çš„remainderå³top_chunkçš„åœ°å€  **remainder = chunk_at_offset(victim, nb);**ï¼Œéœ€è¦ç®—å‡ºtopchunkçš„åœ°å€å’Œç›®æ ‡åœ°å€çš„åç§»"></a>æ–°çš„remainderå³top_chunkçš„åœ°å€  <code>**remainder = chunk_at_offset(victim, nb);**</code>ï¼Œéœ€è¦ç®—å‡ºtopchunkçš„åœ°å€å’Œç›®æ ‡åœ°å€çš„åç§»</h5><h4 id="check2"><a href="#check2" class="headerlink" title="check2"></a>check2</h4><p>å¯¹ç”³è¯·çš„sizeçš„æ£€æŸ¥</p>
<pre><code class="lang-c++">/*
   Check if a request is so large that it would wrap around zero when
   padded and aligned. To simplify some other code, the bound is made
   low enough so that adding MINSIZE will also not wrap around zero.
 */

#è¿™é‡Œçš„reqå³æ˜¯nb.å¯¹reqçš„å¤§å°çš„æ£€æŸ¥ï¼Œ((unsigned long) (req)è¦å°äº (unsigned long) (INTERNAL_SIZE_T)(-2 * MINSIZE))

#define REQUEST_OUT_OF_RANGE(req)                                              \
    ((unsigned long) (req) &gt;= (unsigned long) (INTERNAL_SIZE_T)(-2 * MINSIZE))
/* pad request bytes into a usable size -- internal version */
//MALLOC_ALIGN_MASK = 2 * SIZE_SZ -1

# å¯¹nbåŠ  SIZE_SZåŠ  MALLOC_ALIGN_MASK,æœ€åå’ŒMALLOC_ALIGN_MASKæŒ‰ä½ä¸å¯¹é½,è¿™é‡Œçš„SIZE_SZæ˜¯8
#define request2size(req)                                                      \
    (((req) + SIZE_SZ + MALLOC_ALIGN_MASK &lt; MINSIZE)                           \
         ? MINSIZE                                                             \
         : ((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK)

/*  Same, except also perform argument check */
# reqä¸èƒ½å¤§äº -2 * MINSIZEï¼Œå¦åˆ™ä¼šæŠ¥é”™
#define checked_request2size(req, sz)                                          \
    if (REQUEST_OUT_OF_RANGE(req)) &#123;                                           \
        __set_errno(ENOMEM);                                                   \
        return 0;                                                              \
    &#125;                                                                          \
    (sz) = request2size(req);
</code></pre>
<h5 id="é¦–å…ˆ-unsigned-long-req-lt-unsigned-long-INTERNAL-SIZE-T-2-MINSIZE-ï¼Œå³æ— ç¬¦å·çš„nbè¦å°äºæ— ç¬¦å·çš„-2-MINSIZEï¼Œå³reqä¸èƒ½å¤§äº-2MINSIZE-ï¼Œä¸€èˆ¬éƒ½èƒ½æ»¡è¶³æ¡ä»¶ã€‚"><a href="#é¦–å…ˆ-unsigned-long-req-lt-unsigned-long-INTERNAL-SIZE-T-2-MINSIZE-ï¼Œå³æ— ç¬¦å·çš„nbè¦å°äºæ— ç¬¦å·çš„-2-MINSIZEï¼Œå³reqä¸èƒ½å¤§äº-2MINSIZE-ï¼Œä¸€èˆ¬éƒ½èƒ½æ»¡è¶³æ¡ä»¶ã€‚" class="headerlink" title="é¦–å…ˆ  ((unsigned long) (req) &lt;= (unsigned long) (INTERNAL_SIZE_T)(-2  MINSIZE))ï¼Œå³æ— ç¬¦å·çš„nbè¦å°äºæ— ç¬¦å·çš„  **-2  MINSIZEï¼Œå³reqä¸èƒ½å¤§äº-2MINSIZE*ï¼Œä¸€èˆ¬éƒ½èƒ½æ»¡è¶³æ¡ä»¶ã€‚"></a>é¦–å…ˆ  ((unsigned long) (req) &lt;= (unsigned long) (INTERNAL_SIZE_T)(-2 <em> MINSIZE))ï¼Œå³æ— ç¬¦å·çš„nbè¦å°äºæ— ç¬¦å·çš„  **-2 </em> MINSIZE<strong>ï¼Œå³reqä¸èƒ½å¤§äº</strong>-2<em>MINSIZE*</em>ï¼Œä¸€èˆ¬éƒ½èƒ½æ»¡è¶³æ¡ä»¶ã€‚</h5><h5 id="å…¶æ¬¡æ˜¯å¯¹reqçš„å¯¹é½çš„æ£€æŸ¥ï¼Œreqéœ€è¦æ˜¯0x0ç»“å°¾æ¥å¯¹é½ï¼Œå¦åˆ™å¾—å¤šå‡8"><a href="#å…¶æ¬¡æ˜¯å¯¹reqçš„å¯¹é½çš„æ£€æŸ¥ï¼Œreqéœ€è¦æ˜¯0x0ç»“å°¾æ¥å¯¹é½ï¼Œå¦åˆ™å¾—å¤šå‡8" class="headerlink" title="å…¶æ¬¡æ˜¯å¯¹reqçš„å¯¹é½çš„æ£€æŸ¥ï¼Œreqéœ€è¦æ˜¯0x0ç»“å°¾æ¥å¯¹é½ï¼Œå¦åˆ™å¾—å¤šå‡8"></a>å…¶æ¬¡æ˜¯å¯¹reqçš„å¯¹é½çš„æ£€æŸ¥ï¼Œreqéœ€è¦æ˜¯0x0ç»“å°¾æ¥å¯¹é½ï¼Œå¦åˆ™å¾—å¤šå‡8</h5><h5 id="req-SIZE-SZ-MALLOC-ALIGN-MASK-amp-MALLOC-ALIGN-MASK-ï¼Œè¿™é‡Œçš„ç»“æœæ˜¯æœ€åç”³è¯·çš„å¤§å°ã€‚ç”±äº-req-SIZE-SZï¼ŒSIZE-SZæ˜¯8ï¼Œæ‰€ä»¥ç®—å‡ºåç§»åè¿˜éœ€è¦å‡å»8ï¼Œè™½ç„¶reqä¼šåŠ ä¸ŠMALLOC-ALIGN-MASKï¼Œä½†æ˜¯æœ€åä¼šè¢«å¯¹é½æ‰ï¼Œå°±ä¸ç”¨å¤šå‡æ‰MALLOC-ALIGN-MASKäº†"><a href="#req-SIZE-SZ-MALLOC-ALIGN-MASK-amp-MALLOC-ALIGN-MASK-ï¼Œè¿™é‡Œçš„ç»“æœæ˜¯æœ€åç”³è¯·çš„å¤§å°ã€‚ç”±äº-req-SIZE-SZï¼ŒSIZE-SZæ˜¯8ï¼Œæ‰€ä»¥ç®—å‡ºåç§»åè¿˜éœ€è¦å‡å»8ï¼Œè™½ç„¶reqä¼šåŠ ä¸ŠMALLOC-ALIGN-MASKï¼Œä½†æ˜¯æœ€åä¼šè¢«å¯¹é½æ‰ï¼Œå°±ä¸ç”¨å¤šå‡æ‰MALLOC-ALIGN-MASKäº†" class="headerlink" title="((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK)ï¼Œè¿™é‡Œçš„ç»“æœæ˜¯æœ€åç”³è¯·çš„å¤§å°ã€‚ç”±äº(req) + SIZE_SZï¼ŒSIZE_SZæ˜¯8ï¼Œæ‰€ä»¥ç®—å‡ºåç§»åè¿˜éœ€è¦å‡å»8ï¼Œè™½ç„¶reqä¼šåŠ ä¸ŠMALLOC_ALIGN_MASKï¼Œä½†æ˜¯æœ€åä¼šè¢«å¯¹é½æ‰ï¼Œå°±ä¸ç”¨å¤šå‡æ‰MALLOC_ALIGN_MASKäº†"></a>((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK)ï¼Œè¿™é‡Œçš„ç»“æœæ˜¯æœ€åç”³è¯·çš„å¤§å°ã€‚ç”±äº(req) + SIZE_SZï¼ŒSIZE_SZæ˜¯8ï¼Œæ‰€ä»¥ç®—å‡ºåç§»åè¿˜éœ€è¦å‡å»8ï¼Œè™½ç„¶reqä¼šåŠ ä¸ŠMALLOC_ALIGN_MASKï¼Œä½†æ˜¯æœ€åä¼šè¢«å¯¹é½æ‰ï¼Œå°±ä¸ç”¨å¤šå‡æ‰MALLOC_ALIGN_MASKäº†</h5><p><code>MALLOC_ALIGN</code> é€šå¸¸æŒ‡çš„æ˜¯å†…å­˜å—å¯¹é½çš„è¦æ±‚ã€‚å¦‚æœreqä¸å¯¹é½ï¼Œä¸æ˜¯0x0ç»“å°¾çš„ï¼Œéœ€è¦å¤šå‡æ‰8</p>
<h2 id="bcloud-bctf-2016"><a href="#bcloud-bctf-2016" class="headerlink" title="bcloud_bctf_2016"></a>bcloud_bctf_2016</h2><p>åªå¼€äº†æ ˆä¸Šçš„ä¿æŠ¤</p>
<p><img src="https://hswikar.oss-cn-beijing.aliyuncs.com/image-20241104192949440.png" alt="image-20241104192949440"></p>
<p><img src="https://hswikar.oss-cn-beijing.aliyuncs.com/image-20241104193057354.png" alt="image-20241104193057354"></p>
<p>è¿™é‡Œä¼šæŠŠå †çš„åœ°å€ç»™åˆ°v2çš„æŒ‡é’ˆï¼Œåç»­ä¼šæ‰“å°å‡ºæ¥</p>
<p><img src="https://hswikar.oss-cn-beijing.aliyuncs.com/image-20241104193219359.png" alt="image-20241104193219359"></p>
<p>ğŸ•â…§é¢˜ç›®ï¼Œè°ƒè¯•çš„æ—¶å€™å®Œå…¨ä¸æ˜¯é¢˜ç›®é€»è¾‘ï¼Œç®—äº†ã€‚</p>

		</div>

		<!-- æ¥å¿…åŠ›Cityç‰ˆå®‰è£…ä»£ç  -->
<div id="lv-container" data-id="city" data-uid="MTAyMC80NjIyNC8yMjczNQ==">
	<script type="text/javascript">
   (function(d, s) {
       var j, e = d.getElementsByTagName(s)[0];

       if (typeof LivereTower === 'function') { return; }

       j = d.createElement(s);
       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
       j.async = true;

       e.parentNode.insertBefore(j, e);
   })(document, 'script');
	</script>
<noscript> ä¸ºæ­£å¸¸ä½¿ç”¨æ¥å¿…åŠ›è¯„è®ºåŠŸèƒ½è¯·æ¿€æ´»JavaScript</noscript>
</div>
<!-- Cityç‰ˆå®‰è£…ä»£ç å·²å®Œæˆ -->
		
	</article>

	<div id="toc">
		
	</div>

</div>

<!-- <div id="paginator"> -->
<!-- 	 -->
<!-- </div> -->


			</div>
		</div>

		<div id="bottom-outer">
			<div id="bottom-inner">
				Site by your name | 
				Powered by <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a> |
				theme <a target="_blank" rel="noopener" href="https://github.com/fireworks99/hexo-theme-PreciousJoy">PreciousJoy</a>
			</div>
		</div>

		
	</div>





	
	<!-- scripts list from theme config.yml -->
	
	<script src="/js/jquery-3.5.1.min.js"></script>
	
	<script src="/js/PreciousJoy.js"></script>
	
	<script src="/js/highlight.pack.js"></script>
	
	<script src="/js/jquery.fancybox.min.js"></script>
	
	<script src="/js/search.js"></script>
	
	<script src="/js/load.js"></script>
	
	<script src="/js/jquery.mCustomScrollbar.concat.min.js"></script>
	
	<script src="/js/clipboard.min.js"></script>
	
	

	<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>
